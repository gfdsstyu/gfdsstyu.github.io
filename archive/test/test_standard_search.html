<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸°ì¤€ì„œ ë²ˆí˜¸ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #2c3e50; margin-bottom: 30px; }
        .test-case {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-left: 4px solid #3498db;
            border-radius: 4px;
        }
        .query {
            font-weight: bold;
            color: #2980b9;
            font-size: 1.1em;
            margin-bottom: 10px;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 4px;
        }
        .score {
            color: #27ae60;
            font-weight: bold;
        }
        .meta {
            color: #7f8c8d;
            font-size: 0.9em;
            margin-top: 5px;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover { background: #2980b9; }
        .loading {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ê¸°ì¤€ì„œ ë²ˆí˜¸ ê²€ìƒ‰ ì •í™•ë„ í…ŒìŠ¤íŠ¸</h1>

        <button onclick="runAllTests()">ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        <button onclick="clearResults()">ê²°ê³¼ ì´ˆê¸°í™”</button>

        <div id="results"></div>
    </div>

    <script src="/js/services/ragService.js"></script>
    <script>
        // í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤
        const testCases = [
            { query: "501-4", expect: "ê¸°ì¤€ì„œ 501, ë¬¸ë‹¨ 4" },
            { query: "720-12", expect: "ê¸°ì¤€ì„œ 720, ë¬¸ë‹¨ 12" },
            { query: "200-A21", expect: "ê¸°ì¤€ì„œ 200, ë¬¸ë‹¨ A21" },
            { query: "315-25", expect: "ê¸°ì¤€ì„œ 315, ë¬¸ë‹¨ 25" },
            { query: "540-A50", expect: "ê¸°ì¤€ì„œ 540, ë¬¸ë‹¨ A50" },
            { query: "ê¸°ì¤€ì„œ 501-4ì— ë”°ë¥´ë©´", expect: "ê¸°ì¤€ì„œ 501, ë¬¸ë‹¨ 4" },
            { query: "ê°ì‚¬ê¸°ì¤€ 720-12", expect: "ê¸°ì¤€ì„œ 720, ë¬¸ë‹¨ 12" }
        ];

        async function runAllTests() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="loading">í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...</div>';

            // RAG ì„œë¹„ìŠ¤ ì´ˆê¸°í™”
            window.ragService.vectorDataPath = './public/data/vectors.json';
            await window.ragService.loadVectors();

            resultsDiv.innerHTML = '';

            for (const testCase of testCases) {
                await runTest(testCase);
            }
        }

        async function runTest(testCase) {
            const resultsDiv = document.getElementById('results');

            const testDiv = document.createElement('div');
            testDiv.className = 'test-case';
            testDiv.innerHTML = `
                <div class="query">ì§ˆë¬¸: "${testCase.query}"</div>
                <div class="meta">ê¸°ëŒ€ê°’: ${testCase.expect}</div>
                <div class="result" id="result-${testCases.indexOf(testCase)}">
                    ê²€ìƒ‰ ì¤‘...
                </div>
            `;
            resultsDiv.appendChild(testDiv);

            try {
                // ê²€ìƒ‰ ì‹¤í–‰
                const results = await window.ragService.search(testCase.query, 3, {
                    types: ['audit'],
                    minSimilarity: 0.1
                });

                const resultDiv = document.getElementById(`result-${testCases.indexOf(testCase)}`);

                if (results.length === 0) {
                    resultDiv.innerHTML = 'âŒ ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ';
                    return;
                }

                let html = '';
                results.forEach((r, i) => {
                    const std = r.metadata?.standard_number || '?';
                    const para = r.metadata?.paragraph_number || '?';
                    const sim = (r.similarity * 100).toFixed(1);
                    const vec = (r.vectorSimilarity * 100).toFixed(1);
                    const kwd = (r.keywordScore * 100).toFixed(1);

                    html += `
                        <div style="margin: 10px 0; padding: 10px; background: #ecf0f1; border-radius: 4px;">
                            <strong>[${i+1}ìœ„]</strong>
                            <span class="score">${sim}%</span>
                            ê¸°ì¤€ì„œ ${std}-${para}
                            <div class="meta">
                                ë²¡í„°: ${vec}% | í‚¤ì›Œë“œ: ${kwd}% |
                                ì¶œì²˜: ${r.metadata?.source}
                            </div>
                            <div style="margin-top: 5px; font-size: 0.85em; color: #555;">
                                ${r.text.substring(0, 150)}...
                            </div>
                        </div>
                    `;
                });

                resultDiv.innerHTML = html;

            } catch (error) {
                const resultDiv = document.getElementById(`result-${testCases.indexOf(testCase)}`);
                resultDiv.innerHTML = `âŒ ì˜¤ë¥˜: ${error.message}`;
            }
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
    </script>
</body>
</html>
