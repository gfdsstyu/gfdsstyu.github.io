<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>감린이 학습 도우미 v3.x</title>
  <meta name="description" content="회계감사 퀴즈 · 망각곡선 기반 복습 엔진 · 3-Pane 대시보드" />

  <!-- 기본 셸 레이아웃용 경량 CSS (Tailwind 없이도 3-Pane 유지) -->
  <style>
    :root{
      --left-w: 320px; --right-w: 360px; --gap: 12px; --bg:#0b0c10; --panel:#12141a; --line:#1f2330; --fg:#e6e6e6;
      --muted:#9aa3b2; --chip:#2a3345; --accent:#4b8bff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--fg); font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    a{color:inherit}
    #app{
      display:grid; grid-template-columns: var(--left-w) 1fr var(--right-w);
      gap:var(--gap); height:100vh; padding:var(--gap); overflow:hidden;
    }
    .panel{
      border:1px solid var(--line); border-radius:10px; background:var(--panel);
      overflow:hidden; min-height:0; display:flex; flex-direction:column;
    }
    header.shell{
      display:flex; align-items:center; justify-content:space-between;
      padding:10px 12px; border-bottom:1px solid var(--line); gap:8px; background:#0e1117;
    }
    header.shell h1{font-size:14px; font-weight:600; margin:0; letter-spacing:.2px}
    .toolbar{display:flex; gap:8px; align-items:center}
    .btn{padding:6px 10px; border:1px solid var(--line); border-radius:8px; background:#0e1117; color:#dfe6ee; cursor:pointer}
    .btn.primary{border-color:#2a3345; background:#162038}
    .chip{display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border-radius:999px; background:var(--chip); color:#cfd7e6; font-size:12px}
    .scroll{overflow:auto}
    /* 좌측: 대시보드 */
    #left .section{padding:12px; border-bottom:1px dashed var(--line)}
    #calendar{display:grid; grid-template-columns:repeat(7,1fr); gap:4px}
    .cell{aspect-ratio:1/1; border-radius:6px; background:#0f1522; border:1px solid #162033}
    .cell.int-1{background:#16233f} .cell.int-3{background:#193053}
    .cell.int-5{background:#1b3a6a} .cell.int-8{background:#1d4788}
    #charts{padding:12px; display:grid; gap:12px}
    /* 중앙: 퀴즈 */
    #center .content{padding:12px; display:grid; gap:12px}
    #question-area{display:grid; gap:8px}
    textarea.answer{width:100%; resize:none; min-height:120px; padding:10px; border-radius:8px; border:1px solid var(--line); background:#0f1320; color:#eaecef}
    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; padding:2px 6px; border-radius:6px; background:#0d1322; border:1px solid #1c2234; color:#c1c9d6}
    /* 우측: 탐색 */
    #right .tree{padding:8px 8px 12px 8px}
    .group{border-top:1px solid var(--line); padding:8px 0}
    .group h4{margin:8px 4px; font-size:12px; color:var(--muted)}
    .item{display:flex; justify-content:space-between; align-items:center; padding:6px 8px; border-radius:8px; cursor:pointer}
    .item:hover{background:#0e1524}
    .badge{font-size:11px; padding:2px 6px; border-radius:999px; border:1px solid #263049; color:#b7c2d6}
    /* 모바일: 중앙 우선 */
    @media (max-width: 1024px){
      #app{grid-template-columns:1fr}
      #left, #right{display:none}
    }
  </style>

  <!-- Chart.js: 빠른 통계용 (향후 경량화 라이브러리로 교체 가능) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- GA 스니펫은 팀 표준에 맞춰 app.js에서 초기화(이벤트 훅: analytics/ga.js) -->
</head>
<body>
  <header class="shell">
    <h1>감린이 v3.x · 3-Pane · 망각곡선 엔진 v1</h1>
    <div class="toolbar">
      <span class="chip">엔진: <strong id="engine-mode-label">forgetting</strong></span>
      <button class="btn" id="toggle-left">대시보드</button>
      <button class="btn" id="toggle-right">탐색</button>
      <button class="btn primary" id="btn-start-review">오늘의 복습 시작</button>
    </div>
  </header>

  <main id="app">
    <!-- 좌: 캘린더/통계/엔진 제어 -->
    <section id="left" class="panel">
      <div class="section">
        <h3 style="margin:0 0 8px 0;">잔디밭 캘린더</h3>
        <div id="calendar" class="scroll" aria-label="activity calendar"></div>
      </div>
      <div id="charts" class="scroll">
        <canvas id="chart-daily" height="140"></canvas>
        <canvas id="chart-chapter" height="140"></canvas>
      </div>
      <div class="section">
        <h3 style="margin:0 0 8px 0;">오늘의 복습 제어</h3>
        <label>전략
          <select id="engine-strategy">
            <option value="forgetting" selected>망각</option>
            <option value="low-score">저득점</option>
            <option value="recent-wrong">최근오답</option>
          </select>
        </label>
        <label style="margin-left:12px;">개수 <input id="engine-N" type="range" min="5" max="30" value="10" /></label>
      </div>
    </section>

    <!-- 중: 퀴즈 -->
    <section id="center" class="panel">
      <div class="content scroll">
        <div id="question-area">
          <div id="question-meta" class="chip">단원 <span id="q-chapter">-</span> · 문제 <span id="q-no">-</span></div>
          <h2 id="q-title" style="margin:4px 0 6px 0; font-size:16px;"></h2>
          <p id="q-body" style="margin:0; white-space:pre-wrap;"></p>
          <textarea id="q-answer" class="answer" placeholder="여기에 답안을 입력하세요. (Ctrl+Enter 채점)"></textarea>
          <div style="display:flex; gap:8px; align-items:center;">
            <button class="btn" id="btn-prev">이전(←)</button>
            <button class="btn" id="btn-next">다음(→)</button>
            <button class="btn primary" id="btn-grade">채점(Ctrl+Enter)</button>
            <span class="kbd">? 단축키 도움말</span>
          </div>
          <div id="feedback" style="margin-top:6px; color:#c7d4ea;"></div>
        </div>
      </div>
    </section>

    <!-- 우: 탐색 -->
    <section id="right" class="panel">
      <div class="scroll tree" id="explorer-tree" aria-label="문항 탐색 트리"></div>
    </section>
  </main>

  <!-- 데이터셋은 app.js에서 /data/questions.json 로드 가정.
       과거 내장 블록 사용 시 아래 템플릿 id를 그대로 유지하면 됨.
  <script id="dataset-json" type="application/json">[ ... ]</script>
  -->

  <!-- 앱 부트스트랩 (ESM) -->
  <script type="module">
    // 1) 기본 토글(모바일에서 좌/우 열기)
    const qs = sel => document.querySelector(sel);
    qs('#toggle-left')?.addEventListener('click', () => {
      const left = qs('#left'); left.style.display = left.style.display === 'none' ? 'flex' : 'none';
    });
    qs('#toggle-right')?.addEventListener('click', () => {
      const right = qs('#right'); right.style.display = right.style.display === 'none' ? 'flex' : 'none';
    });

    // 2) 앱 모듈 부트스트랩 (app.js가 존재하면 거기에서 전체 wiring)
    // 권장: app.js 내부에서 아래 모듈들을 import하고 mount 함수 호출
    import './js/app.js';

    // --------- [직접 마운트 대안] app.js 미사용 프로젝트일 경우에만 주석 해제 ---------
    /*
    import { renderCalendar } from './js/charts/calendar.js';
    import { mountDashboard } from './js/ui/dashboard.js';
    import { mountQuiz } from './js/ui/quiz.js';
    import { mountExplorer } from './js/ui/explorer.js';
    import { recommendToday } from './js/engine/recommend.js';
    import * as selectors from './js/state/selectors.js';
    import { store } from './js/state/store.js';

    // 대시보드
    mountDashboard({
      calendarEl: document.getElementById('calendar'),
      dailyChartEl: document.getElementById('chart-daily'),
      chapterChartEl: document.getElementById('chart-chapter'),
      strategySelect: document.getElementById('engine-strategy'),
      countRange: document.getElementById('engine-N')
    });

    // 퀴즈
    mountQuiz({
      metaEl: document.getElementById('question-meta'),
      titleEl: document.getElementById('q-title'),
      bodyEl: document.getElementById('q-body'),
      answerEl: document.getElementById('q-answer'),
      feedbackEl: document.getElementById('feedback'),
      prevBtn: document.getElementById('btn-prev'),
      nextBtn: document.getElementById('btn-next'),
      gradeBtn: document.getElementById('btn-grade')
    });

    // 탐색
    mountExplorer({
      treeEl: document.getElementById('explorer-tree')
    });

    // 오늘의 복습
    document.getElementById('btn-start-review').addEventListener('click', () => {
      const N = Number(document.getElementById('engine-N').value);
      const mode = document.getElementById('engine-strategy').value;
      const allQuestions = selectors.getAllQuestions(store.getState());
      const picks = recommendToday(allQuestions, N, mode);
      // 중앙 패널 로드
      store.dispatch({ type: 'LOAD_RECOMMEND_SET', payload: picks });
      document.getElementById('engine-mode-label').textContent = mode;
    });
    */
    // -------------------------------------------------------------------------------
  </script>

  <!-- 안전장치: JS 비활성 안내 -->
  <noscript>이 앱은 자바스크립트가 필요합니다. 브라우저 설정에서 JS를 활성화하세요.</noscript>
</body>
</html>
