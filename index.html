

<!DOCTYPE html>
<html lang="ko">
<head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-20Q61B31CM"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-20Q61B31CM');
</script>
  <!-- Google Tag Manager -->
<script>(function (w, d, s, l, i) {
    w[l] = w[l] || []; w[l].push({
        'gtm.start':
        new Date().getTime(), event: 'gtm.js'
    }); var f = d.getElementsByTagName(s)[0],
    j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
})(window, document, 'script', 'dataLayer', 'GTM-TC8G7NJD');</script>
<!-- End Google Tag Manager -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="referrer" content="same-origin" />
  <title>ê°ë¦°ì´ - íšŒê³„ê°ì‚¬ í•™ìŠµ ë„ìš°ë¯¸</title>

  <!-- Favicon - 404 ì—ëŸ¬ ë°©ì§€ -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%236D28D9'/><rect x='20' y='20' width='60' height='60' rx='10' fill='white'/><circle cx='36' cy='43' r='9' fill='%238B5CF6'/><text x='36' y='46' font-size='14' fill='white' font-family='-apple-system,BlinkMacSystemFont,sans-serif' font-weight='900' text-anchor='middle' dominant-baseline='central'>ã„±</text><g transform='translate(64, 43)'><path d='M0 0 L 4 10 L 14 14 L 4 18 L 0 28 L -4 18 L -14 14 L -4 10 Z' fill='%23FACC15' transform='scale(0.8) translate(0, -14)'/></g><path d='M30 60 H 70 V 72 H 30 Z M35 60 V 72 M 40 60 V 72 M 45 60 V 72 M 50 60 V 72 M 55 60 V 72 M 60 60 V 72 M 65 60 V 72' fill='none' stroke='%234F46E5' stroke-width='2'/></svg>">

  <!-- Phase 3: Tailwind CSS (Built & Optimized) -->
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Noto Sans KR', sans-serif; }
    .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .summary-btn{ width:38px;height:38px;font-size:.8rem;line-height:1;display:flex;align-items:center;justify-content:center;padding:0 2px;transition:.2s;white-space:nowrap;overflow:hidden;text-overflow:ellipsis }
    .summary-btn:hover{ transform:scale(1.1) }
    pre{ white-space:pre-wrap; word-wrap:break-word }
    #toast{ position:fixed; top:16px; right:16px; z-index:9999 }
    .no-kr-break{ word-break:keep-all }

    .dark{ background-color:#1a202c; color:#e2e8f0 }
    .dark .bg-white{ background-color:#2d3748 }
    .dark .bg-gray-100{ background-color:#1a202c }
    .dark .bg-gray-50{ background-color:#2d3748 }
    .dark .text-gray-800{ color:#e2e8f0 }
    .dark .text-gray-700{ color:#cbd5e0 }
    .dark .text-gray-600{ color:#a0aec0 }
    .dark .border-gray-200{ border-color:#4a5568 }
    .dark .border-gray-300{ border-color:#4a5568 }
  </style>

  <style id="dark-a11y-20251026">
    html.dark { color-scheme: dark; }
    html.dark input, html.dark textarea, html.dark select { background-color:#1f2937; color:#e5e7eb; border-color:#4b5563 }
    html.dark ::placeholder { color:#9ca3af }
    html.dark :is(button,a,input,textarea,select):focus-visible { outline:2px solid #60a5fa; outline-offset:2px }
    html.dark .progress-track{ background-color:#374151 }
    html.dark #result-box{ background-color:#1f2937; border-color:#374151 }
    html.dark #quiz-area .bg-gray-50{ background-color:#111827 }
    html.dark #quiz-area .border-gray-200{ border-color:#374151 }
    html.dark #hint-container{ background-color:#1e3a8a; border-color:#334155; color:#e0e7ff }
    html.dark #summary-area .border{ border-color:#374151 }
    html.dark #summary-area .bg-gray-50{ background-color:#111827 }
    html.dark .summary-btn.bg-gray-100{ background-color:#111827; color:#d1d5db; border-color:#374151 }
    html.dark .summary-btn.bg-red-100{ background-color:#7f1d1d; color:#fecaca; border-color:#991b1b }
    html.dark .summary-btn.bg-yellow-100{ background-color:#78350f; color:#fde68a; border-color:#92400e }
    html.dark .summary-btn.bg-green-100{ background-color:#14532d; color:#bbf7d0; border-color:#166534 }
    html.dark .summary-btn.bg-blue-100{ background-color:#1e3a8a; color:#bfdbfe; border-color:#1e40af }
  </style>

  <style id="focus-mode-css">
    html.focus-mode { scroll-behavior: smooth; }
    html.focus-mode #result-box { max-height:none!important; overflow:visible!important; }
  </style>

  <style id="layout-css">
    .heatmap-cell{ width:14px; height:14px; border-radius:3px }
    .drawer-open{ overflow:hidden }
    .cal-cell { height: 32px; border-radius: 6px; position: relative; display: grid; place-items: center; font-size: 12px; border: 1px solid rgba(0,0,0,0.06); }
    .cal-cell .cal-day { position: absolute; top: 4px; right: 6px; font-size: 10px; opacity: 0.85; font-weight: 600; }
    .cal-cell.muted { opacity: 0.35; }
  </style>

  <style id="header-scroll-css">
    /* í—¤ë” ìŠ¤í¬ë¡¤ ì• ë‹ˆë©”ì´ì…˜ */
    #fixed-header {
      transition: transform 0.3s ease-in-out;
    }

    #fixed-header.header-visible {
      transform: translateY(0);
    }

    #fixed-header.header-hidden {
      transform: translateY(-100%);
    }
  </style>

  <style id="report-css">
    /* Chart container heights */
    #chart-daily-volume { min-height: 250px; max-height: 300px; }
    #chart-score-trend { min-height: 250px; max-height: 300px; }
    #chart-chapter-weakness { min-height: 300px; }
    #chart-chapter-detail { min-height: 250px; max-height: 300px; }

    /* ëª¨ë°”ì¼ ì„¸ë¡œëª¨ë“œ: ì°¨íŠ¸ ë†’ì´ ì¦ê°€ (ì••ì¶• ë°©ì§€) */
    @media (max-width: 768px) {
      #chart-daily-volume,
      #chart-score-trend,
      #chart-chapter-detail {
        min-height: 350px !important;
        max-height: 400px !important;
      }
      #chart-chapter-weakness {
        min-height: 350px !important;
      }
    }

    /* Prose styles for AI analysis */
    .prose { font-size: 0.875rem; line-height: 1.5; }
    .prose h1 { font-size: 1.5rem; font-weight: bold; margin-top: 1.5rem; margin-bottom: 0.75rem; }
    .prose h2 { font-size: 1.25rem; font-weight: bold; margin-top: 1.25rem; margin-bottom: 0.5rem; }
    .prose h3 { font-size: 1.125rem; font-weight: 600; margin-top: 1rem; margin-bottom: 0.5rem; }
    .prose p { margin-top: 0.75rem; margin-bottom: 0.75rem; }
    .prose ul, .prose ol { margin-left: 1.5rem; margin-top: 0.5rem; margin-bottom: 0.5rem; }
    .prose li { margin-top: 0.25rem; margin-bottom: 0.25rem; }
    .prose strong { font-weight: 600; color: inherit; }
    .prose code { background: rgba(0,0,0,0.05); padding: 0.125rem 0.25rem; border-radius: 0.25rem; font-size: 0.875em; }
    .prose.dark\:prose-invert { color: #e5e7eb; }
    html.dark .prose h1, html.dark .prose h2, html.dark .prose h3 { color: #f3f4f6; }
    html.dark .prose strong { color: #fbbf24; }
    html.dark .prose code { background: rgba(255,255,255,0.1); }

    /* ================================================
       PDF ë‚´ë³´ë‚´ê¸° ì „ìš© ìŠ¤íƒ€ì¼ (Task 2: ì„ íƒí˜• PDF ë‚´ë³´ë‚´ê¸°)
       ================================================ */
    @media print {
      /* 1. ì „ì²´ í˜ì´ì§€ ì´ˆê¸°í™” */
      * {
        background: white !important;
        color: black !important;
        box-shadow: none !important;
      }

      /* 2. ë¶ˆí•„ìš”í•œ ìš”ì†Œ ìˆ¨ê¹€ */
      body > *:not(#report-modal),
      nav, aside, header, footer,
      button, .no-print,
      #left-dashboard,
      #drawer-backdrop,
      .report-tab,
      #report-close-btn,
      #report-refresh-btn,
      #report-save-snapshot-btn,
      #report-load-snapshot-btn,
      #report-print-btn,
      #pdf-options-modal {
        display: none !important;
      }

      /* 3. ë¦¬í¬íŠ¸ ëª¨ë‹¬ë§Œ í‘œì‹œ */
      #report-modal {
        display: block !important;
        position: static !important;
        background: white !important;
        overflow: visible !important;
        max-height: none !important;
        padding: 0 !important;
        margin: 0 !important;
      }

      #report-modal > div {
        max-height: none !important;
        overflow: visible !important;
        box-shadow: none !important;
        border: none !important;
      }

      /* 4. ì„ íƒ í•´ì œëœ íƒ­ ìˆ¨ê¹€ (ìš°ì„ ìˆœìœ„ ìµœìƒìœ„) */
      .report-content.print-hidden,
      .print-hidden {
        display: none !important;
      }

      /* 5. ëª¨ë“  íƒ­ ì»¨í…ì¸ ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ í‘œì‹œ */
      .report-content:not(.print-hidden) {
        display: block !important;
        page-break-after: always;
        page-break-inside: avoid;
        margin-bottom: 20px;
      }

      .report-content:last-child {
        page-break-after: auto;
      }

      /* 6. ì°¨íŠ¸ ìµœì í™” */
      canvas {
        display: block !important;
        max-width: 100% !important;
        max-height: 400px !important;
        height: auto !important;
        page-break-inside: avoid;
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
      }

      /* 7. í˜ì´ì§€ í—¤ë”/í‘¸í„° */
      @page {
        margin: 1.5cm;
        size: A4;
      }

      /* 8. ì œëª© ìŠ¤íƒ€ì¼ */
      h1, h2, h3 {
        page-break-after: avoid;
        color: black !important;
      }

      /* 9. ë‹¤í¬ëª¨ë“œ ë¹„í™œì„±í™” */
      .dark {
        color: black !important;
      }
    }
  </style>
</head>
<body class="bg-gray-100 flex flex-col min-h-screen">
  <div id="toast" class="hidden"></div>

  <!-- ìƒë‹¨ ë„¤ë¹„ -->
  <header id="fixed-header" class="fixed top-0 left-0 right-0 z-50 bg-white/90 backdrop-blur border-b border-gray-200 dark:bg-gray-900/80 dark:border-gray-800">
    <div class="mx-auto max-w-[1400px] 2xl:max-w-[1600px] px-4 lg:px-6 xl:px-8 py-2 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <span class="text-xl font-extrabold tracking-tight text-blue-700 dark:text-blue-400">ê°ë¦°ì´</span>
        <span class="hidden sm:inline text-xs text-gray-500 dark:text-gray-400">Beta</span>
      </div>
      <nav class="flex items-center gap-2">
        <a href="https://docs.google.com/spreadsheets/d/1PEZHUUHIveVD91eZma8MiW2j7_B197o597YjpTY1CRc/edit?usp=sharing" target="_blank" class="hidden sm:inline text-sm font-bold px-3 py-1.5 rounded-lg bg-blue-600 text-white shadow-md hover:bg-blue-700 transition" title="ë¬¸ì œDB êµ¬ì„±ì„ ìœ„í•œ êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸">ë¬¸ì œDBêµ¬ì„±ì— ì°¸ì—¬</a>
        <span id="dday-display" class="hidden sm:inline text-sm font-bold px-3 py-1.5 rounded-lg bg-gradient-to-r from-red-500 to-pink-500 text-white shadow-md cursor-pointer hover:from-red-600 hover:to-pink-600 transition" title="ì‹œí—˜ë‚ ì§œ ì„¤ì •ì€ ì„¤ì • ë©”ë‰´ì—ì„œ">D-DAY</span>
        <button id="open-achievements-btn" class="inline-flex items-center gap-1 rounded-lg px-3 py-1.5 text-sm font-medium bg-gradient-to-r from-yellow-400 to-amber-500 hover:from-yellow-500 hover:to-amber-600 text-gray-900 shadow-md transition relative" title="ë‚˜ì˜ ì—…ì ">
          <span class="hidden sm:inline">ì—…ì </span><span>ğŸ†</span>
          <span id="new-achievement-badge" class="hidden absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full animate-pulse"></span>
        </button>
        <a id="help-button" href="README.html" target="_blank" class="hidden sm:inline text-sm text-gray-700 hover:text-blue-700 dark:text-gray-300 dark:hover:text-white">ë„ì›€ë§</a>
        <button id="settings-btn" class="ml-1 inline-flex items-center gap-1 rounded-lg px-3 py-1.5 text-sm font-medium bg-gray-100 hover:bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600" aria-haspopup="dialog">
          <span>ì„¤ì •</span><span aria-hidden>âš™ï¸</span>
        </button>
        <button id="hamburger" class="lg:hidden inline-flex items-center justify-center w-9 h-9 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600" aria-label="ë©”ë‰´">â‰¡</button>
      </nav>
    </div>
  </header>
  <div class="h-14"></div>

  <div id="drawer-backdrop" class="fixed inset-0 bg-black/40 hidden z-[1099]"></div>

  <div id="layout-root" class="pt-2 flex-1 px-4 lg:px-6 xl:px-8">
    <div class="mx-auto max-w-[1400px] 2xl:max-w-[1600px] grid grid-cols-1 lg:grid-cols-12 gap-4 xl:gap-6 2xl:gap-8">
      <!-- LEFT -->
      <aside id="left-dashboard" class="lg:col-span-3 xl:col-span-3 2xl:col-span-3 space-y-4">
        <button id="drawer-close" class="hidden lg:hidden absolute top-2 right-2 z-[1101] inline-flex items-center justify-center w-9 h-9 rounded-full bg-gray-200 hover:bg-gray-300 text-gray-700" aria-label="ë‹«ê¸°">âœ•</button>

        <div class="bg-white rounded-2xl shadow-xl p-4">
          <div class="flex items-center justify-between mb-2">
            <h3 class="font-bold text-lg">í•™ìŠµ ìº˜ë¦°ë”</h3>
            <div class="flex items-center gap-2">
              <button id="cal-prev" class="w-8 h-8 grid place-items-center rounded-md border hover:bg-gray-50" aria-label="ì´ì „ ë‹¬">â—€</button>
              <div id="cal-title" class="min-w-[96px] text-sm font-semibold text-center">YYYY.MM</div>
              <button id="cal-next" class="w-8 h-8 grid place-items-center rounded-md border hover:bg-gray-50" aria-label="ë‹¤ìŒ ë‹¬">â–¶</button>
            </div>
          </div>
          <div id="calendar-weekdays" class="grid grid-cols-7 text-center text-xs text-gray-500 mb-1">
            <div>ì›”</div><div>í™”</div><div>ìˆ˜</div><div>ëª©</div><div>ê¸ˆ</div><div>í† </div><div>ì¼</div>
          </div>
          <div id="calendar-grid" class="grid grid-cols-7 gap-x-0.5 gap-y-2"></div>
          <div class="mt-2 text-[11px] text-gray-500">ìƒ‰ = í•´ë‹¹ì¼ í’€ì´ëŸ‰ (ë…¸ë‘â†’ì´ˆë¡â†’íŒŒë‘)</div>
        </div>

        <div class="bg-white rounded-2xl shadow-xl p-4">
          <button id="open-report-btn" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white font-bold py-3 rounded-lg shadow-md hover:from-blue-600 hover:to-purple-700 transition duration-200 flex items-center justify-center gap-2">
            <span>ğŸ“Š</span>
            <span>í•™ìŠµ ë¦¬í¬íŠ¸ ìƒì„±</span>
          </button>
        </div>

        <div class="bg-white rounded-2xl shadow-xl p-4">
          <h3 class="font-bold text-lg mb-2">ì˜¤ëŠ˜ì˜ í†µê³„</h3>
          <div id="stats-overview" class="text-sm space-y-1"></div>
        </div>

        <div class="bg-white rounded-2xl shadow-xl p-4">
          <h3 class="font-bold text-lg mb-2">ì˜¤ëŠ˜ì˜ ë³µìŠµ</h3>
          <label for="review-strategy-select" class="text-sm block mb-2">ìš°ì„ ìˆœìœ„</label>
          <select id="review-strategy-select" name="review-strategy" class="w-full p-2 border rounded">
            <option value="smart">ì§€ëŠ¥í˜• ì¶”ì²œ (ê¸°ë³¸)</option>
            <option value="hlr">HLR ê¸°ë°˜ (íšŒìƒ í™•ë¥ )</option>
            <option value="low">ì ìˆ˜ ë‚®ì€ ìˆœ</option>
            <option value="recentWrong">ìµœê·¼ í‹€ë¦° ìˆœ</option>
            <option value="flag">ì‚¬ìš©ì ì§€ì • ë³µìŠµ ëª©ë¡</option>
          </select>
          <button id="start-review-btn" class="mt-3 w-full bg-blue-600 text-white py-2 rounded-lg">ì˜¤ëŠ˜ì˜ ë³µìŠµ ì‹œì‘</button>
        </div>
      </aside>

      <!-- CENTER -->
      <main id="center-core" class="lg:col-span-6 xl:col-span-6 2xl:col-span-6">
        <div class="bg-white rounded-2xl shadow-xl w-full p-6 md:p-8">
          <div class="flex flex-col md:flex-row gap-4 mb-6 items-center">
            <div class="flex-1 w-full">
              <label for="chapter-select" class="block text-sm font-medium text-gray-700 mb-1">ë‹¨ì› ì„ íƒ</label>
              <select id="chapter-select" name="chapter" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 transition dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600">
                <option value="">-- ì „ì²´ ë‹¨ì› --</option>
              </select>
            </div>
            <div class="flex-1 w-full">
              <label for="filter-select" class="block text-sm font-medium text-gray-700 mb-1">ë¬¸ì œ í•„í„°</label>
              <select id="filter-select" name="filter" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 transition dark:bg-gray-700 dark:text-gray-100 dark:border-gray-700">
                <option value="all">ëª¨ë“  ë¬¸ì œ í’€ê¸°</option>
                <option value="unanswered">ì•„ì§ ì•ˆ í‘¼ ë¬¸ì œ</option>
                <option value="today-review">ì˜¤ëŠ˜ì˜ ë³µìŠµ (ì¶”ì²œ)</option>
                <option value="80">80ì  ë¯¸ë§Œ ë¬¸ì œ</option>
                <option value="60">60ì  ë¯¸ë§Œ ë¬¸ì œ</option>
              </select>
            </div>
            <div class="w-full md:w-auto md:self-end flex flex-col sm:flex-row gap-2">
              <button id="load-quiz-btn" class="flex-1 bg-blue-600 text-white font-bold p-3 rounded-lg shadow-md hover:bg-blue-700 transition duration-200 whitespace-nowrap">í•™ìŠµ ì‹œì‘</button>
              <button id="random-quiz-btn" class="flex-1 bg-purple-600 text-white font-bold p-3 rounded-lg shadow-md hover:bg-purple-700 transition duration-200 whitespace-nowrap">ëœë¤ ë¬¸ì œ</button>
              <button id="flashcard-mode-btn" class="flex-1 bg-green-600 text-white font-bold p-3 rounded-lg shadow-md hover:bg-green-700 transition duration-200 whitespace-nowrap">í”Œë˜ì‹œì¹´ë“œ</button>
            </div>
          </div>

          <div id="source-group-filter" class="mb-6"></div>

          <!-- í”Œë˜ì‹œì¹´ë“œ ì˜ì—­ -->
          <div id="flashcard-area" class="hidden">
            <div class="bg-gradient-to-br from-blue-50 to-purple-50 dark:from-gray-800 dark:to-gray-700 border-2 border-blue-200 dark:border-gray-600 rounded-2xl p-8 mb-6 min-h-[400px] flex flex-col">
              <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-blue-700 dark:text-blue-300">í”Œë˜ì‹œì¹´ë“œ ëª¨ë“œ</h2>
                <span id="flashcard-counter" class="text-gray-600 dark:text-gray-300 font-medium">0 / 0</span>
              </div>

              <div class="flex-1 flex flex-col justify-center space-y-6">
                <div class="bg-white dark:bg-gray-900 rounded-xl p-6 shadow-md">
                  <h3 class="text-sm font-semibold text-gray-500 dark:text-gray-400 mb-2">ë¬¸ì œ ì œëª©</h3>
                  <p id="flashcard-title" class="text-lg font-bold text-gray-800 dark:text-gray-100">-</p>
                </div>

                <div class="bg-white dark:bg-gray-900 rounded-xl p-6 shadow-md">
                  <button id="flashcard-toggle-question" class="w-full flex items-center gap-2 mb-3 hover:opacity-70 transition">
                    <span id="flashcard-question-arrow" class="text-gray-500 dark:text-gray-400 text-lg">â–¶</span>
                    <h3 class="text-sm font-semibold text-gray-500 dark:text-gray-400">ë¬¼ìŒ</h3>
                  </button>
                  <div id="flashcard-question-box" class="hidden">
                    <p id="flashcard-question" class="text-base text-gray-700 dark:text-gray-200 leading-relaxed whitespace-pre-wrap">-</p>
                  </div>
                </div>

                <div class="bg-white dark:bg-gray-900 rounded-xl p-6 shadow-md">
                  <div class="flex justify-between items-center mb-3">
                    <h3 class="text-sm font-semibold text-gray-500 dark:text-gray-400">ë‹µë³€ (ìŠ¤í˜ì´ìŠ¤ë°”ë¡œ í† ê¸€)</h3>
                    <button id="flashcard-toggle-answer" class="px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-lg hover:bg-green-700 transition">
                      ë‹µë³€ ë³´ê¸° ğŸ‘ï¸
                    </button>
                  </div>
                  <div id="flashcard-answer-box" class="hidden">
                    <p id="flashcard-answer" class="text-base text-gray-700 dark:text-gray-200 leading-relaxed whitespace-pre-wrap">-</p>
                  </div>
                  <div id="flashcard-answer-hidden" class="text-center py-8 text-gray-400">
                    <p>ë‹µë³€ì´ ìˆ¨ê²¨ì ¸ ìˆìŠµë‹ˆë‹¤</p>
                    <p class="text-xs mt-2">ìœ„ ë²„íŠ¼ ë˜ëŠ” ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ëˆŒëŸ¬ í™•ì¸í•˜ì„¸ìš”</p>
                  </div>
                </div>
              </div>

              <div class="space-y-3 mt-6">
                <div class="flex justify-between items-center gap-4">
                  <button id="flashcard-prev-btn" class="px-6 py-3 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 font-bold rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition">â† ì´ì „</button>
                  <div class="flex gap-2">
                    <button id="flashcard-random-btn" class="px-4 py-3 bg-purple-500 text-white font-medium rounded-lg hover:bg-purple-600 transition">ğŸ² ëœë¤</button>
                    <button id="flashcard-exit-btn" class="px-4 py-3 bg-red-500 text-white font-medium rounded-lg hover:bg-red-600 transition">ì¢…ë£Œ (Esc)</button>
                  </div>
                  <button id="flashcard-next-btn" class="px-6 py-3 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 font-bold rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition">ë‹¤ìŒ â†’</button>
                </div>
                <div class="text-center text-xs text-gray-500 dark:text-gray-400">
                  ë‹¨ì¶•í‚¤: â† ì´ì „ | â†’ ë‹¤ìŒ | Q ë¬¼ìŒí† ê¸€ | Space ë‹µë³€í† ê¸€ | 1(ì‰¬ì›€) 2(ë³´í†µ) 3(ì–´ë ¤ì›€) 0(ê±´ë„ˆë›°ê¸°) | Esc ì¢…ë£Œ
                </div>
              </div>
            </div>
          </div>

          <!-- ë¬¸ì œ ì˜ì—­ -->
          <div id="quiz-area" class="hidden">
            <div class="bg-gray-50 border border-gray-200 rounded-lg p-6 mb-4">
              <div class="flex justify-between items-center mb-2">
                <h2 id="question-number" class="text-xl font-bold text-blue-700 bg-blue-100 px-3 py-1 rounded-md">ë¬¸í•­</h2>
                <span id="question-counter" class="text-gray-500 font-medium">0 / 0</span>
              </div>
              <div id="db-question-id" class="text-xs text-gray-500 hidden">ID: -</div>

              <p id="question-text" class="text-gray-800 text-base md:text-lg leading-relaxed mt-2">ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>

              <!-- íŒíŠ¸/ë³µìŠµ ë²„íŠ¼ ì˜ì—­ -->
              <div class="mt-3 flex items-center justify-between gap-2">
                <button id="hint-btn" class="text-sm bg-purple-600 text-white px-3 py-1.5 rounded-md shadow hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500">íŒíŠ¸</button>

                <div class="flex items-center gap-2">
                  <!-- ë³µìŠµì¶”ê°€(â˜…) -->
                  <button id="review-flag-toggle" class="text-sm px-3 py-1.5 rounded-md border border-gray-300 hover:bg-gray-100 flex items-center gap-1" aria-pressed="false" title="ë³µìŠµ í•„ìš” í† ê¸€">
                    <span class="text-yellow-500">â˜†</span><span>ë³µìŠµ ì¶”ê°€</span>
                  </button>

                  <!-- ë³µìŠµ ì œì™¸(â–) -->
                  <button id="review-exclude-toggle" class="text-sm px-3 py-1.5 rounded-md border border-gray-300 hover:bg-gray-100 flex items-center gap-1" aria-pressed="false" title="ì˜¤ëŠ˜ì˜ ë³µìŠµì—ì„œ ì œì™¸/í•´ì œ">
                    <span class="text-gray-600">â–</span><span>ë³µìŠµ ì œì™¸</span>
                  </button>
                </div>
              </div>

              <div id="hint-container" class="hidden mt-3 text-sm bg-purple-50 border border-purple-200 text-purple-800 rounded-lg p-3 dark:bg-indigo-900 dark:border-indigo-700 dark:text-indigo-100"></div>
            </div>

            <div class="flex items-center justify-between mb-2">
              <label for="user-answer" class="text-sm font-medium text-gray-700">ë‹µì•ˆ ì…ë ¥</label>
              <button id="load-prev-answer-btn" class="text-xs text-blue-600 hover:underline">ì´ì „ ë‹µì•ˆ ë¶ˆëŸ¬ì˜¤ê¸°</button>
            </div>

            <!-- ë‹µì•ˆ ì…ë ¥ ì˜ì—­: ìŒì„±ì…ë ¥ ë²„íŠ¼ í¬í•¨ -->
            <div class="relative">
              <textarea id="user-answer" name="user-answer" class="w-full p-4 pb-12 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition dark:bg-gray-800 dark:text-gray-100 dark:placeholder-gray-400 dark:border-gray-700" rows="8" placeholder="ì—¬ê¸°ì— ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”... (Enter=ì±„ì , Shift+Enter=ì¤„ë°”ê¿ˆ, Ctrl+[=ì´ì „ìœ„ì¹˜, Ctrl+]=í¬ì»¤ìŠ¤/í˜„í™©íŒ)"></textarea>

              <!-- ìŒì„±ì…ë ¥ ë²„íŠ¼: textarea ì˜¤ë¥¸ìª½ í•˜ë‹¨ì— floating -->
              <button id="record-btn" class="absolute bottom-2 right-2 p-2 min-w-[36px] bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition shadow-md flex items-center justify-center gap-0.5" data-state="idle" title="ìŒì„± ì…ë ¥ (STT)">
                <svg id="record-icon-mic" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 10-2 0 7.001 7.001 0 006 6.93V17H9a1 1 0 100 2h6a1 1 0 100-2h-2v-2.07z" clip-rule="evenodd" /></svg>
              </button>
            </div>

            <p id="error-message" class="text-red-500 text-sm mt-2 hidden">ë‹µì•ˆì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
            <p id="hotkey-guide" class="text-xs text-gray-500 mt-2">
              ë‹¨ì¶•í‚¤: Ctrl+â†/â†’ ì´ì „/ë‹¤ìŒ Â· Enter/G ì±„ì  Â· H íŒíŠ¸ Â· L ì´ì „ë‹µì•ˆ Â· R ëœë¤ Â· X ë³µìŠµì œì™¸ Â· S í˜„í™©íŒ Â· Ctrl+[ ì´ì „ìœ„ì¹˜ Â· Ctrl+] í¬ì»¤ìŠ¤
            </p>

            <!-- ì´ì „/ì±„ì í•˜ê¸°/ë‹¤ìŒ ë²„íŠ¼ (í•œ ì¤„) -->
            <div class="flex justify-between items-center my-5">
              <button id="prev-btn" class="bg-gray-200 text-gray-700 font-bold py-2 px-6 rounded-lg shadow-sm hover:bg-gray-300 transition disabled:opacity-50 disabled:cursor-not-allowed dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600 border dark:border-gray-600">ì´ì „</button>
              <button id="grade-btn" class="bg-green-500 text-white font-bold py-2 px-8 rounded-lg shadow-md hover:bg-green-600 transition duration-200 relative min-w-[120px]">
                <span id="grade-btn-text">ì±„ì í•˜ê¸°</span>
                <div id="grade-loader" class="loader absolute inset-0 m-auto hidden" aria-hidden="true"></div>
              </button>
              <button id="next-btn" class="bg-gray-200 text-gray-700 font-bold py-2 px-6 rounded-lg shadow-sm hover:bg-gray-300 transition disabled:opacity-50 disabled:cursor-not-allowed dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600 border dark:border-gray-600">ë‹¤ìŒ</button>
            </div>
          </div>

          <!-- ì±„ì  ê²°ê³¼ -->
          <div id="result-box" class="hidden bg-gray-50 border border-gray-200 rounded-lg p-6 mt-6 dark:bg-gray-800 dark:border-gray-700" aria-live="polite">
            <h3 class="text-2xl font-bold text-gray-900 mb-2 dark:text-gray-100">ì±„ì  ê²°ê³¼</h3>
            <div id="score-display" class="mb-5">
              <p class="text-lg font-medium text-gray-900 dark:text-gray-100">
                ìœ ì‚¬ë„ ì ìˆ˜: <span id="score" class="font-bold text-blue-600 text-2xl">0</span><span class="text-gray-600 dark:text-gray-400 text-lg">ì </span>
              </p>
              <div class="w-full bg-gray-200 progress-track rounded-full h-4 mt-2 overflow-hidden shadow-inner">
                <div id="progress-bar" class="h-4 rounded-full transition-all duration-500 ease-out" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" style="width: 0%"></div>
              </div>
            </div>
            <div>
              <h4 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2 flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" class="w-6 h-6 inline-block"><rect width="100" height="100" rx="20" fill="#6D28D9"/><rect x="20" y="20" width="60" height="60" rx="10" fill="white"/><circle cx="36" cy="43" r="9" fill="#8B5CF6"/><text x="36" y="46" font-size="14" fill="white" font-family="-apple-system,BlinkMacSystemFont,sans-serif" font-weight="900" text-anchor="middle" dominant-baseline="central">ã„±</text><g transform="translate(64, 43)"><path d="M0 0 L 4 10 L 14 14 L 4 18 L 0 28 L -4 18 L -14 14 L -4 10 Z" fill="#FACC15" transform="scale(0.8) translate(0, -14)"/></g><path d="M30 60 H 70 V 72 H 30 Z M35 60 V 72 M 40 60 V 72 M 45 60 V 72 M 50 60 V 72 M 55 60 V 72 M 60 60 V 72 M 65 60 V 72" fill="none" stroke="#4F46E5" stroke-width="2"/></svg>
                AI ì´í‰
              </h4>
              <div id="ai-feedback" class="bg-white dark:bg-gray-700 p-4 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-900 dark:text-gray-100 leading-relaxed min-h-[50px]"></div>
            </div>
          </div>

          <!-- ëª¨ë²” ë‹µì•ˆ -->
          <div id="model-answer-box" class="hidden bg-gray-50 border border-gray-200 rounded-lg p-6 mt-6 dark:bg-gray-800 dark:border-gray-700">
            <h4 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2">ğŸ“˜ ëª¨ë²” ë‹µì•ˆ</h4>
            <pre id="correct-answer" class="bg-white dark:bg-gray-700 p-4 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-900 dark:text-gray-100 text-sm font-sans leading-relaxed"></pre>
          </div>

          <!-- í•™ìŠµ í˜„í™©íŒ -->
          <div id="summary-area" class="mt-8 pt-6 border-t hidden">
            <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between mb-3">
              <h3 class="text-xl font-bold text-gray-800">í•™ìŠµ í˜„í™©íŒ (í´ë¦­í•˜ì—¬ ì´ë™)</h3>
              <div class="flex flex-wrap gap-3 items-center">
                <div class="flex items-center gap-2">
                  <span class="text-sm text-gray-600">ë³´ê¸°:</span>
                  <button id="summary-view-all" class="px-3 py-1.5 text-sm border rounded bg-gray-100 hover:bg-gray-200">ëª¨ë“  ë‹¨ì›ë³´ê¸°</button>
                  <button id="summary-view-current" class="px-3 py-1.5 text-sm border rounded">í˜„ì¬ í•™ìŠµë‹¨ì›ë³´ê¸°</button>
                </div>
                <div class="flex gap-4">
                  <button id="clear-filter-btn" class="text-sm text-blue-700 hover:underline dark:text-blue-300">í•„í„° í•´ì œ</button>
                  <button id="reset-scores-btn" class="text-sm text-red-600 hover:underline dark:text-red-300">í•™ìŠµ ê¸°ë¡ ì´ˆê¸°í™”</button>
                </div>
              </div>
            </div>
            <div id="score-summary" class="flex flex-wrap gap-2"></div>
          </div>
        </div>
      </main>

      <!-- RIGHT -->
      <aside id="right-explorer" class="lg:col-span-3 xl:col-span-3 2xl:col-span-3 space-y-4">
        <div class="bg-white rounded-2xl shadow-xl p-4">
          <div class="flex items-center justify-between mb-2 cursor-pointer" id="source-filter-toggle">
            <h3 class="font-bold text-lg">í•™ìŠµ ë²”ìœ„ í•„í„°</h3>
            <svg class="w-5 h-5 transition-transform duration-200" id="source-filter-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </div>
          <div id="source-filter-side" class="transition-all duration-200"></div>
        </div>
        <div class="bg-white rounded-2xl shadow-xl p-4">
          <div class="flex items-center justify-between mb-2 cursor-pointer" id="chapter-nav-toggle">
            <h3 class="font-bold text-lg">ë‹¨ì› ë„¤ë¹„ê²Œì´í„°</h3>
            <svg class="w-5 h-5 transition-transform duration-200" id="chapter-nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </div>
          <div id="explorer-chapters" class="space-y-2 transition-all duration-200"></div>
        </div>
        <div class="bg-white rounded-2xl shadow-xl p-4">
          <div class="flex items-center justify-between mb-2">
            <h3 class="font-bold text-lg whitespace-nowrap no-kr-break">ë¬¸ì œ ëª©ë¡</h3>
            <input id="explorer-search" name="explorer-search" class="border rounded px-2 py-1 text-sm" placeholder="ê²€ìƒ‰..." aria-label="ë¬¸ì œ ê²€ìƒ‰">
          </div>
          <div id="explorer-problems" class="space-y-1 max-h-[60vh] overflow-y-auto pr-1"></div>
        </div>
      </aside>
    </div>
  </div>

  <!-- API í‚¤ ëª¨ë‹¬ -->
  <div id="api-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-[1000]">
    <div class="bg-white rounded-2xl w-full max-w-md p-6 shadow-xl">
      <h2 class="text-xl font-bold text-gray-800">Gemini API í‚¤ ì¸ì¦</h2>
      <p class="text-sm text-gray-600 mt-1">ìµœì´ˆ 1íšŒë§Œ ì…ë ¥í•©ë‹ˆë‹¤. ë¡œì»¬ ì €ì¥ì„ ì²´í¬í•˜ë©´ ë‹¤ìŒë¶€í„°ëŠ” íŒì—…ì´ ëœ¨ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
      <p class="text-sm mt-2">ì²˜ìŒ ì‚¬ìš©í•˜ì‹œë‚˜ìš”?
        <a href="README.html" target="_blank" rel="noopener" class="underline text-blue-600 dark:text-blue-300">ë„ì›€ë§(README)</a>ë¥¼ í™•ì¸í•˜ì„¸ìš”.
      </p>

      <form id="api-key-form">
        <label for="api-modal-input" class="block text-sm font-medium text-gray-700 mt-4">ğŸ”‘ API Key</label>
        <input type="password" id="api-modal-input" name="api-key"
               class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:text-gray-100 dark:placeholder-gray-400 dark:border-gray-700"
               placeholder="Google AI Studio API í‚¤" autocomplete="off" spellcheck="false" inputmode="text" />

        <div class="flex items-center gap-2 mt-2">
          <input type="checkbox" id="modal-remember" name="remember-api-key" class="rounded border-gray-300" />
          <label for="modal-remember" class="text-sm text-gray-700">ì´ ë¸Œë¼ìš°ì €ì— í‚¤ ì €ì¥</label>
        </div>
        <p class="text-xs text-yellow-600 mt-1">âš ï¸ ê³µìš© PCì—ì„œëŠ” ì²´í¬ í•´ì œë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.</p>

        <div class="mt-5 flex justify-end gap-2">
          <button type="button" id="api-cancel-btn" class="px-3 py-2 text-sm text-gray-600 hover:text-gray-900">ì·¨ì†Œ</button>
          <button type="submit" id="api-save-btn" class="px-4 py-2 bg-blue-600 text-white text-sm font-semibold rounded-lg hover:bg-blue-700">ì €ì¥</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ì—…ì  ëª¨ë‹¬ -->
  <div id="achievements-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-[1002] p-4 overflow-y-auto">
    <div role="dialog" aria-modal="true" aria-labelledby="achievements-title" class="bg-white dark:bg-gray-900 dark:text-gray-100 rounded-2xl w-full max-w-4xl shadow-xl max-h-[90vh] overflow-y-auto">
      <div class="sticky top-0 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 px-6 py-4 flex items-center justify-between rounded-t-2xl">
        <h2 id="achievements-title" class="text-2xl font-bold">ğŸ† ë‚˜ì˜ ì—…ì </h2>
        <button id="achievements-close-btn" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 text-2xl leading-none" aria-label="ë‹«ê¸°">Ã—</button>
      </div>

      <div class="p-6">
        <!-- ì—…ì  í†µê³„ -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
          <div class="bg-gradient-to-br from-yellow-50 to-amber-50 dark:from-gray-800 dark:to-gray-700 rounded-lg p-4 text-center border border-yellow-200 dark:border-gray-600">
            <div class="text-3xl font-bold text-yellow-600 dark:text-yellow-400"><span id="achievement-count-total">0</span></div>
            <div class="text-sm text-gray-600 dark:text-gray-400">ì „ì²´ ì—…ì </div>
          </div>
          <div class="bg-gradient-to-br from-green-50 to-emerald-50 dark:from-gray-800 dark:to-gray-700 rounded-lg p-4 text-center border border-green-200 dark:border-gray-600">
            <div class="text-3xl font-bold text-green-600 dark:text-green-400"><span id="achievement-count-unlocked">0</span></div>
            <div class="text-sm text-gray-600 dark:text-gray-400">ë‹¬ì„± ì™„ë£Œ</div>
          </div>
          <div class="bg-gradient-to-br from-blue-50 to-sky-50 dark:from-gray-800 dark:to-gray-700 rounded-lg p-4 text-center border border-blue-200 dark:border-gray-600">
            <div class="text-3xl font-bold text-blue-600 dark:text-blue-400"><span id="achievement-progress-percent">0</span>%</div>
            <div class="text-sm text-gray-600 dark:text-gray-400">ë‹¬ì„±ë¥ </div>
          </div>
          <div class="bg-gradient-to-br from-purple-50 to-violet-50 dark:from-gray-800 dark:to-gray-700 rounded-lg p-4 text-center border border-purple-200 dark:border-gray-600">
            <div class="text-3xl font-bold text-purple-600 dark:text-purple-400"><span id="achievement-points">0</span>P</div>
            <div class="text-sm text-gray-600 dark:text-gray-400">ì—…ì  í¬ì¸íŠ¸</div>
          </div>
        </div>

        <!-- í‹°ì–´ í•„í„° -->
        <div class="flex gap-2 mb-4 overflow-x-auto pb-2">
          <button class="achievement-tier-filter px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600" data-tier="all">ì „ì²´</button>
          <button class="achievement-tier-filter px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400 hover:bg-amber-200" data-tier="bronze">ğŸ¥‰ ë¸Œë¡ ì¦ˆ</button>
          <button class="achievement-tier-filter px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap bg-gray-300 text-gray-800 dark:bg-gray-600 dark:text-gray-200 hover:bg-gray-400" data-tier="silver">ğŸ¥ˆ ì‹¤ë²„</button>
          <button class="achievement-tier-filter px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400 hover:bg-yellow-200" data-tier="gold">ğŸ¥‡ ê³¨ë“œ</button>
          <button class="achievement-tier-filter px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400 hover:bg-purple-200" data-tier="hidden">ğŸ¤« íˆë“ </button>
        </div>

        <!-- ì—…ì  ë¦¬ìŠ¤íŠ¸ -->
        <div id="achievements-list" class="space-y-3"></div>
      </div>
    </div>
  </div>

  <!-- ì„¤ì • ëª¨ë‹¬ -->
  <div id="settings-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-[1001]">
    <div role="dialog" aria-modal="true" aria-labelledby="settings-title" class="bg-white dark:bg-gray-900 dark:text-gray-100 rounded-2xl w-full max-w-2xl p-6 shadow-xl max-h-[90vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-2">
        <h2 id="settings-title" class="text-2xl font-bold">ì„¤ì • âš™ï¸</h2>
        <button id="settings-close-btn" class="text-gray-500 hover:text-gray-800 dark:hover:text-white" aria-label="ë‹«ê¸°">âœ•</button>
      </div>

      <div class="mb-6 pb-6 border-b">
        <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-200 mb-3">API í‚¤ ì„¤ì •</h3>
        <button id="open-api-key-modal-btn" class="w-full bg-blue-50 border border-blue-300 text-blue-700 font-medium py-2 px-4 rounded-lg hover:bg-blue-100 transition">API í‚¤ ë³€ê²½/ì„¤ì •</button>
      </div>

      <div class="mb-6 pb-6 border-b">
        <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-200 mb-3">ğŸ“… ì‹œí—˜ ë‚ ì§œ (D-DAY)</h3>
        <input type="date" id="exam-date-input" name="exam-date" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100" aria-label="ì‹œí—˜ ë‚ ì§œ (D-DAY)" />
        <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">ì‹œí—˜ ë‚ ì§œë¥¼ ì„¤ì •í•˜ë©´ ìƒë‹¨ë°”ì— D-DAYê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>
        <button id="save-exam-date-btn" class="mt-3 w-full bg-red-50 border border-red-300 text-red-700 font-medium py-2 px-4 rounded-lg hover:bg-red-100 transition">D-DAY ì €ì¥</button>
      </div>

      <div class="mb-6 pb-6 border-b">
        <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-200 mb-3">AI ëª¨ë¸ ì„ íƒ</h3>
        <select id="ai-model-select" name="ai-model" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700" aria-label="AI ëª¨ë¸ ì„ íƒ">
          <option value="gemini-2.5-flash">Gemini 2.5 Flash (ê¸°ë³¸)</option>
          <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash-Lite (ê²½ëŸ‰)</option>
        </select>
        <p class="text-xs text-gray-500 mt-2">íŒíŠ¸ ë° ì±„ì ì— ì‚¬ìš©ë  AI ëª¨ë¸ì„ ì„ íƒí•˜ì„¸ìš”.</p>
      </div>

      <div class="mb-6 pb-6 border-b">
        <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-200 mb-3">ğŸ™ï¸ ìŒì„± ì¸ì‹ (STT) ì„¤ì •</h3>

        <label for="stt-provider-select" class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2">ê³µê¸‰ì ì„ íƒ</label>
        <select id="stt-provider-select" name="stt-provider" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700" aria-label="STT ê³µê¸‰ì ì„ íƒ">
          <option value="none">ì‚¬ìš© ì•ˆ í•¨ (ê¸°ë³¸)</option>
          <option value="webspeech">Web Speech API (ë¬´ë£Œ, ì‹¤ì‹œê°„) âš¡</option>
          <option value="google">Google Cloud STT (ê³ ì •í™•ë„, ìœ ë£Œ)</option>
        </select>
        <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">
          <strong>Web Speech:</strong> ë¸Œë¼ìš°ì € ë‚´ì¥, ë¬´ë£Œ, ì‹¤ì‹œê°„ (Chrome/Edge ê¶Œì¥)<br>
          <strong>Google STT:</strong> ê³ ì •í™•ë„, API í‚¤ í•„ìš”, ì²˜ë¦¬ ì‹œê°„ ìˆìŒ
        </p>
        <p class="text-xs text-yellow-600 dark:text-yellow-400 mt-1">âš ï¸ STT API ì‚¬ìš©ì— ë”°ë¥¸ ë¹„ìš©ì€ ì‚¬ìš©ì ê°œì¸ì—ê²Œ ì²­êµ¬ë©ë‹ˆë‹¤.</p>

        <div id="stt-google-settings" class="mt-4 hidden">
          <form id="google-stt-form">
            <label for="google-stt-key" class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2">Google STT API Key</label>
            <input type="password" id="google-stt-key" name="google-stt-key" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:text-gray-100 dark:placeholder-gray-400 dark:border-gray-700" placeholder="Google STT API í‚¤" autocomplete="off">
          </form>
        </div>
      </div>

      <div class="mb-6 pb-6 border-b">
        <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-200 mb-3">ë‹¤í¬ ëª¨ë“œ</h3>
        <select id="dark-mode-select" name="dark-mode" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700" aria-label="ë‹¤í¬ ëª¨ë“œ">
          <option value="system">ì‹œìŠ¤í…œ ì„¤ì • (ê¸°ë³¸)</option>
          <option value="light">ë¼ì´íŠ¸ ëª¨ë“œ</option>
          <option value="dark">ë‹¤í¬ ëª¨ë“œ</option>
        </select>
      </div>

      <!-- Task 3: ë³µìŠµ ê¸°ì¤€ ì„¤ì • -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-200 mb-3">ë³µìŠµ ê¸°ì¤€ ì„¤ì •</h3>
        <select id="review-mode-select" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
          <option value="hlr">HLR ê¸°ë°˜ (ì¶”ì²œ) - ë§ê° ê³¡ì„  ê¸°ë°˜ ì§€ëŠ¥í˜• ë³µìŠµ</option>
          <option value="time">ì‹œê°„ ê¸°ë°˜ (ê¸°ì¡´) - 3ì¼/10ì¼ ê¸°ì¤€ ë‹¨ìˆœ ë¶„ë¥˜</option>
        </select>
        <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">
          HLR(ë§ê° ê³¡ì„ ) ê¸°ë°˜ì€ ê°œì¸ë³„ í•™ìŠµ íŒ¨í„´ì„ ë¶„ì„í•˜ì—¬ ìµœì ì˜ ë³µìŠµ ì‹œê¸°ë¥¼ ì œì•ˆí•©ë‹ˆë‹¤.
        </p>
      </div>

      <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-200 mb-3">ë°ì´í„° ê´€ë¦¬</h3>
        <div class="flex gap-3 mb-2">
          <button id="export-data-btn" class="flex-1 bg-green-50 border border-green-300 text-green-700 font-medium py-2 px-4 rounded-lg hover:bg-green-100 transition">ğŸ“¥ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
          <button id="import-data-btn" class="flex-1 bg-yellow-50 border border-yellow-300 text-yellow-700 font-medium py-2 px-4 rounded-lg hover:bg-yellow-100 transition">ğŸ“¤ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</button>
        </div>
        <div class="flex gap-3">
          <button id="merge-data-btn" class="flex-1 bg-blue-50 border border-blue-300 text-blue-700 font-medium py-2 px-4 rounded-lg hover:bg-blue-100 transition">ğŸ”€ ë°ì´í„° ë³‘í•© ê°€ì ¸ì˜¤ê¸°</button>
        </div>
        <input type="file" id="import-file-input" name="import-data-file" accept=".json" class="hidden" aria-label="ë°ì´í„° ê°€ì ¸ì˜¤ê¸° íŒŒì¼ ì„ íƒ" />
        <input type="file" id="merge-file-input" name="merge-data-file" accept=".json" class="hidden" aria-label="ë°ì´í„° ë³‘í•© íŒŒì¼ ì„ íƒ" />
        <p class="text-xs text-gray-500 mt-2">í•™ìŠµ ê¸°ë¡ ë° ì„¤ì •ì„ ë°±ì—…í•˜ê±°ë‚˜ ë³µì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³‘í•© ê°€ì ¸ì˜¤ê¸°ëŠ” ê¸°ì¡´ ë°ì´í„°ì™€ ìƒˆ ë°ì´í„°ë¥¼ í•©ì¹©ë‹ˆë‹¤.</p>
      </div>

      <div class="flex justify-end">
        <button id="settings-close-btn-bottom" class="px-6 py-2 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300 transition dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600 border dark:border-gray-600">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

  <!-- Deep-Learning Report ëª¨ë‹¬ -->
  <div id="report-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-[1002] p-4 overflow-y-auto">
    <div role="dialog" aria-modal="true" aria-labelledby="report-title" class="bg-white dark:bg-gray-900 dark:text-gray-100 rounded-2xl w-full max-w-5xl shadow-xl max-h-[90vh] overflow-y-auto" style="-webkit-overflow-scrolling: touch;">
      <!-- í—¤ë” -->
      <div class="sticky top-0 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 p-6 z-10">
  <div class="flex items-center justify-between mb-4">
    
    <h2 id="report-title" class="text-2xl font-bold text-gray-900 dark:text-white">ğŸ“Š ë”¥-ëŸ¬ë‹ ë¦¬í¬íŠ¸ (Deep-Learning Report)</h2>

    <button id="report-close-btn" class="text-gray-500 hover:text-gray-800 dark:hover:text-white text-2xl" aria-label="ë‹«ê¸°">âœ•</button>
  </div>
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3">
          <div class="flex flex-col sm:flex-row sm:flex-wrap sm:items-center gap-3">
            <div class="flex items-center gap-2">
              <label for="report-period-select" class="text-sm font-medium whitespace-nowrap">ë°ì´í„° ë²”ìœ„:</label>
              <select id="report-period-select" name="report-period" class="px-3 py-1.5 text-sm border rounded-lg dark:bg-gray-800 dark:border-gray-700">
                <option value="30">ìµœê·¼ 30ì¼</option>
                <option value="60">ìµœê·¼ 60ì¼</option>
                <option value="90">ìµœê·¼ 90ì¼</option>
                <option value="all">ì „ì²´ ê¸°ê°„</option>
              </select>
            </div>
            <div class="flex items-center gap-2">
              <label for="report-threshold-select" class="text-sm font-medium whitespace-nowrap">ë¶„ì„ ëŒ€ìƒ:</label>
              <select id="report-threshold-select" name="report-threshold" class="px-3 py-1.5 text-sm border rounded-lg dark:bg-gray-800 dark:border-gray-700">
                <option value="60">60ì  ë¯¸ë§Œ</option>
                <option value="70">70ì  ë¯¸ë§Œ</option>
                <option value="80">80ì  ë¯¸ë§Œ</option>
              </select>
            </div>
          </div>
          <div class="flex items-center gap-2 flex-wrap">
            <button id="report-refresh-btn" class="px-3 py-1.5 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 whitespace-nowrap">ìƒˆë¡œê³ ì¹¨</button>
            <button id="report-save-snapshot-btn" class="px-3 py-1.5 text-sm border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 whitespace-nowrap">ğŸ’¾ ì €ì¥</button>
            <button id="report-load-snapshot-btn" class="px-3 py-1.5 text-sm border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 whitespace-nowrap">ğŸ“‚ ë¶ˆëŸ¬ì˜¤ê¸°</button>
            <input type="file" id="report-load-snapshot-input" name="report-load-snapshot" accept=".json" style="display: none;" aria-label="ë¦¬í¬íŠ¸ ìŠ¤ëƒ…ìƒ· íŒŒì¼ ì„ íƒ">
            <button id="report-print-btn" class="px-3 py-1.5 text-sm border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 whitespace-nowrap">ğŸ“¤ ë‚´ë³´ë‚´ê¸°/ê³µìœ </button>
          </div>
        </div>
      </div>

      <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
      <div class="border-b border-gray-200 dark:border-gray-700 px-6">
        <nav class="flex gap-4" role="tablist">
          <button id="report-tab-1" class="report-tab py-3 px-4 font-medium border-b-2 border-blue-600 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white" role="tab" aria-selected="true" data-tab="1">1. ìš”ì•½ ë° ì°¨íŠ¸</button>
          <button id="report-tab-2" class="report-tab py-3 px-4 font-medium border-b-2 border-transparent text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white" role="tab" aria-selected="false" data-tab="2">2. AI ì‹¬ì¸µ ë¶„ì„</button>
          <button id="report-tab-3" class="report-tab py-3 px-4 font-medium border-b-2 border-transparent text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white" role="tab" aria-selected="false" data-tab="3">3. ì•¡ì…˜ í”Œëœ</button>
          <button id="report-tab-4" class="report-tab py-3 px-4 font-medium border-b-2 border-transparent text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white" role="tab" aria-selected="false" data-tab="4">4. ì¼ì¼ í•™ìŠµ ê¸°ë¡</button>
        </nav>
      </div>

      <!-- íƒ­ ì½˜í…ì¸  -->
      <div class="p-6">
        <!-- íƒ­ 1: ìš”ì•½ ë° ì°¨íŠ¸ -->
        <div id="report-content-1" class="report-content">
          <div class="space-y-6">
            <div>
              <div class="flex justify-between items-center mb-3">
                <h3 class="text-lg font-bold">í•™ìŠµ ì„±ê³¼ ì¶”ì´</h3>
                <div class="flex items-center gap-2">
                  <label for="chart-scope-select" class="text-sm text-gray-600 dark:text-gray-400">ì°¨íŠ¸ ìŠ¤ì½”í”„:</label>
                  <select id="chart-scope-select" name="chart-scope" class="px-2 py-1 text-sm border rounded-lg dark:bg-gray-800 dark:border-gray-700">
                    <option value="daily">ì¼ê°„</option>
                    <option value="weekly">ì£¼ê°„</option>
                    <option value="monthly">ì›”ê°„</option>
                  </select>
                </div>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="border rounded-lg p-4">
                  <h4 class="text-sm font-semibold mb-2">ì¼ì¼ í•™ìŠµëŸ‰</h4>
                  <canvas id="chart-daily-volume"></canvas>
                </div>
                <div class="border rounded-lg p-4">
                  <div class="flex justify-between items-center mb-2">
                    <h4 class="text-sm font-semibold">ì „ì²´ ì ìˆ˜ ì¶”ì´</h4>
                    <a href="trendhelp.html" target="_blank" class="text-xs text-blue-600 hover:underline dark:text-blue-400">ë„ì›€ë§</a>
                  </div>
                  <canvas id="chart-score-trend"></canvas>
                </div>
              </div>
            </div>
            <div>
              <h3 class="text-lg font-bold mb-3">ë‹¨ì›ë³„ ì·¨ì•½ì  ë¶„ì„</h3>
              <div class="border rounded-lg p-4 overflow-x-auto">
                <canvas id="chart-chapter-weakness"></canvas>
              </div>
              <div id="chapter-detail-chart" class="hidden border rounded-lg p-4 mt-4">
                <h4 class="text-sm font-semibold mb-2">ì„ íƒí•œ ë‹¨ì›ì˜ ì ìˆ˜ ì¶”ì´</h4>
                <canvas id="chart-chapter-detail"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- íƒ­ 2: AI ì‹¬ì¸µ ë¶„ì„ -->
        <div id="report-content-2" class="report-content hidden">
          <div class="text-center py-8">
            <button id="ai-analysis-start-btn" class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-medium flex items-center gap-2 mx-auto">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" class="w-5 h-5 inline-block"><rect width="100" height="100" rx="20" fill="#8B5CF6"/><rect x="20" y="20" width="60" height="60" rx="10" fill="white"/><circle cx="36" cy="43" r="9" fill="#A78BFA"/><text x="36" y="46" font-size="14" fill="white" font-family="-apple-system,BlinkMacSystemFont,sans-serif" font-weight="900" text-anchor="middle" dominant-baseline="central">ã„±</text><g transform="translate(64, 43)"><path d="M0 0 L 4 10 L 14 14 L 4 18 L 0 28 L -4 18 L -14 14 L -4 10 Z" fill="#FDE047" transform="scale(0.8) translate(0, -14)"/></g><path d="M30 60 H 70 V 72 H 30 Z M35 60 V 72 M 40 60 V 72 M 45 60 V 72 M 50 60 V 72 M 55 60 V 72 M 60 60 V 72 M 65 60 V 72" fill="none" stroke="#7C3AED" stroke-width="2"/></svg>
              Gemini Proë¡œ ì‹¬ì¸µ ë¶„ì„ ì‹œì‘
            </button>
            <p class="text-sm text-gray-700 dark:text-gray-300 mt-2">AIê°€ ì˜¤ë‹µ íŒ¨í„´ê³¼ ê°œë… ì•½ì ì„ ë¶„ì„í•©ë‹ˆë‹¤</p>
          </div>
          <div id="ai-analysis-result" class="hidden">
            <div class="flex justify-end mb-4">
              <button id="ai-analysis-copy-btn" class="px-4 py-2 text-sm border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800">ğŸ“‹ ë¶„ì„ ë‚´ìš© ë³µì‚¬</button>
            </div>
            <div class="border rounded-lg p-6 bg-white dark:bg-gray-800">
              <div id="ai-error-pattern" class="prose max-w-none dark:prose-invert !text-black dark:!text-white whitespace-pre-wrap"></div>
            </div>
          </div>
          <div id="ai-analysis-loading" class="hidden text-center py-12">
            <div class="loader mx-auto mb-4"></div>
            <p class="text-gray-600">AIê°€ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
          </div>
        </div>

        <!-- íƒ­ 3: ì•¡ì…˜ í”Œëœ -->
        <div id="report-content-3" class="report-content hidden">
          <div class="space-y-6">
            <div class="border rounded-lg p-6">
              <h3 class="text-lg font-bold mb-3">ë§ê° ê³¡ì„  ê¸°ë°˜ ë³µìŠµ í”Œë˜ë„ˆ</h3>
              <div class="space-y-4">
                <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4">
                  <h4 class="font-semibold text-red-700 dark:text-red-400 mb-2">ğŸš¨ ê¸´ê¸‰ ë³µìŠµ (ì˜¤ëŠ˜ ì¦‰ì‹œ)</h4>
                  <div id="action-urgent-list" class="space-y-1"></div>
                </div>
                <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4">
                  <h4 class="font-semibold text-yellow-700 dark:text-yellow-400 mb-2">âš ï¸ ì£¼ê¸°ì  ë³µìŠµ (ì´ë²ˆ ì£¼ ë‚´)</h4>
                  <div id="action-weekly-list" class="space-y-1"></div>
                </div>
                <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4">
                  <h4 class="font-semibold text-green-700 dark:text-green-400 mb-2">ğŸ§  ì¥ê¸° ê¸°ì–µí™” (ë‹¤ìŒ ì£¼)</h4>
                  <div id="action-longterm-list" class="space-y-1"></div>
                </div>
              </div>
            </div>
            <div class="border rounded-lg p-6">
              <h3 class="text-lg font-bold mb-3">ì¸í„°ë™í‹°ë¸Œ ì˜¤ë‹µë…¸íŠ¸</h3>
              <p class="text-sm text-gray-700 dark:text-gray-300 mb-4">í´ë¦­í•˜ì—¬ ëª¨ë²” ë‹µì•ˆê³¼ AI ì´í‰ì„ í™•ì¸í•˜ì„¸ìš”</p>
              <div id="action-wrong-answers" class="space-y-3"></div>
            </div>
          </div>
        </div>

        <!-- íƒ­ 4: ì¼ì¼ í•™ìŠµ ê¸°ë¡ -->
        <div id="report-content-4" class="report-content hidden">
          <div class="space-y-6">
            <div class="border rounded-lg p-6">
              <div id="daily-record-nav" class="flex items-center justify-between mb-4 pb-4 border-b">
                <button id="daily-prev-btn" class="text-xl px-3 py-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700" aria-label="ì´ì „ ë‚ ì§œ">â—€</button>
                <h3 id="daily-record-date" class="text-lg font-bold text-gray-900 dark:text-white"></h3>
                <button id="daily-next-btn" class="text-xl px-3 py-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700" aria-label="ë‹¤ìŒ ë‚ ì§œ">â–¶</button>
              </div>
              <div id="daily-problem-list" class="space-y-3">
                <!-- ì¼ì¼ í•™ìŠµ ê¸°ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë Œë”ë§ë©ë‹ˆë‹¤ -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- PDF ì˜µì…˜ ì„ íƒ ëª¨ë‹¬ (Task 2: ì„ íƒí˜• PDF ë‚´ë³´ë‚´ê¸°) -->
  <div id="pdf-options-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center" style="z-index: 99999;">
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 max-w-md w-full mx-4">
      <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">ğŸ“¤ ë‚´ë³´ë‚´ê¸° ì˜µì…˜ ì„ íƒ</h3>

      <!-- ì „ì²´ ì„ íƒ/í•´ì œ -->
      <div class="mb-3 pb-3 border-b border-gray-200 dark:border-gray-700">
        <label class="flex items-center gap-2 cursor-pointer">
          <input type="checkbox" id="pdf-check-all" class="w-4 h-4 rounded" checked>
          <span class="font-semibold text-gray-700 dark:text-gray-300">ì „ì²´ ì„ íƒ</span>
        </label>
      </div>

      <!-- ê°œë³„ íƒ­ ì„ íƒ -->
      <div class="space-y-3 mb-6">
        <label class="flex items-center gap-2 cursor-pointer">
          <input type="checkbox" id="pdf-check-tab1" class="pdf-tab-checkbox w-4 h-4 rounded" checked>
          <span class="text-gray-700 dark:text-gray-300">ğŸ“Š ì°¨íŠ¸ ë¶„ì„</span>
        </label>
        <label class="flex items-center gap-2 cursor-pointer">
          <input type="checkbox" id="pdf-check-tab2" class="pdf-tab-checkbox w-4 h-4 rounded" checked>
          <span class="text-gray-700 dark:text-gray-300">ğŸ§  AI ì‹¬ì¸µ ë¶„ì„</span>
        </label>
        <label class="flex items-center gap-2 cursor-pointer">
          <input type="checkbox" id="pdf-check-tab3" class="pdf-tab-checkbox w-4 h-4 rounded" checked>
          <span class="text-gray-700 dark:text-gray-300">ğŸ“ ì•¡ì…˜ í”Œëœ & ì˜¤ë‹µë…¸íŠ¸</span>
        </label>
        <label class="flex items-center gap-2 cursor-pointer">
          <input type="checkbox" id="pdf-check-tab4" class="pdf-tab-checkbox w-4 h-4 rounded">
          <span class="text-gray-700 dark:text-gray-300">ğŸ“… ì¼ì¼ í•™ìŠµ ê¸°ë¡</span>
        </label>
      </div>

      <!-- ë²„íŠ¼ -->
      <div class="flex gap-3">
        <button id="pdf-options-cancel-btn" class="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700">
          ì·¨ì†Œ
        </button>
        <button id="pdf-options-execute-btn" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
          ì‹¤í–‰
        </button>
      </div>

      <p class="text-xs text-gray-500 dark:text-gray-400 mt-4">
        â„¹ï¸ ì„ íƒí•œ íƒ­ë§Œ PDFë¡œ ë‚´ë³´ëƒ…ë‹ˆë‹¤. ë¸Œë¼ìš°ì €ì˜ ì¸ì‡„ ëŒ€í™”ìƒìì—ì„œ "PDFë¡œ ì €ì¥"ì„ ì„ íƒí•˜ì„¸ìš”.
      </p>
    </div>
  </div>

  <!-- ë‚´ì¥ ë°ì´í„°(JSON) - Phase 0: localStorage ë°±ì—… ì‹œìŠ¤í…œ ë„ì…ìœ¼ë¡œ ì£¼ì„ ì²˜ë¦¬ -->
  <!--
    ì•ˆì „ì„± í™•ë³´ë¥¼ ìœ„í•´ ì œê±°í•˜ì§€ ì•Šê³  ì£¼ì„ ì²˜ë¦¬
    3ë‹¨ê³„ í´ë°± ì‹œìŠ¤í…œ: ì™¸ë¶€ JSON â†’ localStorage ë°±ì—… â†’ ë‚´ì¥ ë°ì´í„°(ë¹„í™œì„±í™”)
  -->
  <!--
  <script id="dataset-json" type="application/json">[
    {"ê³ ìœ ID":"q_001","í‘œì‹œë²ˆí˜¸":"1","ì¶œì²˜":"S","problemTitle":"íšŒê³„ê°ì‚¬ì˜ ê³ ìœ í•œê³„ ì›ì¸ ì„¸ ê°€ì§€","ë‹¨ì›":1,"ë¬¼ìŒë²ˆí˜¸":1,"ë¬¼ìŒ":"íšŒê³„ê°ì‚¬ì—ëŠ” ê³ ìœ í•œê³„ê°€ ì¡´ì¬í•œë‹¤. ê·¸ ì›ì¸ì„ ì„¸ ê°€ì§€ ì“°ì‹œì˜¤.","ì •ë‹µ":"ISA 200-A47 â‘  ì¬ë¬´ë³´ê³ ì˜ ì„±ê²© â‘¡ ê°ì‚¬ì ˆì°¨ì˜ ì„±ê²© â‘¢ í•©ë¦¬ì  ì‹œê°„Â·ë¹„ìš© ì œì•½"},
    {"ê³ ìœ ID":"q_002","í‘œì‹œë²ˆí˜¸":"2","ì¶œì²˜":"H","problemTitle":"ì ì‹œì„±ê³¼ ë¹„ìš©-íš¨ìµ ê³ ë ¤ ì‹œ ì±„íƒí•˜ëŠ” ì ˆì°¨","ë‹¨ì›":1,"ë¬¼ìŒë²ˆí˜¸":2,"ë¬¼ìŒ":"ê°ì‚¬ì¸ì€ ì ì‹œì„±ê³¼ ë¹„ìš©-íš¨ìµ ê· í˜•ì„ ê³ ë ¤í•œë‹¤. ì´ì— ë”°ë¼ ì±„íƒí•˜ëŠ” ì ˆì°¨ ì„¸ ê°€ì§€ëŠ”?","ì •ë‹µ":"ISA 200-A51 â‘  íš¨ê³¼ì  ê³„íš â‘¡ ìœ„í—˜ ë†’ì€ ë¶„ì•¼ ì§‘ì¤‘ â‘¢ í…ŒìŠ¤íŠ¸ ë“± í‘œë³¸ ì‚¬ìš©"},
    {"ê³ ìœ ID":"q_003","í‘œì‹œë²ˆí˜¸":"3","ì¶œì²˜":"SS","problemTitle":"ìƒ˜í”Œ ë¬¸ì œ","ë‹¨ì›":1,"ë¬¼ìŒë²ˆí˜¸":3,"ë¬¼ìŒ":"â€¦","ì •ë‹µ":"â€¦"}
  ]</script>
  -->

  <!-- ========================================
       ê°ë¦°ì´ v4.0 ë¦¬íŒ©í† ë§ ëª¨ë“ˆ ë¡œë“œ (ë¨¼ì € ë¡œë“œë¨)
       ======================================== -->
  <script type="module" src="js/app.js"></script>

  <script type="module">
    // ========================================
    // Phase 5.2: ëª¨ë“ˆ ì§ì ‘ import (ì „ì—­ ë¸Œë¦¿ì§€ ì œê±°)
    // ========================================
    // app.jsëŠ” StateManager ì´ˆê¸°í™”ë¥¼ ìœ„í•´ ì—¬ì „íˆ í•„ìš”
    import './js/app.js';

    // ì§ì ‘ ëª¨ë“ˆ import (window.* ì˜ì¡´ì„± ì œê±°)
    import { $ } from './js/ui/elements.js';
    import { showToast, applyDarkMode, initUIListeners } from './js/ui/domUtils.js';
    import { loadData } from './js/core/dataManager.js';
    import { getAllData, getSelectedAiModel } from './js/core/stateManager.js';
    import {
      initStatsDate,
      updateDDayDisplay,
      migrateData,
      enforceExclusiveFlagsOnAll,
      backfillReadStoreFromScores
    } from './js/core/storageManager.js';
    import { initSettings, ensureApiKeyGate, initSettingsListeners } from './js/features/settings/settingsCore.js';
    // Phase 2: dataImportExport.jsëŠ” lazy loading
    import { initReportListeners } from './js/features/report/reportCore.js';
    // Phase 2: analysis.jsëŠ” lazy loading
    // Phase 2: flashcardCore.jsëŠ” lazy loading
    import { buildSourceFilterUI, initFilterListeners } from './js/features/filter/filterCore.js';
    import { moveSourceFilterToSide, initExplorerListeners, renderExplorer } from './js/features/explorer/explorerCore.js';
    import { initQuizListeners } from './js/features/quiz/quizCore.js';
    import { initCalendarListeners, renderCalendarMonth, renderStats } from './js/features/calendar/calendarCore.js';
    import { initKeyboardShortcuts } from './js/features/quiz/navigation.js';
    import {
      initAchievementListeners,
      loadAchievements,
      checkAchievements,
      updateAchievementBadge
    } from './js/features/achievements/achievementsCore.js';
    import { initReviewListeners } from './js/features/review/reviewCore.js';
    import { initSttListeners } from './js/features/stt/sttHandler.js';

    // Phase 2: Lazy Loading ëª¨ë“ˆ ê´€ë¦¬
    let aiAnalysisModule = null;
    let flashcardModule = null;
    let dataImportExportModule = null;

    /**
     * Phase 2: AI ë¶„ì„ ëª¨ë“ˆ Lazy Loading
     */
    async function loadAIAnalysisModule() {
      if (aiAnalysisModule) return aiAnalysisModule;

      try {
        aiAnalysisModule = await import('./js/features/report/analysis.js');
        aiAnalysisModule.initAIAnalysisListeners();
        console.log('âœ… [Lazy] AI ë¶„ì„ ëª¨ë“ˆ ë¡œë“œ ì™„ë£Œ');
        return aiAnalysisModule;
      } catch (err) {
        console.error('âŒ [Lazy] AI ë¶„ì„ ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨:', err);
        showToast('AI ë¶„ì„ ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨', 'error');
        throw err;
      }
    }

    /**
     * Phase 2: í”Œë˜ì‹œì¹´ë“œ ëª¨ë“ˆ Lazy Loading
     */
    async function loadFlashcardModule() {
      if (flashcardModule) return flashcardModule;

      try {
        flashcardModule = await import('./js/features/flashcard/flashcardCore.js');
        flashcardModule.initFlashcardListeners();
        console.log('âœ… [Lazy] í”Œë˜ì‹œì¹´ë“œ ëª¨ë“ˆ ë¡œë“œ ì™„ë£Œ');
        return flashcardModule;
      } catch (err) {
        console.error('âŒ [Lazy] í”Œë˜ì‹œì¹´ë“œ ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨:', err);
        showToast('í”Œë˜ì‹œì¹´ë“œ ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨', 'error');
        throw err;
      }
    }

    /**
     * Phase 2: ë°ì´í„° Import/Export ëª¨ë“ˆ Lazy Loading
     */
    async function loadDataImportExportModule() {
      if (dataImportExportModule) return dataImportExportModule;

      try {
        dataImportExportModule = await import('./js/services/dataImportExport.js');
        dataImportExportModule.initDataImportExport();
        console.log('âœ… [Lazy] ë°ì´í„° Import/Export ëª¨ë“ˆ ë¡œë“œ ì™„ë£Œ');
        return dataImportExportModule;
      } catch (err) {
        console.error('âŒ [Lazy] ë°ì´í„° Import/Export ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨:', err);
        showToast('ë°ì´í„° Import/Export ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨', 'error');
        throw err;
      }
    }

    // Phase 5.3: ëª¨ë“  ë¡œì§ì€ ëª¨ë“ˆë¡œ ì´ë™ë¨
    // Helper functions
    function loadSettings(){
      if(window.el.aiModelSelect) window.el.aiModelSelect.value = getSelectedAiModel();
    }
    const refreshPanels=()=>{ renderCalendarMonth(); renderStats(); renderExplorer(); };
    window.refreshPanels = refreshPanels; // TODO: Remove after quizCore.js direct import
    document.addEventListener('DOMContentLoaded', async ()=>{
      try{
        await loadData();
        console.log('âœ… ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', getAllData()?.length || 0, 'ë¬¸ì œ');
      }catch(err){
        console.error(err);
        $('question-text').textContent='ë¬¸ì œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨';
        showToast(`ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${err.message}`,'error');
      }

      loadSettings();
      initStatsDate();
      updateDDayDisplay();
      applyDarkMode();
      migrateData();
      // Phase 6.2: calRefDate moved to storageManager
      enforceExclusiveFlagsOnAll();
      backfillReadStoreFromScores(false);

      initSettings();
      // Phase 2: ë°ì´í„° Import/Export ëª¨ë“ˆì€ lazy loading (ë²„íŠ¼ í´ë¦­ ì‹œ ë¡œë“œ)
      window.el.exportDataBtn?.addEventListener('click', loadDataImportExportModule, { once: true });
      window.el.importDataBtn?.addEventListener('click', loadDataImportExportModule, { once: true });
      initReportListeners();
      // Phase 2: AI ë¶„ì„ ëª¨ë“ˆì€ lazy loading (ë²„íŠ¼ í´ë¦­ ì‹œ ë¡œë“œ)
      window.el.aiAnalysisStartBtn?.addEventListener('click', loadAIAnalysisModule, { once: true });
      // Phase 2: í”Œë˜ì‹œì¹´ë“œ ëª¨ë“ˆì€ lazy loading (ë²„íŠ¼ í´ë¦­ ì‹œ ë¡œë“œ)
      window.el.flashcardModeBtn?.addEventListener('click', loadFlashcardModule, { once: true });
      ensureApiKeyGate();
      buildSourceFilterUI();
      moveSourceFilterToSide();

      initQuizListeners();
      initQuizEventListeners(); // EventBus ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™” (ìˆœí™˜ ì˜ì¡´ì„± í•´ê²°)
      initFilterListeners();
      initSummaryListeners();
      initSettingsListeners();
      initCalendarListeners();
      initExplorerListeners();
      initUIListeners();
      initKeyboardShortcuts();
      refreshPanels();

      initAchievementListeners();
      loadAchievements();
      checkAchievements();
      updateAchievementBadge();
      initReviewListeners();

      // STT ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™”
      initSttListeners();
    });
  </script>

</body>
  <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TC8G7NJD"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
</html>










