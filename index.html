<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="referrer" content="same-origin" />
  <title>ê°ë¦°ì´ - íšŒê³„ê°ì‚¬ í•™ìŠµ ë„ìš°ë¯¸ v3.x</title>

  <!-- Tailwind (DEVìš©) : í”„ë¡œë•ì…˜ì—ì„œëŠ” ë¹Œë“œëœ CSSë¡œ ëŒ€ì²´ ê¶Œì¥ -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- í°íŠ¸ (ê¸°ì¡´ ìœ ì§€) -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet" />

  <!-- ì…¸/3-Pane ìµœì†Œ CSS (Tailwindì™€ ê³µì¡´ ê°€ëŠ¥) -->
  <style>
    body { font-family: 'Noto Sans KR', sans-serif; }
    :root{
      --left-w: 320px; --right-w: 360px; --gap: 12px;
      --bg:#0b0c10; --panel:#12141a; --line:#1f2330; --fg:#e6e6e6;
      --muted:#9aa3b2; --chip:#2a3345;
    }
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--fg)}
    #app{
      display:grid; grid-template-columns: var(--left-w) 1fr var(--right-w);
      gap:var(--gap); height:calc(100vh - 56px); padding:var(--gap); overflow:hidden;
    }
    .panel{
      border:1px solid var(--line); border-radius:10px; background:var(--panel);
      overflow:hidden; min-height:0; display:flex; flex-direction:column;
    }
    header.shell{
      display:flex; align-items:center; justify-content:space-between;
      padding:10px 12px; border-bottom:1px solid var(--line); gap:8px; background:#0e1117;
      position:sticky; top:0; z-index:50; height:56px;
    }
    .toolbar{display:flex; gap:8px; align-items:center}
    .btn{padding:6px 10px; border:1px solid var(--line); border-radius:8px; background:#0e1117; color:#dfe6ee; cursor:pointer}
    .btn.primary{border-color:#2a3345; background:#162038}
    .chip{display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border-radius:999px; background:var(--chip); color:#cfd7e6; font-size:12px}
    .scroll{overflow:auto}
    /* ì¢Œì¸¡ ìº˜ë¦°ë”/ì°¨íŠ¸ ì„¹ì…˜ ê¸°ì´ˆ */
    #left .section{padding:12px; border-bottom:1px dashed var(--line)}
    #calendar{display:grid; grid-template-columns:repeat(7,1fr); gap:4px}
    .cell{aspect-ratio:1/1; border-radius:6px; background:#0f1522; border:1px solid #162033}
    .cell.int-1{background:#16233f} .cell.int-3{background:#193053}
    .cell.int-5{background:#1b3a6a} .cell.int-8{background:#1d4788}
    @media (max-width:1024px){
      #app{grid-template-columns:1fr}
      #left, #right{display:none}
    }

    /* ë¡œë”(ê¸°ì¡´ ìœ ì§€) */
    .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%;
      width: 30px; height: 30px; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    /* ë‹¤í¬ëª¨ë“œ (ê¸°ì¡´ ìœ ì§€) */
    .dark { background-color: #1a202c; color: #e2e8f0; }
    .dark .bg-white { background-color: #2d3748; }
    .dark .bg-gray-100 { background-color: #1a202c; }
    .dark .bg-gray-50 { background-color: #2d3748; }
    .dark .text-gray-800 { color: #e2e8f0; }
    .dark .text-gray-700 { color: #cbd5e0; }
    .dark .text-gray-600 { color: #a0aec0; }
    .dark .border-gray-200 { border-color: #4a5568; }
    .dark .border-gray-300 { border-color: #4a5568; }

    /* ë‹¤í¬ëª¨ë“œ ì ‘ê·¼ì„± ë³´ê°•(ê¸°ì¡´ ìœ ì§€ id) */
    html.dark { color-scheme: dark; }
    html.dark input, html.dark textarea, html.dark select {
      background-color: #1f2937; /* gray-800 */
      color: #e5e7eb;            /* gray-200 */
      border-color: #4b5563;     /* gray-600 */
    }
    html.dark ::placeholder { color: #9ca3af; } /* gray-400 */
    html.dark :is(button, a, input, textarea, select):focus-visible {
      outline: 2px solid #60a5fa; outline-offset: 2px;
    }
    html.dark .progress-track { background-color: #374151; } /* gray-700 */
  </style>

  <!-- Chart.js (ì¢Œì¸¡ í†µê³„ìš©) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="min-h-screen">
  <!-- ìƒë‹¨ ì…¸ -->
  <header class="shell">
    <div class="flex items-center gap-3">
      <span class="text-sm font-semibold tracking-tight text-blue-400">ê°ë¦°ì´ v3.x</span>
      <span class="chip">ì—”ì§„: <strong id="engine-mode-label">forgetting</strong></span>
    </div>
    <div class="toolbar">
      <button class="btn" id="toggle-left">ëŒ€ì‹œë³´ë“œ</button>
      <button class="btn" id="toggle-right">íƒìƒ‰</button>
      <button class="btn primary" id="btn-start-review">ì˜¤ëŠ˜ì˜ ë³µìŠµ ì‹œì‘</button>
      <button id="settings-btn" class="btn" aria-haspopup="dialog">ì„¤ì • âš™ï¸</button>
    </div>
  </header>

  <!-- 3-Pane -->
  <main id="app">
    <!-- ì¢Œ: ìº˜ë¦°ë”/í†µê³„/ì—”ì§„ ì œì–´ -->
    <section id="left" class="panel">
      <div class="section">
        <h3 class="text-sm font-semibold mb-2">ì”ë””ë°­ ìº˜ë¦°ë”</h3>
        <div id="calendar" class="scroll" aria-label="activity calendar"></div>
      </div>
      <div class="p-3 scroll space-y-3">
        <canvas id="chart-daily" height="140"></canvas>
        <canvas id="chart-chapter" height="140"></canvas>
      </div>
      <div class="section">
        <h3 class="text-sm font-semibold mb-2">ì˜¤ëŠ˜ì˜ ë³µìŠµ ì œì–´</h3>
        <div class="flex items-center gap-3">
          <label class="text-xs">ì „ëµ
            <select id="engine-strategy" class="ml-1 text-black">
              <option value="forgetting" selected>ë§ê°</option>
              <option value="low-score">ì €ë“ì </option>
              <option value="recent-wrong">ìµœê·¼ì˜¤ë‹µ</option>
            </select>
          </label>
          <label class="text-xs">ê°œìˆ˜
            <input id="engine-N" type="range" min="5" max="30" value="10" />
          </label>
        </div>
      </div>
    </section>

    <!-- ì¤‘: í€´ì¦ˆ -->
    <section id="center" class="panel">
      <div class="p-3 scroll space-y-3">
        <div class="flex items-center gap-2">
          <div id="question-meta" class="chip">ë‹¨ì› <span id="q-chapter">-</span> Â· ë¬¸ì œ <span id="q-no">-</span></div>
          <span class="text-xs opacity-70">Ctrl+Enter=ì±„ì , â†/â†’=ì´ì „/ë‹¤ìŒ, ?=ë‹¨ì¶•í‚¤</span>
        </div>
        <h2 id="q-title" class="text-base font-semibold"></h2>
        <p id="q-body" class="whitespace-pre-wrap text-sm opacity-90"></p>
        <div>
          <div class="flex items-center justify-between mb-1">
            <label for="q-answer" class="text-xs opacity-80">ë‹µì•ˆ ì…ë ¥</label>
            <button id="load-prev-answer-btn" class="text-xs text-blue-300 hover:underline">ì´ì „ ë‹µì•ˆ ë¶ˆëŸ¬ì˜¤ê¸°</button>
          </div>
          <textarea id="q-answer" class="w-full rounded-md border border-slate-700 bg-[#0f1320] text-slate-100 p-3" rows="6" placeholder="ì—¬ê¸°ì— ë‹µì•ˆì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
          <p id="error-message" class="text-red-400 text-xs mt-1 hidden">ë‹µì•ˆì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
        </div>
        <div class="flex items-center gap-2">
          <button class="btn" id="btn-prev">ì´ì „(â†)</button>
          <button class="btn" id="btn-next">ë‹¤ìŒ(â†’)</button>
          <button class="btn primary relative min-w-[120px]" id="btn-grade">
            <span id="grade-btn-text">ì±„ì (Ctrl+Enter)</span>
            <div id="grade-loader" class="loader absolute inset-0 m-auto hidden" aria-hidden="true"></div>
          </button>
          <button class="btn" id="hint-btn">íŒíŠ¸</button>
        </div>
        <div id="hint-container" class="hidden mt-1 text-xs bg-indigo-900/60 border border-indigo-700 text-indigo-100 rounded p-2"></div>

        <!-- ê²°ê³¼ -->
        <div id="result-box" class="hidden bg-black/20 border border-slate-700 rounded p-3 mt-2" aria-live="polite">
          <h3 class="text-sm font-semibold mb-1">ì±„ì  ê²°ê³¼</h3>
          <div class="mb-2">
            <p class="text-sm">ìœ ì‚¬ë„ ì ìˆ˜: <span id="score" class="font-bold text-blue-300 text-lg">0</span><span class="text-sm opacity-70">ì </span></p>
            <div class="w-full bg-slate-700 progress-track rounded-full h-3 mt-1 overflow-hidden">
              <div id="progress-bar" class="h-3 rounded-full transition-all duration-500 ease-out" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" style="width: 0%"></div>
            </div>
          </div>
          <div class="mb-2">
            <h4 class="text-sm font-semibold mb-1">ğŸ¤– AI ì´í‰</h4>
            <div id="ai-feedback" class="bg-[#0b0f1a] p-2 border border-slate-700 rounded text-sm min-h-[40px]"></div>
          </div>
          <div>
            <h4 class="text-sm font-semibold mb-1">ğŸ“˜ ëª¨ë²” ë‹µì•ˆ</h4>
            <pre id="correct-answer" class="bg-[#0b0f1a] p-2 border border-slate-700 rounded text-xs font-sans leading-relaxed whitespace-pre-wrap"></pre>
          </div>
        </div>
      </div>
    </section>

    <!-- ìš°: íƒìƒ‰(ë‹¨ì› íŠ¸ë¦¬/ëª©ë¡/ë±ƒì§€) -->
    <section id="right" class="panel">
      <div class="p-2 scroll" id="explorer-tree" aria-label="ë¬¸í•­ íƒìƒ‰ íŠ¸ë¦¬"></div>
    </section>
  </main>

  <!-- í† ìŠ¤íŠ¸ ì˜ì—­ (ê¸°ì¡´ id ìœ ì§€) -->
  <div id="toast" class="hidden fixed top-4 right-4 z-[9999]"></div>

  <!-- ========== API í‚¤ ìµœì´ˆ ì¸ì¦ ëª¨ë‹¬ (ê¸°ì¡´ ìœ ì§€) ========== -->
  <div id="api-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-[1000]">
    <div class="bg-white rounded-2xl w-full max-w-md p-6 shadow-xl dark:bg-gray-900 dark:text-gray-100">
      <h2 class="text-xl font-bold">Gemini API í‚¤ ì¸ì¦</h2>
      <p class="text-sm text-gray-600 mt-1 dark:text-gray-300">ìµœì´ˆ 1íšŒë§Œ ì…ë ¥í•©ë‹ˆë‹¤. ë¡œì»¬ ì €ì¥ì„ ì²´í¬í•˜ë©´ ë‹¤ìŒë¶€í„°ëŠ” íŒì—…ì´ ëœ¨ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
      <p class="text-sm mt-2">ì²˜ìŒ ì‚¬ìš©í•˜ì‹œë‚˜ìš”?
        <a href="README.html" target="_blank" rel="noopener" class="underline text-blue-600 dark:text-blue-300">ë„ì›€ë§(README)</a>
      </p>
      <label for="api-modal-input" class="block text-sm font-medium mt-4">ğŸ”‘ API Key</label>
      <input type="password" id="api-modal-input" class="w-full p-3 border rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700" placeholder="Google AI Studio API í‚¤" autocomplete="off" spellcheck="false" inputmode="text" />
      <div class="flex items-center gap-2 mt-2">
        <input type="checkbox" id="modal-remember" class="rounded border-gray-300" />
        <label for="modal-remember" class="text-sm">ì´ ë¸Œë¼ìš°ì €ì— í‚¤ ì €ì¥</label>
      </div>
      <p class="text-xs text-yellow-600 mt-1">âš ï¸ ê³µìš© PCì—ì„œëŠ” ì²´í¬ í•´ì œë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.</p>
      <div class="mt-5 flex justify-end gap-2">
        <button id="api-cancel-btn" class="px-3 py-2 text-sm text-gray-600 hover:text-gray-900">ì·¨ì†Œ</button>
        <button id="api-save-btn" class="px-4 py-2 bg-blue-600 text-white text-sm font-semibold rounded-lg hover:bg-blue-700">ì €ì¥</button>
      </div>
    </div>
  </div>

  <!-- ========== ì„¤ì • ëª¨ë‹¬ (ê¸°ì¡´ ìœ ì§€) ========== -->
  <div id="settings-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-[1001]">
    <div role="dialog" aria-modal="true" aria-labelledby="settings-title" class="bg-white dark:bg-gray-900 dark:text-gray-100 rounded-2xl w-full max-w-2xl p-6 shadow-xl max-h-[90vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-2">
        <h2 id="settings-title" class="text-2xl font-bold">ì„¤ì • âš™ï¸</h2>
        <button id="settings-close-btn" class="text-gray-500 hover:text-gray-800 dark:hover:text-white" aria-label="ë‹«ê¸°">âœ•</button>
      </div>

      <div class="mb-6 pb-6 border-b">
        <h3 class="text-lg font-semibold mb-3">API í‚¤ ì„¤ì •</h3>
        <button id="open-api-key-modal-btn" class="w-full bg-blue-50 border border-blue-300 text-blue-700 font-medium py-2 px-4 rounded-lg hover:bg-blue-100 transition">
          API í‚¤ ë³€ê²½/ì„¤ì •
        </button>
      </div>

      <div class="mb-6 pb-6 border-b">
        <h3 class="text-lg font-semibold mb-3">AI ëª¨ë¸ ì„ íƒ</h3>
        <select id="ai-model-select" class="w-full p-3 border rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700">
          <option value="gemini-2.5-flash">Gemini 2.5 Flash (ê¸°ë³¸)</option>
          <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash-Lite (ê²½ëŸ‰)</option>
        </select>
        <p class="text-xs text-gray-500 mt-2">íŒíŠ¸ ë° ì±„ì ì— ì‚¬ìš©ë  AI ëª¨ë¸ì„ ì„ íƒí•˜ì„¸ìš”.</p>
      </div>

      <div class="mb-6 pb-6 border-b">
        <h3 class="text-lg font-semibold mb-3">ë‹¤í¬ ëª¨ë“œ</h3>
        <select id="dark-mode-select" class="w-full p-3 border rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700">
          <option value="system">ì‹œìŠ¤í…œ ì„¤ì • (ê¸°ë³¸)</option>
          <option value="light">ë¼ì´íŠ¸ ëª¨ë“œ</option>
          <option value="dark">ë‹¤í¬ ëª¨ë“œ</option>
        </select>
      </div>

      <div class="mb-6">
        <h3 class="text-lg font-semibold mb-3">ë°ì´í„° ê´€ë¦¬</h3>
        <div class="flex gap-3">
          <button id="export-data-btn" class="flex-1 bg-green-50 border border-green-300 text-green-700 font-medium py-2 px-4 rounded-lg hover:bg-green-100 transition">
            ğŸ“¥ ë°ì´í„° ë‚´ë³´ë‚´ê¸°
          </button>
          <button id="import-data-btn" class="flex-1 bg-yellow-50 border border-yellow-300 text-yellow-700 font-medium py-2 px-4 rounded-lg hover:bg-yellow-100 transition">
            ğŸ“¤ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
          </button>
        </div>
        <input type="file" id="import-file-input" accept=".json" class="hidden" />
        <p class="text-xs text-gray-500 mt-2">í•™ìŠµ ê¸°ë¡ ë° ì„¤ì •ì„ ë°±ì—…í•˜ê±°ë‚˜ ë³µì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
      </div>

      <div class="flex justify-end">
        <button id="settings-close-btn-bottom" class="px-6 py-2 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300 transition dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600 border dark:border-gray-600">
          ë‹«ê¸°
        </button>
      </div>
    </div>
  </div>

  <!-- ========== ë‚´ì¥ ë°ì´í„°(JSON) í´ë°± (ê¸°ì¡´ ìœ ì§€) ========== -->
  <script id="dataset-json" type="application/json">[
    {
      "ê³ ìœ ID": "q_001",
      "í‘œì‹œë²ˆí˜¸": "1",
      "ì¶œì²˜": "ISA 200-A54",
      "problemTitle": "",
      "ë‹¨ì›": 1,
      "ë¬¼ìŒë²ˆí˜¸": 1,
      "ë¬¼ìŒ": "íšŒê³„ê°ì‚¬ì—ëŠ” ê³ ìœ í•œê³„ê°€ ì¡´ì¬í•˜ë©° ... ì›ì¸ì„ ì„¸ê°€ì§€ë§Œ ê¸°ì¬í•˜ì‹œì˜¤.",
      "ì •ë‹µ": "â‘  ì¬ë¬´ë³´ê³ ì˜ ì„±ê²© â‘¡ ê°ì‚¬ì ˆì°¨ì˜ ì„±ê²© â‘¢ í•©ë¦¬ì ì¸ ì‹œê°„ ë‚´ì— í•©ë¦¬ì ì¸ ë¹„ìš©ìœ¼ë¡œ ê°ì‚¬ê°€ ìˆ˜í–‰ë  í•„ìš”ì„±"
    },
    {
      "ê³ ìœ ID": "q_002",
      "í‘œì‹œë²ˆí˜¸": "2",
      "ì¶œì²˜": "ISA 200-A51",
      "problemTitle": "",
      "ë‹¨ì›": 1,
      "ë¬¼ìŒë²ˆí˜¸": 2,
      "ë¬¼ìŒ": "íšŒê³„ê°ì‚¬ê¸°ì¤€ì€ ... ì±„íƒí•˜ê³  ìˆëŠ” ê°ì‚¬ì ˆì°¨ì—ëŠ” ì–´ë–¤ ê²ƒì´ ìˆëŠ”ì§€ ì„¸ê°€ì§€ë¥¼ ì„œìˆ í•˜ì‹œì˜¤.",
      "ì •ë‹µ": "â‘  ê³„íš â‘¡ ìœ„í—˜ ë†’ì€ ë¶„ì•¼ ì§‘ì¤‘ â‘¢ í…ŒìŠ¤íŠ¸ ë“± í‘œë³¸ ì‚¬ìš©"
    }
  ]</script>

  <!-- ë¶€íŠ¸ìŠ¤íŠ¸ë©: ì…¸ í† ê¸€ + ì•± ì‹œì‘ (ì¤‘ë³µ ë¡œë“œ ê¸ˆì§€) -->
  <script type="module">
    // í—¤ë” í† ê¸€ (ëª¨ë°”ì¼ ëŒ€ì‘)
    const $ = s => document.querySelector(s);
    $('#toggle-left')?.addEventListener('click', () => {
      const el = $('#left'); el.style.display = (el.style.display === 'none' ? 'flex' : 'none');
    });
    $('#toggle-right')?.addEventListener('click', () => {
      const el = $('#right'); el.style.display = (el.style.display === 'none' ? 'flex' : 'none');
    });

    // ì•± ì—”íŠ¸ë¦¬ (app.jsê°€ í•˜ìœ„ ëª¨ë“ˆ import)
    import './js/app.js';
  </script>

  <!-- GA ìŠ¤ë‹ˆí«ì€ js/analytics/ga.jsì—ì„œ ì´ˆê¸°í™”í•˜ê³ , app.jsì—ì„œ ì´ë²¤íŠ¸ í›… ì—°ê²° -->
</body>
</html>
