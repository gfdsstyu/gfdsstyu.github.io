

<!DOCTYPE html>
<html lang="ko">
<head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-20Q61B31CM"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-20Q61B31CM');
</script>
  <!-- Google Tag Manager -->
<script>(function (w, d, s, l, i) {
    w[l] = w[l] || []; w[l].push({
        'gtm.start':
        new Date().getTime(), event: 'gtm.js'
    }); var f = d.getElementsByTagName(s)[0],
    j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
})(window, document, 'script', 'dataLayer', 'GTM-TC8G7NJD');</script>
<!-- End Google Tag Manager -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="referrer" content="same-origin" />
  <title>ê°ë¦°ì´ - íšŒê³„ê°ì‚¬ í•™ìŠµ ë„ìš°ë¯¸</title>

  <!-- Favicon - 404 ì—ëŸ¬ ë°©ì§€ -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%236D28D9'/><rect x='20' y='20' width='60' height='60' rx='10' fill='white'/><circle cx='36' cy='43' r='9' fill='%238B5CF6'/><text x='36' y='46' font-size='14' fill='white' font-family='-apple-system,BlinkMacSystemFont,sans-serif' font-weight='900' text-anchor='middle' dominant-baseline='central'>ã„±</text><g transform='translate(64, 43)'><path d='M0 0 L 4 10 L 14 14 L 4 18 L 0 28 L -4 18 L -14 14 L -4 10 Z' fill='%23FACC15' transform='scale(0.8) translate(0, -14)'/></g><path d='M30 60 H 70 V 72 H 30 Z M35 60 V 72 M 40 60 V 72 M 45 60 V 72 M 50 60 V 72 M 55 60 V 72 M 60 60 V 72 M 65 60 V 72' fill='none' stroke='%234F46E5' stroke-width='2'/></svg>">

  <!-- Phase 3: Tailwind CSS (Built & Optimized) -->
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>

  <!-- Phase 3.6: Firebase Extensionsë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë©”ì¼ ë°œì†¡ (EmailJS ì œê±°ë¨) -->
  <!-- Phase 4.0 Day 1: íƒ€ì´í¬ê·¸ë˜í”¼ ì‹œìŠ¤í…œ - Dynamic Subset for better performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard-dynamic-subset.css" />
  <link href="https://cdn.jsdelivr.net/gh/fonts-archive/IropkeBatang@latest/IropkeBatang.css" rel="stylesheet">
  <style>
    /* UIëŠ” Pretendard (Sans), ë³¸ë¬¸ì€ ì´ë¡­ê²Œ ë°”íƒ• (Serif) */
    body { font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif; }
    #question-text, #result-box, #user-answer, textarea { font-family: 'Iropke Batang', 'IropkeBatang', Merriweather, serif; }
    .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .summary-btn{ width:38px;height:38px;font-size:.8rem;line-height:1;display:flex;align-items:center;justify-content:center;padding:0 2px;transition:.2s;white-space:nowrap;overflow:hidden;text-overflow:ellipsis }
    .summary-btn:hover{ transform:scale(1.1) }
    pre{ white-space:pre-wrap; word-wrap:break-word }
    #toast{ position:fixed; top:16px; right:16px; z-index:9999 }
    .no-kr-break{ word-break:keep-all }

    /* Phase 4.0 Day 1: Stone ê³„ì—´ ë‹¤í¬ ëª¨ë“œ */
    .dark{ background-color:#1c1917; color:#e7e5e4 }
    .dark .bg-white{ background-color:#292524 }
    .dark .bg-gray-100{ background-color:#1c1917 }
    .dark .bg-gray-50{ background-color:#292524 }
    .dark .text-gray-800{ color:#e7e5e4 }
    .dark .text-gray-700{ color:#d6d3d1 }
    .dark .text-gray-600{ color:#a8a29e }
    .dark .border-gray-200{ border-color:#44403c }
    .dark .border-gray-300{ border-color:#44403c }
  </style>

  <style id="dark-a11y-20251026">
    /* Phase 4.0 Day 1: Stone ê³„ì—´ ë‹¤í¬ ëª¨ë“œ */
    html.dark { color-scheme: dark; }
    html.dark input, html.dark textarea, html.dark select { background-color:#292524; color:#e7e5e4; border-color:#57534e }
    html.dark ::placeholder { color:#a8a29e }
    html.dark :is(button,a,input,textarea,select):focus-visible { outline:2px solid #78716c; outline-offset:2px }
    html.dark .progress-track{ background-color:#44403c }
    html.dark #result-box{ background-color:#292524; border-color:#44403c }
    html.dark #quiz-area .bg-gray-50{ background-color:#1c1917 }
    html.dark #quiz-area .border-gray-200{ border-color:#44403c }
    html.dark #hint-container{ background-color:#334155; border-color:#475569; color:#e2e8f0 }
    html.dark #summary-area .border{ border-color:#44403c }
    html.dark #summary-area .bg-gray-50{ background-color:#1c1917 }
    html.dark .summary-btn.bg-gray-100{ background-color:#1c1917; color:#d6d3d1; border-color:#44403c }
    html.dark .summary-btn.bg-red-100{ background-color:#7f1d1d; color:#fecaca; border-color:#991b1b }
    html.dark .summary-btn.bg-yellow-100{ background-color:#78350f; color:#fde68a; border-color:#92400e }
    html.dark .summary-btn.bg-green-100{ background-color:#14532d; color:#bbf7d0; border-color:#166534 }
    html.dark .summary-btn.bg-blue-100{ background-color:#334155; color:#cbd5e1; border-color:#475569 }
  </style>

  <style id="focus-mode-css">
    html.focus-mode { scroll-behavior: smooth; }
    html.focus-mode #result-box { max-height:none!important; overflow:visible!important; }
  </style>

  <style id="layout-css">
    .heatmap-cell{ width:14px; height:14px; border-radius:3px }
    .drawer-open{ overflow:hidden }
    .cal-cell { height: 32px; border-radius: 6px; position: relative; display: grid; place-items: center; font-size: 12px; border: 1px solid rgba(0,0,0,0.06); }
    .cal-cell .cal-day { position: absolute; top: 4px; right: 6px; font-size: 10px; opacity: 0.85; font-weight: 600; }
    .cal-cell.muted { opacity: 0.35; }
  </style>

  <style id="header-scroll-css">
    /* í—¤ë” ìŠ¤í¬ë¡¤ ì• ë‹ˆë©”ì´ì…˜ */
    #fixed-header {
      transition: transform 0.3s ease-in-out;
    }

    #fixed-header.header-visible {
      transform: translateY(0);
    }

    #fixed-header.header-hidden {
      transform: translateY(-100%);
    }
  </style>

  <style id="report-css">
    /* Chart container heights */
    #chart-daily-volume { min-height: 250px; max-height: 300px; }
    #chart-score-trend { min-height: 250px; max-height: 300px; }
    #chart-chapter-weakness { min-height: 300px; }
    #chart-chapter-detail { min-height: 250px; max-height: 300px; }

    /* ëª¨ë°”ì¼ ì„¸ë¡œëª¨ë“œ: ì°¨íŠ¸ ë†’ì´ ì¦ê°€ (ì••ì¶• ë°©ì§€) */
    @media (max-width: 768px) {
      #chart-daily-volume,
      #chart-score-trend,
      #chart-chapter-detail {
        min-height: 350px !important;
        max-height: 400px !important;
      }
      #chart-chapter-weakness {
        min-height: 350px !important;
      }
    }

    /* Prose styles for AI analysis */
    .prose { font-size: 0.875rem; line-height: 1.5; }
    .prose h1 { font-size: 1.5rem; font-weight: bold; margin-top: 1.5rem; margin-bottom: 0.75rem; }
    .prose h2 { font-size: 1.25rem; font-weight: bold; margin-top: 1.25rem; margin-bottom: 0.5rem; }
    .prose h3 { font-size: 1.125rem; font-weight: 600; margin-top: 1rem; margin-bottom: 0.5rem; }
    .prose p { margin-top: 0.75rem; margin-bottom: 0.75rem; }
    .prose ul, .prose ol { margin-left: 1.5rem; margin-top: 0.5rem; margin-bottom: 0.5rem; }
    .prose li { margin-top: 0.25rem; margin-bottom: 0.25rem; }
    .prose strong { font-weight: 600; color: inherit; }
    .prose code { background: rgba(0,0,0,0.05); padding: 0.125rem 0.25rem; border-radius: 0.25rem; font-size: 0.875em; }
    .prose.dark\:prose-invert { color: #e5e7eb; }
    html.dark .prose h1, html.dark .prose h2, html.dark .prose h3 { color: #f3f4f6; }
    html.dark .prose strong { color: #fbbf24; }
    html.dark .prose code { background: rgba(255,255,255,0.1); }

    /* ================================================
       PDF ë‚´ë³´ë‚´ê¸° ì „ìš© ìŠ¤íƒ€ì¼ (Task 2: ì„ íƒí˜• PDF ë‚´ë³´ë‚´ê¸°)
       ================================================ */
    @media print {
      /* 1. ì „ì²´ í˜ì´ì§€ ì´ˆê¸°í™” */
      * {
        background: white !important;
        color: black !important;
        box-shadow: none !important;
      }

      /* 2. ë¶ˆí•„ìš”í•œ ìš”ì†Œ ìˆ¨ê¹€ */
      body > *:not(#report-modal),
      nav, aside, header, footer,
      button, .no-print,
      #left-dashboard,
      #drawer-backdrop,
      .report-tab,
      #report-close-btn,
      #report-refresh-btn,
      #report-save-snapshot-btn,
      #report-load-snapshot-btn,
      #report-print-btn,
      #pdf-options-modal,
      .border-b.border-gray-200 {
        display: none !important;
      }

      /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ ìˆ¨ê¸°ê¸° */
      #report-modal .border-b.border-gray-200.dark\\:border-gray-700.px-6,
      #report-modal nav[role="tablist"] {
        display: none !important;
      }

      /* 2-1. ë¦¬í¬íŠ¸ í—¤ë” ìµœì í™” (ìµœì†Œí™”) */
      #report-modal .sticky {
        position: static !important;
        padding: 0 !important;
        margin: 0 !important;
        border: none !important;
      }

      #report-title {
        font-size: 0.75rem !important;
        margin: 0 0 0.125rem 0 !important;
        padding: 0 !important;
        line-height: 1 !important;
        font-weight: 600 !important;
      }

      /* í—¤ë” ë‚´ë¶€ ëª¨ë“  ì»¨í…Œì´ë„ˆ ì••ì¶• */
      #report-modal .sticky * {
        margin: 0 !important;
        padding: 0 !important;
      }

      /* ë°ì´í„° ë²”ìœ„/ë¶„ì„ ëŒ€ìƒ ì˜ì—­ ì™„ì „ ìˆ¨ê¸°ê¸° */
      #report-modal .sticky .flex.flex-col,
      #report-modal .sticky .flex.items-center {
        display: none !important;
      }

      /* 3. ë¦¬í¬íŠ¸ ëª¨ë‹¬ë§Œ í‘œì‹œ */
      #report-modal {
        display: block !important;
        position: static !important;
        background: white !important;
        overflow: visible !important;
        max-height: none !important;
        padding: 0 !important;
        margin: 0 !important;
      }

      #report-modal > div {
        max-height: none !important;
        overflow: visible !important;
        box-shadow: none !important;
        border: none !important;
      }

      /* 4. ì„ íƒ í•´ì œëœ íƒ­ ìˆ¨ê¹€ (ìš°ì„ ìˆœìœ„ ìµœìƒìœ„) */
      .report-content.print-hidden,
      .print-hidden {
        display: none !important;
      }

      /* 5. ëª¨ë“  íƒ­ ì»¨í…ì¸ ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ í‘œì‹œ */
      .report-content:not(.print-hidden) {
        display: block !important;
        page-break-after: auto;
        page-break-inside: avoid;
        margin-bottom: 8px;
        padding: 0.5rem !important;
      }

      .report-content:last-child {
        page-break-after: auto;
      }

      /* 6. ì°¨íŠ¸ ìµœì í™” */
      canvas {
        display: block !important;
        max-width: 100% !important;
        max-height: 200px !important;
        height: auto !important;
        page-break-inside: avoid;
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
      }

      /* 7. í˜ì´ì§€ í—¤ë”/í‘¸í„° */
      @page {
        margin: 1cm;
        size: A4;
      }

      /* 8. ì œëª© ìŠ¤íƒ€ì¼ */
      h1, h2, h3 {
        page-break-after: avoid;
        color: black !important;
        margin-top: 0.25rem !important;
        margin-bottom: 0.25rem !important;
        padding-top: 0 !important;
        padding-bottom: 0 !important;
      }

      /* 9. ë¦¬í¬íŠ¸ ë‚´ë¶€ ìš”ì†Œ ì—¬ë°± ìµœì†Œí™” */
      .report-content div,
      .report-content section,
      .report-content p {
        margin-top: 0.125rem !important;
        margin-bottom: 0.125rem !important;
        padding-top: 0.25rem !important;
        padding-bottom: 0.25rem !important;
      }

      .report-content table {
        margin-top: 0.25rem !important;
        margin-bottom: 0.25rem !important;
      }

      /* 10. ë‹¤í¬ëª¨ë“œ ë¹„í™œì„±í™” */
      .dark {
        color: black !important;
      }
    }
  </style>
</head>
<body class="bg-gray-100 flex flex-col min-h-screen">
  <div id="toast" class="hidden"></div>

  <!-- ìƒë‹¨ ë„¤ë¹„ -->
  <header id="fixed-header" class="fixed top-0 left-0 right-0 z-50 bg-white/90 backdrop-blur border-b border-gray-200 dark:bg-gray-900/80 dark:border-gray-800">
    <div class="mx-auto max-w-[1400px] 2xl:max-w-[1600px] px-4 lg:px-6 xl:px-8 py-2 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <span class="text-xl font-extrabold tracking-tight text-blue-700 dark:text-blue-400">ê°ë¦°ì´</span>
        <span class="hidden sm:inline text-xs text-gray-500 dark:text-gray-400">Beta</span>
      </div>
      <nav class="flex items-center gap-2">
        <a href="https://docs.google.com/spreadsheets/d/1PEZHUUHIveVD91eZma8MiW2j7_B197o597YjpTY1CRc/edit?usp=sharing" target="_blank" class="hidden sm:inline btn-soft text-sm" title="ë¬¸ì œDB êµ¬ì„±ì„ ìœ„í•œ êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸">ë¬¸ì œDBêµ¬ì„±ì— ì°¸ì—¬</a>
        <span id="dday-display" class="hidden sm:inline text-sm font-semibold px-3 py-1.5 rounded-lg bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-300 border border-amber-200 dark:border-amber-800 cursor-pointer hover:bg-amber-200 dark:hover:bg-amber-900/50 transition" title="ì‹œí—˜ë‚ ì§œ ì„¤ì •ì€ ì„¤ì • ë©”ë‰´ì—ì„œ">D-DAY</span>
        <button id="open-ranking-btn" class="btn-soft inline-flex items-center gap-1 text-sm" title="ì†Œì…œ">
          <span class="hidden sm:inline">ì†Œì…œ</span><span>ğŸ“Š</span>
        </button>
        <a id="help-button" href="README.html" target="_blank" class="btn-ghost hidden sm:inline text-sm">ë„ì›€ë§</a>

        <!-- Firebase ì¸ì¦ ë²„íŠ¼ -->
        <button id="login-btn" class="btn-primary inline-flex items-center gap-1 text-sm">
          <span>ë¡œê·¸ì¸</span>
        </button>

        <!-- ì‚¬ìš©ì ë©”ë‰´ (ë¡œê·¸ì¸ í›„ í‘œì‹œ) -->
        <div id="user-menu-container" class="relative">
          <button id="user-menu-btn" class="btn-soft hidden inline-flex items-center gap-2 text-sm">
            <span>ì‚¬ìš©ì</span>
            <span>â–¼</span>
          </button>

          <!-- ë“œë¡­ë‹¤ìš´ ë©”ë‰´ -->
          <div id="user-menu" class="hidden absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-1 z-50">
            <button id="my-profile-btn" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
              ë‚´ í”„ë¡œí•„
            </button>
            <button id="my-stats-btn" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
              ë‚´ í•™ìŠµ ê¸°ë¡
            </button>
            <button id="open-achievements-btn" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 relative">
              <span class="inline-flex items-center gap-2">
                <span>ğŸ†</span>
                <span>ë‚˜ì˜ ì—…ì </span>
              </span>
              <span id="new-achievement-badge" class="hidden absolute top-2 right-4 w-2 h-2 bg-red-500 rounded-full animate-pulse"></span>
            </button>
            <div class="border-t border-gray-200 dark:border-gray-700 my-1"></div>
            <button id="logout-btn" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
              ë¡œê·¸ì•„ì›ƒ
            </button>
            <button id="withdraw-btn" class="w-full text-left px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/30 font-medium">
              íšŒì› íƒˆí‡´
            </button>
          </div>
        </div>

        <button id="settings-btn" class="ml-1 inline-flex items-center gap-1 rounded-lg px-3 py-1.5 text-sm font-medium bg-gray-100 hover:bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600" aria-haspopup="dialog">
          <span>ì„¤ì •</span><span aria-hidden>âš™ï¸</span>
        </button>
        <button id="hamburger" class="lg:hidden inline-flex items-center justify-center w-9 h-9 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600" aria-label="ë©”ë‰´">â‰¡</button>
      </nav>
    </div>
  </header>
  <div class="h-14"></div>

  <div id="drawer-backdrop" class="fixed inset-0 bg-black/40 hidden z-[1099]"></div>

  <div id="layout-root" class="pt-2 flex-1 px-4 lg:px-6 xl:px-8">
    <div class="mx-auto max-w-[1400px] 2xl:max-w-[1600px] grid grid-cols-1 lg:grid-cols-12 gap-4 xl:gap-6 2xl:gap-8">
      <!-- LEFT -->
      <aside id="left-dashboard" class="hidden lg:block lg:col-span-3 xl:col-span-3 2xl:col-span-3 space-y-4">
        <button id="drawer-close" class="hidden lg:hidden absolute top-2 right-2 z-[1101] inline-flex items-center justify-center w-9 h-9 rounded-full bg-gray-200 hover:bg-gray-300 text-gray-700" aria-label="ë‹«ê¸°">âœ•</button>

        <div class="bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm p-6">
          <div class="flex items-center justify-between mb-2">
            <h3 class="font-bold text-lg text-gray-900 dark:text-gray-100">í•™ìŠµ ìº˜ë¦°ë”</h3>
            <div class="flex items-center gap-2">
              <button id="cal-prev" class="w-8 h-8 grid place-items-center rounded-md border hover:bg-gray-50 text-gray-900 dark:text-gray-100" aria-label="ì´ì „ ë‹¬">â—€</button>
              <div id="cal-title" class="min-w-[96px] text-sm font-semibold text-center text-gray-900 dark:text-gray-100">YYYY.MM</div>
              <button id="cal-next" class="w-8 h-8 grid place-items-center rounded-md border hover:bg-gray-50 text-gray-900 dark:text-gray-100" aria-label="ë‹¤ìŒ ë‹¬">â–¶</button>
            </div>
          </div>
          <div id="calendar-weekdays" class="grid grid-cols-7 text-center text-xs text-gray-500 mb-1">
            <div>ì›”</div><div>í™”</div><div>ìˆ˜</div><div>ëª©</div><div>ê¸ˆ</div><div>í† </div><div>ì¼</div>
          </div>
          <div id="calendar-grid" class="grid grid-cols-7 gap-x-0.5 gap-y-2"></div>
          <div class="mt-2 text-[11px] text-gray-500">ìƒ‰ = í•´ë‹¹ì¼ í’€ì´ëŸ‰ (ë…¸ë‘â†’ì´ˆë¡â†’íŒŒë‘)</div>
        </div>

        <div class="bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm p-6">
          <button id="open-report-btn" class="btn-primary w-full flex items-center justify-center gap-2">
            <span>ğŸ“Š</span>
            <span>í•™ìŠµ ë¦¬í¬íŠ¸ ìƒì„±</span>
          </button>
        </div>

        <div class="bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm p-6">
          <div class="flex items-center justify-between mb-2 cursor-pointer" id="stats-overview-toggle">
            <h3 class="font-bold text-lg text-gray-900 dark:text-gray-100">ì˜¤ëŠ˜ì˜ í†µê³„</h3>
            <svg class="w-5 h-5 transition-transform duration-200 text-gray-900 dark:text-gray-100" id="stats-overview-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </div>
          <div id="stats-overview" class="text-sm space-y-1 transition-all duration-200 text-gray-900 dark:text-gray-100"></div>
        </div>

        <div class="bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm p-6">
          <div class="flex items-center justify-between mb-2 cursor-pointer" id="review-toggle">
            <h3 class="font-bold text-lg text-gray-900 dark:text-gray-100">ì˜¤ëŠ˜ì˜ ë³µìŠµ</h3>
            <svg class="w-5 h-5 transition-transform duration-200 text-gray-900 dark:text-gray-100" id="review-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </div>

          <div id="review-content" class="transition-all duration-200">
            <label for="review-strategy-select" class="text-sm block mb-2 text-gray-900 dark:text-gray-100">ìš°ì„ ìˆœìœ„</label>
            <select id="review-strategy-select" name="review-strategy" class="w-full p-2 border rounded">
              <option value="smart">ì§€ëŠ¥í˜• ì¶”ì²œ (ê¸°ë³¸)</option>
              <option value="hlr">HLR ê¸°ë°˜ (íšŒìƒ í™•ë¥ )</option>
              <option value="low">ì ìˆ˜ ë‚®ì€ ìˆœ</option>
              <option value="recentWrong">ìµœê·¼ í‹€ë¦° ìˆœ</option>
              <option value="oldWrong">ì˜¤ë˜ì „ í‹€ë¦° ìˆœ</option>
              <option value="flag">ì‚¬ìš©ì ì§€ì • ë³µìŠµ ëª©ë¡</option>
            </select>
            <button id="start-review-btn" class="btn-primary mt-3 w-full">ì˜¤ëŠ˜ì˜ ë³µìŠµ ì‹œì‘</button>
          </div>
        </div>
      </aside>

      <!-- CENTER -->
      <main id="center-core" class="lg:col-span-6 xl:col-span-6 2xl:col-span-6">
        <div class="bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm w-full p-6 md:p-8">
          <div class="flex flex-col md:flex-row gap-4 mb-6 items-center">
            <div class="flex-1 w-full">
              <select id="chapter-select" name="chapter" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 transition dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600">
                <option value="">-- ì „ì²´ ë‹¨ì› --</option>
              </select>
            </div>
            <div class="flex-1 w-full">
              <select id="filter-select" name="filter" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 transition dark:bg-gray-700 dark:text-gray-100 dark:border-gray-700">
                <option value="all">ëª¨ë“  ë¬¸ì œ í’€ê¸°</option>
                <option value="unanswered">ì•„ì§ ì•ˆ í‘¼ ë¬¸ì œ</option>
                <option value="today-review">ì˜¤ëŠ˜ì˜ ë³µìŠµ (ì¶”ì²œ)</option>
                <option value="80">80ì  ë¯¸ë§Œ ë¬¸ì œ</option>
                <option value="60">60ì  ë¯¸ë§Œ ë¬¸ì œ</option>
              </select>
            </div>
            <div class="w-full md:w-auto md:self-end flex flex-col sm:flex-row gap-2">
              <button id="load-quiz-btn" class="btn-primary flex-1 whitespace-nowrap">í•™ìŠµ ì‹œì‘</button>
              <button id="random-quiz-btn" class="btn-outline flex-1 whitespace-nowrap">ëœë¤ ë¬¸ì œ</button>
              <button id="flashcard-mode-btn" class="btn-outline flex-1 whitespace-nowrap">í”Œë˜ì‹œì¹´ë“œ</button>
            </div>
          </div>

          <div id="source-group-filter" class="mb-6"></div>

          <!-- í”Œë˜ì‹œì¹´ë“œ ì˜ì—­ -->
          <div id="flashcard-area" class="hidden">
            <div class="bg-gradient-to-br from-blue-50 to-purple-50 dark:from-gray-800 dark:to-gray-700 border-2 border-blue-200 dark:border-gray-600 rounded-2xl p-4 md:p-8 mb-6 min-h-[400px] flex flex-col">
              <div class="flex flex-wrap justify-between items-center mb-4 gap-2">
                <h2 class="text-lg md:text-xl font-bold text-blue-700 dark:text-blue-300">í”Œë˜ì‹œì¹´ë“œ ëª¨ë“œ</h2>
                <span id="flashcard-counter" class="text-sm md:text-base text-gray-600 dark:text-gray-300 font-medium">0 / 0</span>
              </div>

              <div class="flex-1 flex flex-col justify-center space-y-4 md:space-y-6">
                <div class="bg-white dark:bg-gray-900 rounded-xl p-4 md:p-6 shadow-md">
                  <h3 class="text-xs md:text-sm font-semibold text-gray-500 dark:text-gray-400 mb-2">ë¬¸ì œ ì œëª©</h3>
                  <p id="flashcard-title" class="text-base md:text-lg font-bold text-gray-800 dark:text-gray-100">-</p>
                </div>

                <div class="bg-white dark:bg-gray-900 rounded-xl p-4 md:p-6 shadow-md">
                  <button id="flashcard-toggle-question" class="w-full flex items-center gap-2 mb-3 hover:opacity-70 transition">
                    <span id="flashcard-question-arrow" class="text-gray-500 dark:text-gray-400 text-lg">â–¶</span>
                    <h3 class="text-xs md:text-sm font-semibold text-gray-500 dark:text-gray-400">ë¬¼ìŒ</h3>
                  </button>
                  <div id="flashcard-question-box" class="hidden">
                    <p id="flashcard-question" class="font-serif text-sm md:text-base text-gray-700 dark:text-gray-200 leading-relaxed whitespace-pre-wrap">-</p>
                  </div>
                </div>

                <div class="bg-white dark:bg-gray-900 rounded-xl p-4 md:p-6 shadow-md">
                  <div class="flex flex-wrap justify-between items-center mb-3 gap-2">
                    <h3 class="text-xs md:text-sm font-semibold text-gray-500 dark:text-gray-400">ë‹µë³€ (ìŠ¤í˜ì´ìŠ¤ë°”ë¡œ í† ê¸€)</h3>
                    <button id="flashcard-toggle-answer" class="btn-soft text-xs md:text-sm whitespace-nowrap">
                      ë‹µë³€ ë³´ê¸° ğŸ‘ï¸
                    </button>
                  </div>
                  <div id="flashcard-answer-box" class="hidden">
                    <p id="flashcard-answer" class="font-serif text-sm md:text-base text-gray-700 dark:text-gray-200 leading-relaxed whitespace-pre-wrap">-</p>
                  </div>
                  <div id="flashcard-answer-hidden" class="text-center py-8 text-gray-400">
                    <p class="text-sm">ë‹µë³€ì´ ìˆ¨ê²¨ì ¸ ìˆìŠµë‹ˆë‹¤</p>
                    <p class="text-xs mt-2">ìœ„ ë²„íŠ¼ ë˜ëŠ” ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ëˆŒëŸ¬ í™•ì¸í•˜ì„¸ìš”</p>
                  </div>
                </div>
              </div>

              <div class="space-y-3 mt-6">
                <div class="flex flex-wrap justify-center items-center gap-2 md:gap-4">
                  <button id="flashcard-prev-btn" class="btn-soft whitespace-nowrap text-sm md:text-base">â†<span class="hidden md:inline"> ì´ì „</span></button>
                  <button id="flashcard-random-btn" class="btn-outline whitespace-nowrap text-sm md:text-base">ğŸ²<span class="hidden md:inline"> ëœë¤</span></button>
                  <button id="flashcard-exit-btn" class="btn-outline whitespace-nowrap text-sm md:text-base"><span class="hidden md:inline">ì¢…ë£Œ</span>âœ•</button>
                  <button id="flashcard-next-btn" class="btn-soft whitespace-nowrap text-sm md:text-base"><span class="hidden md:inline">ë‹¤ìŒ </span>â†’</button>
                </div>
                <div class="text-center text-xs text-gray-500 dark:text-gray-400 hidden md:block">
                  ë‹¨ì¶•í‚¤: â† ì´ì „ | â†’ ë‹¤ìŒ | Q ë¬¼ìŒí† ê¸€ | Space ë‹µë³€í† ê¸€ | 1(ì‰¬ì›€) 2(ë³´í†µ) 3(ì–´ë ¤ì›€) 0(ê±´ë„ˆë›°ê¸°) | Esc ì¢…ë£Œ
                </div>
              </div>
            </div>
          </div>

          <!-- ë¬¸ì œ ì˜ì—­ -->
          <div id="quiz-area" class="hidden">
            <div class="bg-gray-50 border border-gray-200 rounded-lg p-6 mb-4">
              <div class="flex justify-between items-center mb-2">
                <h2 id="question-number" class="text-xl font-bold text-blue-700 bg-blue-100 px-3 py-1 rounded-md">ë¬¸í•­</h2>
                <span id="question-counter" class="text-gray-500 font-medium">0 / 0</span>
              </div>
              <div id="db-question-id" class="text-xs text-gray-500 hidden">ID: -</div>

              <p id="question-text" class="font-serif text-gray-800 text-base md:text-lg leading-relaxed mt-2">ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>

              <!-- íŒíŠ¸/ë³µìŠµ ë²„íŠ¼ ì˜ì—­ -->
              <div class="mt-3 flex items-center justify-between gap-1 md:gap-2">
                <!-- ì™¼ìª½: íŒíŠ¸/ì•”ê¸°íŒ/ë©”ëª¨ -->
                <div class="flex items-center gap-1 md:gap-2">
                  <button id="hint-btn" class="btn-ghost text-sm whitespace-nowrap">ğŸ’¡<span class="hidden md:inline"> íŒíŠ¸</span></button>
                  <button id="memory-tip-btn" class="btn-ghost text-sm whitespace-nowrap">ğŸ“Œ<span class="hidden md:inline"> ì•”ê¸°íŒ</span></button>
                  <button id="user-memo-btn" class="btn-ghost text-sm whitespace-nowrap flex items-center gap-1">
                    <span>ğŸ“</span><span id="user-memo-btn-text" class="hidden md:inline"> ë©”ëª¨</span>
                  </button>
                </div>

                <!-- ì˜¤ë¥¸ìª½: ë³µìŠµ ì¶”ê°€/ì œì™¸ -->
                <div class="flex items-center gap-1 md:gap-2">
                  <button id="review-flag-toggle" class="btn-ghost text-sm whitespace-nowrap flex items-center gap-1" aria-pressed="false" title="ë³µìŠµ í•„ìš” í† ê¸€">
                    <span class="text-yellow-500">â˜†</span><span class="hidden md:inline"> ë³µìŠµ ì¶”ê°€</span>
                  </button>
                  <button id="review-exclude-toggle" class="btn-ghost text-sm whitespace-nowrap flex items-center gap-1" aria-pressed="false" title="ì˜¤ëŠ˜ì˜ ë³µìŠµì—ì„œ ì œì™¸/í•´ì œ">
                    <span class="text-gray-600">â–</span><span class="hidden md:inline"> ë³µìŠµ ì œì™¸</span>
                  </button>
                </div>
              </div>

              <div id="hint-container" class="hidden mt-3 text-sm bg-purple-50 border border-purple-200 text-purple-800 rounded-lg p-3 dark:bg-indigo-900 dark:border-indigo-700 dark:text-indigo-100"></div>

              <!-- ì•”ê¸°íŒ ì»¨í…Œì´ë„ˆ -->
              <div id="memory-tip-container" class="hidden mt-3 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <div class="flex justify-between items-start mb-2">
                  <p class="text-sm font-bold text-gray-900">ğŸ’¡ ì•”ê¸° íŒ</p>
                  <div class="flex gap-2">
                    <button id="memory-tip-regen-btn" class="text-xs px-2 py-1 rounded bg-orange-100 text-gray-900 hover:bg-orange-200 transition">
                      ğŸ”„ ìƒˆë¡œ ìƒì„±
                    </button>
                    <button id="memory-tip-copy-btn" class="text-xs px-2 py-1 rounded bg-blue-100 text-blue-700 hover:bg-blue-200 transition">
                      ğŸ“‹ ë³µì‚¬
                    </button>
                  </div>
                </div>
                <pre id="memory-tip-content" class="whitespace-pre-wrap text-sm font-sans leading-relaxed" style="color: #111827 !important;"></pre>
              </div>

              <!-- ë©”ëª¨ ì»¨í…Œì´ë„ˆ -->
              <div id="user-memo-container" class="hidden mt-3 p-4 bg-yellow-50 border border-yellow-200 rounded-lg relative">
                <div class="flex justify-between items-center mb-2">
                  <label class="text-sm font-bold text-yellow-800">ğŸ“ ë‚˜ë§Œì˜ í•µì‹¬ ìš”ì•½</label>
                  <button id="save-memo-btn" class="text-xs px-3 py-1 bg-yellow-200 text-yellow-800 rounded hover:bg-yellow-300 font-bold">ì €ì¥</button>
                </div>
                <textarea
                  id="user-memo-input"
                  class="w-full p-2 text-sm border border-yellow-300 rounded bg-white focus:ring-1 focus:ring-yellow-500"
                  rows="2"
                  maxlength="50"
                  placeholder="ì˜ˆ: ì„±.ì‹œ.ë²” (AI ì•”ê¸°íŒì— ë°˜ì˜ë¨)"></textarea>
                <div class="text-right text-xs text-gray-400 mt-1">
                  <span id="memo-char-count">0</span>/50ì
                </div>
              </div>
            </div>

            <div class="flex items-center justify-between mb-2">
              <label for="user-answer" class="text-sm font-medium text-gray-700">ë‹µì•ˆ ì…ë ¥</label>
              <button id="load-prev-answer-btn" class="text-xs text-blue-600 hover:underline">ì´ì „ ë‹µì•ˆ ë¶ˆëŸ¬ì˜¤ê¸°</button>
            </div>

            <!-- ë‹µì•ˆ ì…ë ¥ ì˜ì—­: ìŒì„±ì…ë ¥ ë²„íŠ¼ í¬í•¨ -->
            <div class="relative">
              <textarea id="user-answer" name="user-answer" class="font-serif w-full p-4 pb-12 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition dark:bg-gray-800 dark:text-gray-100 dark:placeholder-gray-400 dark:border-gray-700" rows="8" placeholder="ì—¬ê¸°ì— ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”... (Enter=ì±„ì , Shift+Enter=ì¤„ë°”ê¿ˆ, Ctrl+[=ì´ì „ìœ„ì¹˜, Ctrl+]=í¬ì»¤ìŠ¤/í˜„í™©íŒ)"></textarea>

              <!-- ìŒì„±ì…ë ¥ ë²„íŠ¼: textarea ì˜¤ë¥¸ìª½ í•˜ë‹¨ì— floating -->
              <button id="record-btn" class="absolute bottom-2 right-2 p-2 min-w-[36px] bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition shadow-md flex items-center justify-center gap-0.5" data-state="idle" title="ìŒì„± ì…ë ¥ (STT)">
                <svg id="record-icon-mic" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 10-2 0 7.001 7.001 0 006 6.93V17H9a1 1 0 100 2h6a1 1 0 100-2h-2v-2.07z" clip-rule="evenodd" /></svg>
              </button>
            </div>

            <p id="error-message" class="text-red-500 text-sm mt-2 hidden">ë‹µì•ˆì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
            <p id="hotkey-guide" class="text-xs text-gray-500 mt-2">
              ë‹¨ì¶•í‚¤: Ctrl+â†/â†’ ì´ì „/ë‹¤ìŒ Â· Enter/G ì±„ì  Â· H íŒíŠ¸ Â· L ì´ì „ë‹µì•ˆ Â· R ëœë¤ Â· X ë³µìŠµì œì™¸ Â· S í˜„í™©íŒ Â· Ctrl+[ ì´ì „ìœ„ì¹˜ Â· Ctrl+] í¬ì»¤ìŠ¤
            </p>

            <!-- ì´ì „/ì±„ì í•˜ê¸°/ë‹¤ìŒ ë²„íŠ¼ (í•œ ì¤„) -->
            <div class="flex justify-between items-center my-5">
              <button id="prev-btn" class="btn-soft disabled:opacity-50 disabled:cursor-not-allowed">â†<span class="hidden md:inline"> ì´ì „</span></button>
              <button id="grade-btn" class="btn-primary px-8 relative min-w-[120px]">
                <span id="grade-btn-text">ì±„ì í•˜ê¸°</span>
                <div id="grade-loader" class="loader absolute inset-0 m-auto hidden" aria-hidden="true"></div>
              </button>
              <button id="next-btn" class="btn-soft disabled:opacity-50 disabled:cursor-not-allowed"><span class="hidden md:inline">ë‹¤ìŒ </span>â†’</button>
            </div>
          </div>

          <!-- ì±„ì  ê²°ê³¼ -->
          <div id="result-box" class="hidden bg-gray-50 border border-gray-200 rounded-lg p-6 mt-6 dark:bg-gray-800 dark:border-gray-700" aria-live="polite">
            <h3 class="font-sans text-2xl font-bold text-gray-900 mb-2 dark:text-gray-100">ì±„ì  ê²°ê³¼</h3>
            <div id="score-display" class="mb-5">
              <p class="font-sans text-lg font-medium text-gray-900 dark:text-gray-100">
                ìœ ì‚¬ë„ ì ìˆ˜: <span id="score" class="font-bold text-blue-600 text-2xl">0</span><span class="text-gray-600 dark:text-gray-400 text-lg">ì </span>
              </p>
              <div class="w-full bg-gray-200 progress-track rounded-full h-4 mt-2 overflow-hidden shadow-inner">
                <div id="progress-bar" class="h-4 rounded-full transition-all duration-500 ease-out" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" style="width: 0%"></div>
              </div>
            </div>
            <div>
              <h4 class="font-sans text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2 flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" class="w-6 h-6 inline-block"><rect width="100" height="100" rx="20" fill="#6D28D9"/><rect x="20" y="20" width="60" height="60" rx="10" fill="white"/><circle cx="36" cy="43" r="9" fill="#8B5CF6"/><text x="36" y="46" font-size="14" fill="white" font-family="-apple-system,BlinkMacSystemFont,sans-serif" font-weight="900" text-anchor="middle" dominant-baseline="central">ã„±</text><g transform="translate(64, 43)"><path d="M0 0 L 4 10 L 14 14 L 4 18 L 0 28 L -4 18 L -14 14 L -4 10 Z" fill="#FACC15" transform="scale(0.8) translate(0, -14)"/></g><path d="M30 60 H 70 V 72 H 30 Z M35 60 V 72 M 40 60 V 72 M 45 60 V 72 M 50 60 V 72 M 55 60 V 72 M 60 60 V 72 M 65 60 V 72" fill="none" stroke="#4F46E5" stroke-width="2"/></svg>
                AI ì´í‰
              </h4>
              <div id="ai-feedback" class="font-serif bg-white dark:bg-gray-700 p-4 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-900 dark:text-gray-100 leading-relaxed min-h-[50px]"></div>
            </div>
          </div>

          <!-- ëª¨ë²” ë‹µì•ˆ -->
          <div id="model-answer-box" class="hidden bg-gray-50 border border-gray-200 rounded-lg p-6 mt-6 dark:bg-gray-800 dark:border-gray-700">
            <h4 class="font-sans text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2">ğŸ“˜ ëª¨ë²” ë‹µì•ˆ</h4>
            <pre id="correct-answer" class="font-serif bg-white dark:bg-gray-700 p-4 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-900 dark:text-gray-100 text-sm leading-relaxed"></pre>
          </div>

          <!-- í•™ìŠµ í˜„í™©íŒ -->
          <div id="summary-area" class="mt-8 pt-6 border-t hidden">
            <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between mb-3">
              <h3 class="text-xl font-bold text-gray-800">í•™ìŠµ í˜„í™©íŒ (í´ë¦­í•˜ì—¬ ì´ë™)</h3>
              <div class="flex flex-wrap gap-3 items-center">
                <div class="flex items-center gap-2">
                  <span class="text-sm text-gray-600">ë³´ê¸°:</span>
                  <button id="summary-view-all" class="px-3 py-1.5 text-sm border rounded bg-gray-100 hover:bg-gray-200">ëª¨ë“  ë‹¨ì›ë³´ê¸°</button>
                  <button id="summary-view-current" class="px-3 py-1.5 text-sm border rounded">í˜„ì¬ í•™ìŠµë‹¨ì›ë³´ê¸°</button>
                </div>
                <div class="flex gap-4">
                  <button id="clear-filter-btn" class="text-sm text-blue-700 hover:underline dark:text-blue-300">í•„í„° í•´ì œ</button>
                  <button id="reset-scores-btn" class="text-sm text-red-600 hover:underline dark:text-red-300">í•™ìŠµ ê¸°ë¡ ì´ˆê¸°í™”</button>
                </div>
              </div>
            </div>
            <div id="score-summary" class="flex flex-wrap gap-2"></div>
          </div>
        </div>
      </main>

      <!-- RIGHT -->
      <aside id="right-explorer" class="lg:col-span-3 xl:col-span-3 2xl:col-span-3 space-y-4">
        <div class="bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm p-6">
          <div class="flex items-center justify-between mb-2 cursor-pointer" id="source-filter-toggle">
            <h3 class="font-bold text-lg text-gray-900 dark:text-gray-100">í•™ìŠµ ë²”ìœ„ í•„í„°</h3>
            <svg class="w-5 h-5 transition-transform duration-200 text-gray-900 dark:text-gray-100" id="source-filter-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </div>
          <div id="source-filter-side" class="transition-all duration-200"></div>
        </div>
        <div class="bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm p-6">
          <div class="flex items-center justify-between mb-2 cursor-pointer" id="chapter-nav-toggle">
            <h3 class="font-bold text-lg text-gray-900 dark:text-gray-100">ë‹¨ì› ë„¤ë¹„ê²Œì´í„°</h3>
            <svg class="w-5 h-5 transition-transform duration-200 text-gray-900 dark:text-gray-100" id="chapter-nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </div>
          <div id="explorer-chapters" class="space-y-2 transition-all duration-200 text-gray-900 dark:text-gray-100"></div>
        </div>
        <div class="bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm p-6">
          <div class="flex items-center justify-between mb-2 cursor-pointer" id="problem-list-toggle">
            <h3 class="font-bold text-lg whitespace-nowrap no-kr-break text-gray-900 dark:text-gray-100">ë¬¸ì œ ëª©ë¡</h3>
            <svg class="w-5 h-5 transition-transform duration-200 text-gray-900 dark:text-gray-100" id="problem-list-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </div>

          <div id="problem-list-content" class="transition-all duration-200">
            <div class="mb-2">
              <input id="explorer-search" name="explorer-search" class="w-full border rounded px-2 py-1 text-sm" placeholder="ê²€ìƒ‰..." aria-label="ë¬¸ì œ ê²€ìƒ‰">
            </div>
            <div id="explorer-problems" class="space-y-1 max-h-[60vh] overflow-y-auto pr-1 text-gray-900 dark:text-gray-100"></div>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <!-- API í‚¤ ëª¨ë‹¬ -->
  <div id="api-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-[1000]">
    <div class="bg-white rounded-2xl w-full max-w-md p-6 shadow-xl">
      <h2 class="text-xl font-bold text-gray-800">Gemini API í‚¤ ì¸ì¦</h2>
      <p class="text-sm text-gray-600 mt-1">ìµœì´ˆ 1íšŒë§Œ ì…ë ¥í•©ë‹ˆë‹¤. ë¡œì»¬ ì €ì¥ì„ ì²´í¬í•˜ë©´ ë‹¤ìŒë¶€í„°ëŠ” íŒì—…ì´ ëœ¨ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
      <p class="text-sm mt-2">ì²˜ìŒ ì‚¬ìš©í•˜ì‹œë‚˜ìš”?
        <a href="README.html" target="_blank" rel="noopener" class="underline text-blue-600 dark:text-blue-300">ë„ì›€ë§(README)</a>ë¥¼ í™•ì¸í•˜ì„¸ìš”.
      </p>

      <form id="api-key-form">
        <label for="api-modal-input" class="block text-sm font-medium text-gray-700 mt-4">ğŸ”‘ API Key</label>
        <input type="password" id="api-modal-input" name="api-key"
               class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:text-gray-100 dark:placeholder-gray-400 dark:border-gray-700"
               placeholder="Google AI Studio API í‚¤" autocomplete="off" spellcheck="false" inputmode="text" />

        <div class="flex items-center gap-2 mt-2">
          <input type="checkbox" id="modal-remember" name="remember-api-key" class="rounded border-gray-300" />
          <label for="modal-remember" class="text-sm text-gray-700">ì´ ë¸Œë¼ìš°ì €ì— í‚¤ ì €ì¥</label>
        </div>
        <p class="text-xs text-yellow-600 mt-1">âš ï¸ ê³µìš© PCì—ì„œëŠ” ì²´í¬ í•´ì œë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.</p>

        <div class="mt-5 flex justify-end gap-2">
          <button type="button" id="api-cancel-btn" class="px-3 py-2 text-sm text-gray-600 hover:text-gray-900">ì·¨ì†Œ</button>
          <button type="submit" id="api-save-btn" class="px-4 py-2 bg-blue-600 text-white text-sm font-semibold rounded-lg hover:bg-blue-700">ì €ì¥</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ì—…ì  ëª¨ë‹¬ -->
  <div id="achievements-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-[1002] p-4 overflow-y-auto">
    <div role="dialog" aria-modal="true" aria-labelledby="achievements-title" class="bg-white dark:bg-gray-900 dark:text-gray-100 rounded-2xl w-full max-w-4xl shadow-xl max-h-[90vh] overflow-y-auto">
      <div class="sticky top-0 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 px-6 py-4 flex items-center justify-between rounded-t-2xl">
        <h2 id="achievements-title" class="text-2xl font-bold">ğŸ† ë‚˜ì˜ ì—…ì </h2>
        <button id="achievements-close-btn" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 text-2xl leading-none" aria-label="ë‹«ê¸°">Ã—</button>
      </div>

      <div class="p-6">
        <!-- ì—…ì  í†µê³„ -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
          <div class="bg-gradient-to-br from-yellow-50 to-amber-50 dark:from-gray-800 dark:to-gray-700 rounded-lg p-4 text-center border border-yellow-200 dark:border-gray-600">
            <div class="text-3xl font-bold text-yellow-600 dark:text-yellow-400"><span id="achievement-count-total">0</span></div>
            <div class="text-sm text-gray-600 dark:text-gray-400">ì „ì²´ ì—…ì </div>
          </div>
          <div class="bg-gradient-to-br from-green-50 to-emerald-50 dark:from-gray-800 dark:to-gray-700 rounded-lg p-4 text-center border border-green-200 dark:border-gray-600">
            <div class="text-3xl font-bold text-green-600 dark:text-green-400"><span id="achievement-count-unlocked">0</span></div>
            <div class="text-sm text-gray-600 dark:text-gray-400">ë‹¬ì„± ì™„ë£Œ</div>
          </div>
          <div class="bg-gradient-to-br from-blue-50 to-sky-50 dark:from-gray-800 dark:to-gray-700 rounded-lg p-4 text-center border border-blue-200 dark:border-gray-600">
            <div class="text-3xl font-bold text-blue-600 dark:text-blue-400"><span id="achievement-progress-percent">0</span>%</div>
            <div class="text-sm text-gray-600 dark:text-gray-400">ë‹¬ì„±ë¥ </div>
          </div>
          <div class="bg-gradient-to-br from-purple-50 to-violet-50 dark:from-gray-800 dark:to-gray-700 rounded-lg p-4 text-center border border-purple-200 dark:border-gray-600">
            <div class="text-3xl font-bold text-purple-600 dark:text-purple-400"><span id="achievement-points">0</span>P</div>
            <div class="text-sm text-gray-600 dark:text-gray-400">ì—…ì  í¬ì¸íŠ¸</div>
          </div>
        </div>

        <!-- í‹°ì–´ í•„í„° -->
        <div class="flex gap-2 mb-4 overflow-x-auto pb-2">
          <button class="achievement-tier-filter px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600" data-tier="all">ì „ì²´</button>
          <button class="achievement-tier-filter px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400 hover:bg-amber-200" data-tier="bronze">ğŸ¥‰ ë¸Œë¡ ì¦ˆ</button>
          <button class="achievement-tier-filter px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap bg-gray-300 text-gray-800 dark:bg-gray-600 dark:text-gray-200 hover:bg-gray-400" data-tier="silver">ğŸ¥ˆ ì‹¤ë²„</button>
          <button class="achievement-tier-filter px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400 hover:bg-yellow-200" data-tier="gold">ğŸ¥‡ ê³¨ë“œ</button>
          <button class="achievement-tier-filter px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap bg-cyan-100 text-cyan-800 dark:bg-cyan-900/30 dark:text-cyan-400 hover:bg-cyan-200" data-tier="platinum">ğŸ”· í”Œë˜í‹°ë„˜</button>
          <button class="achievement-tier-filter px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400 hover:bg-blue-200" data-tier="diamond">ğŸ’ ë‹¤ì´ì•„ëª¬ë“œ</button>
          <button class="achievement-tier-filter px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400 hover:bg-purple-200" data-tier="master">ğŸ‘‘ ë§ˆìŠ¤í„°</button>
          <button class="achievement-tier-filter px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap bg-pink-100 text-pink-800 dark:bg-pink-900/30 dark:text-pink-400 hover:bg-pink-200" data-tier="hidden">ğŸ¤« íˆë“ </button>
        </div>

        <!-- ì—…ì  ë¦¬ìŠ¤íŠ¸ -->
        <div id="achievements-list" class="space-y-3"></div>
      </div>
    </div>
  </div>

  <!-- Phase 3.3: ì†Œì…œ ëª¨ë‹¬ (ë­í‚¹ & ê·¸ë£¹) -->
  <div id="ranking-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-[1002] p-4 overflow-y-auto">
    <div role="dialog" aria-modal="true" aria-labelledby="ranking-title" class="bg-white dark:bg-gray-900 dark:text-gray-100 rounded-2xl w-full max-w-5xl shadow-xl max-h-[90vh] overflow-y-auto">
      <!-- í—¤ë” -->
      <div class="sticky top-0 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 px-6 py-4 flex items-center justify-between rounded-t-2xl z-10">
        <h2 id="ranking-title" class="text-2xl font-bold">ğŸ“Š ì†Œì…œ</h2>
        <button id="ranking-close-btn" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 text-2xl leading-none" aria-label="ë‹«ê¸°">Ã—</button>
      </div>

      <!-- ë©”ì¸ íƒ­ -->
      <div class="sticky top-[73px] bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 px-6 py-3 z-10">
        <div class="flex gap-2 overflow-x-auto pb-1">
          <button class="ranking-main-tab px-4 py-2 rounded-lg text-sm font-bold whitespace-nowrap bg-blue-600 dark:bg-blue-500 text-white" data-tab="global">
            ğŸŒ ì „ì²´
          </button>
          <button class="ranking-main-tab px-4 py-2 rounded-lg text-sm font-bold whitespace-nowrap bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200" data-tab="all-groups">
            ğŸ“Š ì „ì²´ ê·¸ë£¹
          </button>
          <button class="ranking-main-tab px-4 py-2 rounded-lg text-sm font-bold whitespace-nowrap bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200" data-tab="all-classes">
            ğŸ“š ì „ì²´ ê³ ì‹œë°˜
          </button>
          <button class="ranking-main-tab px-4 py-2 rounded-lg text-sm font-bold whitespace-nowrap bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200" data-tab="my-groups">
            ğŸ‘¥ ë‚´ ê·¸ë£¹
          </button>
          <button class="ranking-main-tab px-4 py-2 rounded-lg text-sm font-bold whitespace-nowrap bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200" data-tab="my-classes">
            ğŸ›ï¸ ë‚´ ê³ ì‹œë°˜
          </button>
        </div>
      </div>

      <div class="p-6">
        <!-- ======================================== -->
        <!-- ğŸŒ ì „ì²´ íƒ­ ì½˜í…ì¸  (ê°œì¸ ì „ì²´ ë­í‚¹) -->
        <!-- ======================================== -->
        <div id="ranking-tab-global" class="ranking-tab-content">
          <!-- í•„í„°: ê¸°ì¤€ + ê¸°ê°„ (í•œ ì¤„) -->
          <div class="flex items-center justify-between gap-4 mb-6">
            <!-- ì™¼ìª½: ê¸°ì¤€ ì„ íƒ ë²„íŠ¼ + ì—…ë°ì´íŠ¸ ì‹œê°„ -->
            <div class="flex gap-2 items-center overflow-x-auto pb-2">
              <button class="ranking-criteria-filter px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap bg-blue-500 text-white" data-criteria="totalScore">ğŸ“Š ì´ì ìˆ˜</button>
              <button class="ranking-criteria-filter px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600" data-criteria="problems">âœï¸ ë¬¸í’€íšŸìˆ˜</button>
              <button class="ranking-criteria-filter px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600" data-criteria="avgScore">â­ í‰ê· ì ìˆ˜</button>
              <span class="text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap ml-2">ë°ì´í„° ì—…ë°ì´íŠ¸: ë§¤ì¼ 8ì‹œ, 13ì‹œ, 18ì‹œ, 23ì‹œ</span>
            </div>

            <!-- ì˜¤ë¥¸ìª½: ê¸°ê°„ ë“œë¡­ë‹¤ìš´ -->
            <select id="global-period-select" class="px-4 py-2 rounded-lg text-sm font-medium bg-white dark:bg-gray-800 border-2 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 cursor-pointer">
              <option value="daily">ğŸ“… ì¼ê°„</option>
              <option value="weekly">ğŸ“Š ì£¼ê°„</option>
              <option value="monthly">ğŸ“† ì›”ê°„</option>
            </select>
          </div>

          <!-- ë­í‚¹ ë¦¬ìŠ¤íŠ¸ -->
          <div id="ranking-list" class="space-y-2">
            <!-- ë¡œê·¸ì¸ í•„ìš” ì•ˆë‚´ -->
            <div id="ranking-login-required" class="text-center py-12 text-gray-500 dark:text-gray-400">
              <p class="text-lg mb-2">ğŸ”’ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</p>
              <p class="text-sm">ë¡œê·¸ì¸í•˜ì—¬ ì†Œì…œ ê¸°ëŠ¥ì„ ì´ìš©í•˜ì„¸ìš”!</p>
            </div>
            <!-- ë­í‚¹ í•­ëª©ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
          </div>
        </div>

        <!-- ======================================== -->
        <!-- ğŸ“Š ì „ì²´ ê·¸ë£¹ íƒ­ ì½˜í…ì¸  -->
        <!-- ======================================== -->
        <div id="ranking-tab-all-groups" class="ranking-tab-content hidden">
          <!-- ë¡œê·¸ì¸ í•„ìš” ì•ˆë‚´ -->
          <div id="groups-login-required" class="hidden text-center py-12 text-gray-500 dark:text-gray-400">
            <p class="text-lg mb-2">ğŸ”’ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</p>
            <p class="text-sm">ë¡œê·¸ì¸í•˜ì—¬ ê·¸ë£¹ ê¸°ëŠ¥ì„ ì´ìš©í•˜ì„¸ìš”!</p>
          </div>

          <!-- ê·¸ë£¹ ê°€ì… ì‹œ í‘œì‹œë  ì½˜í…ì¸  -->
          <div id="groups-content" class="hidden">
            <!-- ì„œë¸Œ íƒ­ + ì •ë ¬ ê¸°ì¤€ í•„í„° -->
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-6">
              <!-- ì„œë¸Œ íƒ­ ë²„íŠ¼ -->
              <div class="flex gap-2 overflow-x-auto pb-2 sm:pb-0">
                <button class="ranking-group-subtab px-5 py-2.5 rounded-lg text-sm font-bold whitespace-nowrap bg-green-600 dark:bg-green-500 text-white" data-subtab="group-level">
                  ğŸ† ê·¸ë£¹ë³„ ë­í‚¹
                </button>
                <button class="ranking-group-subtab px-5 py-2.5 rounded-lg text-sm font-bold whitespace-nowrap bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200" data-subtab="intra-group">
                  ğŸ‘¤ ê·¸ë£¹ ë‚´ ë­í‚¹
                </button>
              </div>

              <!-- ì •ë ¬ ê¸°ì¤€ + ê¸°ê°„ í•„í„° -->
              <div class="flex gap-2 overflow-x-auto pb-2 sm:pb-0">
                <button class="ranking-criteria-filter px-3 py-2 rounded-lg text-xs font-medium whitespace-nowrap bg-blue-500 text-white" data-criteria="totalScore">
                  ğŸ“Š ì´ì ìˆ˜
                </button>
                <button class="ranking-criteria-filter px-3 py-2 rounded-lg text-xs font-medium whitespace-nowrap bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200" data-criteria="problems">
                  âœï¸ ë¬¸í’€íšŸìˆ˜
                </button>
                <button class="ranking-criteria-filter px-3 py-2 rounded-lg text-xs font-medium whitespace-nowrap bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200" data-criteria="avgScore">
                  â­ í‰ê· ì ìˆ˜
                </button>
                <!-- êµ¬ë¶„ì„  -->
                <div class="h-6 w-px bg-gray-300 dark:bg-gray-600 mx-1 self-center"></div>
                <!-- ê¸°ê°„ ì„ íƒ -->
                <button class="ranking-period-filter px-3 py-2 rounded-lg text-xs font-medium whitespace-nowrap bg-blue-500 text-white" data-period="daily">
                  ì¼
                </button>
                <button class="ranking-period-filter px-3 py-2 rounded-lg text-xs font-medium whitespace-nowrap bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200" data-period="weekly">
                  ì£¼
                </button>
                <button class="ranking-period-filter px-3 py-2 rounded-lg text-xs font-medium whitespace-nowrap bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200" data-period="monthly">
                  ì›”
                </button>
              </div>
            </div>

            <!-- ê·¸ë£¹ë³„ ë­í‚¹ ì½˜í…ì¸  -->
            <div id="group-level-content" class="ranking-group-subtab-content">
              <!-- ê¸°ê°„/ê¸°ì¤€ í•„í„° ë²„íŠ¼ì€ ì „ì²´ íƒ­ê³¼ ê³µìœ  -->
              <div id="group-level-list" class="mt-4">
                <p class="text-center text-gray-500 dark:text-gray-400 py-8">ë¡œë”© ì¤‘...</p>
              </div>
            </div>

            <!-- ê·¸ë£¹ ë‚´ ë­í‚¹ ì½˜í…ì¸  -->
            <div id="intra-group-content" class="ranking-group-subtab-content hidden">
              <p class="text-center text-gray-500 dark:text-gray-400 py-8">ê·¸ë£¹ ë‚´ ë­í‚¹ (êµ¬í˜„ ì˜ˆì •)</p>
            </div>
          </div>

          <!-- ë¹ˆ ìƒíƒœ (ê·¸ë£¹ ë¯¸ê°€ì…) -->
          <div id="groups-empty-state" class="text-center py-16">
            <div class="text-6xl mb-4">ğŸ“­</div>
            <h3 class="text-xl font-bold text-gray-700 dark:text-gray-300 mb-2">ê°€ì…í•œ ê·¸ë£¹ì´ ì—†ìŠµë‹ˆë‹¤</h3>
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">ìŠ¤í„°ë”” ê·¸ë£¹ì— ê°€ì…í•˜ì—¬ í•¨ê»˜ ê³µë¶€í•˜ì„¸ìš”!</p>
            <div class="flex gap-3 justify-center">
              <button onclick="window.GroupUI?.openCreateGroupModal()" class="px-6 py-3 bg-blue-600 dark:bg-blue-500 text-white font-bold rounded-lg shadow-lg hover:shadow-xl transition-all">
                â• ê·¸ë£¹ ë§Œë“¤ê¸°
              </button>
              <button onclick="window.GroupUI?.openSearchGroupModal()" class="px-6 py-3 bg-green-600 dark:bg-green-500 text-white font-bold rounded-lg shadow-lg hover:shadow-xl transition-all">
                ğŸ” ê·¸ë£¹ ì°¾ê¸°
              </button>
            </div>
          </div>
        </div>

        <!-- ======================================== -->
        <!-- ğŸ“š ì „ì²´ ê³ ì‹œë°˜ íƒ­ ì½˜í…ì¸  -->
        <!-- ======================================== -->
        <div id="ranking-tab-all-classes" class="ranking-tab-content hidden">
          <!-- ë¡œê·¸ì¸ í•„ìš” ì•ˆë‚´ -->
          <div id="classes-login-required" class="hidden text-center py-12 text-gray-500 dark:text-gray-400">
            <p class="text-lg mb-2">ğŸ”’ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</p>
            <p class="text-sm">ë¡œê·¸ì¸í•˜ì—¬ ê³ ì‹œë°˜ ê¸°ëŠ¥ì„ ì´ìš©í•˜ì„¸ìš”!</p>
          </div>

          <!-- ëŒ€í•™ ì´ë©”ì¼ ì¸ì¦ í•„ìš” ì•ˆë‚´ -->
          <div id="classes-verify-required" class="hidden text-center py-12">
            <div class="text-6xl mb-4">ğŸ“</div>
            <h3 class="text-xl font-bold text-gray-700 dark:text-gray-300 mb-2">ëŒ€í•™êµ ì´ë©”ì¼ ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤</h3>
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">ëŒ€í•™êµ ì´ë©”ì¼ì„ ì¸ì¦í•˜ì—¬ ê³ ì‹œë°˜ ë­í‚¹ì— ì°¸ì—¬í•˜ì„¸ìš”!</p>
            <button onclick="window.UniversityUI?.openVerifyModal()" class="px-6 py-3 bg-purple-600 dark:bg-purple-500 text-white font-bold rounded-lg shadow-lg hover:shadow-xl transition-all">
              âœ‰ï¸ ì´ë©”ì¼ ì¸ì¦í•˜ê¸°
            </button>
          </div>

          <!-- ê³ ì‹œë°˜ ì½˜í…ì¸  (ì¸ì¦ ì™„ë£Œ í›„) -->
          <div id="classes-content" class="hidden">
            <!-- ì„œë¸Œ íƒ­ + ì •ë ¬ ê¸°ì¤€ í•„í„° -->
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-6">
              <!-- ì„œë¸Œ íƒ­ ë²„íŠ¼ -->
              <div class="flex gap-2 overflow-x-auto pb-2 sm:pb-0">
                <button class="ranking-class-subtab px-5 py-2.5 rounded-lg text-sm font-bold whitespace-nowrap bg-purple-600 dark:bg-purple-500 text-white" data-subtab="class-level">
                  ğŸ† ë°˜ë³„ ë­í‚¹
                </button>
                <button class="ranking-class-subtab px-5 py-2.5 rounded-lg text-sm font-bold whitespace-nowrap bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200" data-subtab="intra-class">
                  ğŸ‘¤ ë°˜ ë‚´ ë­í‚¹
                </button>
              </div>

              <!-- ì •ë ¬ ê¸°ì¤€ + ê¸°ê°„ í•„í„° -->
              <div class="flex gap-2 overflow-x-auto pb-2 sm:pb-0">
                <button class="ranking-criteria-filter px-3 py-2 rounded-lg text-xs font-medium whitespace-nowrap bg-blue-500 text-white" data-criteria="totalScore">
                  ğŸ“Š ì´ì ìˆ˜
                </button>
                <button class="ranking-criteria-filter px-3 py-2 rounded-lg text-xs font-medium whitespace-nowrap bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200" data-criteria="problems">
                  âœï¸ ë¬¸í’€íšŸìˆ˜
                </button>
                <button class="ranking-criteria-filter px-3 py-2 rounded-lg text-xs font-medium whitespace-nowrap bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200" data-criteria="avgScore">
                  â­ í‰ê· ì ìˆ˜
                </button>
                <!-- êµ¬ë¶„ì„  -->
                <div class="h-6 w-px bg-gray-300 dark:bg-gray-600 mx-1 self-center"></div>
                <!-- ê¸°ê°„ ì„ íƒ -->
                <button class="ranking-period-filter px-3 py-2 rounded-lg text-xs font-medium whitespace-nowrap bg-blue-500 text-white" data-period="daily">
                  ì¼
                </button>
                <button class="ranking-period-filter px-3 py-2 rounded-lg text-xs font-medium whitespace-nowrap bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200" data-period="weekly">
                  ì£¼
                </button>
                <button class="ranking-period-filter px-3 py-2 rounded-lg text-xs font-medium whitespace-nowrap bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200" data-period="monthly">
                  ì›”
                </button>
              </div>
            </div>

            <!-- ë°˜ë³„ ë­í‚¹ ì½˜í…ì¸  (ëŒ€í•™êµë³„) -->
            <div id="class-level-content" class="ranking-class-subtab-content">
              <div id="university-level-list" class="mt-4">
                <p class="text-center text-gray-500 dark:text-gray-400 py-8">ë¡œë”© ì¤‘...</p>
              </div>
            </div>

            <!-- ë°˜ ë‚´ ë­í‚¹ ì½˜í…ì¸  (ëŒ€í•™ ë‚´ ê°œì¸) -->
            <div id="intra-class-content" class="ranking-class-subtab-content hidden">
              <div id="intra-university-list" class="mt-4">
                <p class="text-center text-gray-500 dark:text-gray-400 py-8">ë¡œë”© ì¤‘...</p>
              </div>
            </div>
          </div>
        </div>

        <!-- ======================================== -->
        <!-- ğŸ‘¥ ë‚´ ê·¸ë£¹ íƒ­ ì½˜í…ì¸  (ê·¸ë£¹ ê´€ë¦¬) -->
        <!-- ======================================== -->
        <div id="ranking-tab-my-groups" class="ranking-tab-content hidden">
          <!-- ë¡œê·¸ì¸ í•„ìš” ì•ˆë‚´ -->
          <div id="my-groups-login-required" class="hidden text-center py-12 text-gray-500 dark:text-gray-400">
            <p class="text-lg mb-2">ğŸ”’ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</p>
            <p class="text-sm">ë¡œê·¸ì¸í•˜ì—¬ ê·¸ë£¹ì„ ê´€ë¦¬í•˜ì„¸ìš”!</p>
          </div>

          <!-- ë‚´ ê·¸ë£¹ ê´€ë¦¬ ì½˜í…ì¸  -->
          <div id="my-groups-content" class="hidden">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-xl font-bold text-gray-900 dark:text-gray-100">ğŸ“‹ ë‚´ê°€ ê°€ì…í•œ ê·¸ë£¹ <span id="my-groups-count" class="text-sm font-normal text-gray-500 dark:text-gray-400">(0/3)</span></h3>
              <div class="flex gap-2">
                <button onclick="window.GroupUI?.openCreateGroupModal()" class="px-4 py-2 bg-blue-600 dark:bg-blue-500 text-white font-bold text-sm rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 transition">
                  â• ê·¸ë£¹ ë§Œë“¤ê¸°
                </button>
                <button onclick="window.GroupUI?.openSearchGroupModal()" class="px-4 py-2 bg-green-600 dark:bg-green-500 text-white font-bold text-sm rounded-lg hover:bg-green-700 dark:hover:bg-green-600 transition">
                  ğŸ” ê·¸ë£¹ ì°¾ê¸°
                </button>
              </div>
            </div>

            <!-- ë‚´ ê·¸ë£¹ ë¦¬ìŠ¤íŠ¸ -->
            <div id="my-groups-list" class="space-y-3">
              <p class="text-center py-8 text-gray-500">ë¡œë”© ì¤‘...</p>
            </div>
          </div>

          <!-- ë¹ˆ ìƒíƒœ (ê·¸ë£¹ ë¯¸ê°€ì…) -->
          <div id="my-groups-empty-state" class="hidden text-center py-16">
            <div class="text-6xl mb-4">ğŸ“­</div>
            <h3 class="text-xl font-bold text-gray-700 dark:text-gray-300 mb-2">ê°€ì…í•œ ê·¸ë£¹ì´ ì—†ìŠµë‹ˆë‹¤</h3>
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">ìŠ¤í„°ë”” ê·¸ë£¹ì— ê°€ì…í•˜ì—¬ í•¨ê»˜ ê³µë¶€í•˜ì„¸ìš”!</p>
            <div class="flex gap-3 justify-center">
              <button onclick="window.GroupUI?.openCreateGroupModal()" class="px-6 py-3 bg-blue-600 dark:bg-blue-500 text-white font-bold rounded-lg shadow-lg hover:shadow-xl transition-all">
                â• ê·¸ë£¹ ë§Œë“¤ê¸°
              </button>
              <button onclick="window.GroupUI?.openSearchGroupModal()" class="px-6 py-3 bg-green-600 dark:bg-green-500 text-white font-bold rounded-lg shadow-lg hover:shadow-xl transition-all">
                ğŸ” ê·¸ë£¹ ì°¾ê¸°
              </button>
            </div>
          </div>
        </div>

        <!-- ======================================== -->
        <!-- ğŸ›ï¸ ë‚´ ê³ ì‹œë°˜ íƒ­ ì½˜í…ì¸  (ê³ ì‹œë°˜ ê´€ë¦¬) -->
        <!-- ======================================== -->
        <div id="ranking-tab-my-classes" class="ranking-tab-content hidden">
          <div class="text-center py-16">
            <div class="text-6xl mb-4">ğŸ›ï¸</div>
            <h3 class="text-xl font-bold text-gray-700 dark:text-gray-300 mb-2">ë‚´ ê³ ì‹œë°˜ ê´€ë¦¬</h3>
            <p class="text-sm text-gray-500 dark:text-gray-400">ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤...</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Phase 3.5.2: ê·¸ë£¹ ìƒì„± ëª¨ë‹¬ -->
  <div id="create-group-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-[1100] p-4">
    <div role="dialog" aria-modal="true" aria-labelledby="create-group-title" class="bg-white dark:bg-gray-900 dark:text-gray-100 rounded-2xl w-full max-w-2xl shadow-xl max-h-[90vh] overflow-y-auto">
      <div class="sticky top-0 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 px-6 py-4 flex items-center justify-between rounded-t-2xl">
        <h2 id="create-group-title" class="text-2xl font-bold">â• ê·¸ë£¹ ë§Œë“¤ê¸°</h2>
        <button id="create-group-close-btn" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 text-2xl leading-none" aria-label="ë‹«ê¸°">Ã—</button>
      </div>

      <form id="create-group-form" class="p-6 space-y-4">
        <!-- ê·¸ë£¹ ì´ë¦„ -->
        <div>
          <label for="create-group-name" class="block text-sm font-bold text-gray-700 dark:text-gray-200 mb-2">
            ê·¸ë£¹ ì´ë¦„ <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            id="create-group-name"
            required
            minlength="2"
            maxlength="30"
            class="w-full p-3 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500"
            placeholder="ì˜ˆ: 2025 ê°ì‚¬ 1ì°¨ ëŒ€ë¹„ë°˜"
          />
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">2-30ì</p>
        </div>

        <!-- ê·¸ë£¹ ì„¤ëª… -->
        <div>
          <label for="create-group-description" class="block text-sm font-bold text-gray-700 dark:text-gray-200 mb-2">
            ê·¸ë£¹ ì„¤ëª…
          </label>
          <textarea
            id="create-group-description"
            rows="3"
            maxlength="200"
            class="w-full p-3 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500"
            placeholder="ê·¸ë£¹ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"
          ></textarea>
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">ìµœëŒ€ 200ì</p>
        </div>

        <!-- ë¹„ë°€ë²ˆí˜¸ -->
        <div>
          <label for="create-group-password" class="block text-sm font-bold text-gray-700 dark:text-gray-200 mb-2">
            ê·¸ë£¹ ë¹„ë°€ë²ˆí˜¸ <span class="text-gray-400 text-xs">(ì„ íƒ)</span>
          </label>
          <input
            type="password"
            id="create-group-password"
            minlength="4"
            class="w-full p-3 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500"
            placeholder="ë¹„ë°€ë²ˆí˜¸ ì—†ì´ ê³µê°œ ê·¸ë£¹ìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤"
          />
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">ì…ë ¥ ì‹œ ê°€ì… ì‹œ ë¹„ë°€ë²ˆí˜¸ í•„ìš” (ìµœì†Œ 4ì)</p>
        </div>

        <!-- ìµœëŒ€ ì¸ì› -->
        <div>
          <label for="create-group-max-members" class="block text-sm font-bold text-gray-700 dark:text-gray-200 mb-2">
            ìµœëŒ€ ì¸ì› <span class="text-red-500">*</span>
          </label>
          <input
            type="number"
            id="create-group-max-members"
            required
            min="2"
            max="100"
            value="50"
            class="w-full p-3 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500"
          />
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">2-100ëª…</p>
        </div>

        <!-- ê³µê°œ ì—¬ë¶€ (ìë™ ê²°ì •: ë¹„ë°€ë²ˆí˜¸ ì—†ìœ¼ë©´ ê³µê°œ, ìˆìœ¼ë©´ ë¹„ê³µê°œ) -->
        <div class="text-sm text-gray-500 dark:text-gray-400 bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg">
          ğŸ’¡ <strong>ê³µê°œ/ë¹„ê³µê°œëŠ” ìë™ ê²°ì •ë©ë‹ˆë‹¤:</strong><br>
          â€¢ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ì•ˆ í•¨ â†’ ğŸŒ ê³µê°œ ê·¸ë£¹ (ê²€ìƒ‰ ê°€ëŠ¥)<br>
          â€¢ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥í•¨ â†’ ğŸ”’ ë¹„ê³µê°œ ê·¸ë£¹ (ë¹„ë°€ë²ˆí˜¸ í•„ìš”)
        </div>

        <!-- ì œì¶œ ë²„íŠ¼ -->
        <div class="flex gap-3 pt-4">
          <button
            type="button"
            id="create-group-cancel-btn"
            class="flex-1 px-6 py-3 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-200 font-bold rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800"
            onclick="document.getElementById('create-group-close-btn').click()"
          >
            ì·¨ì†Œ
          </button>
          <button
            type="submit"
            id="create-group-submit-btn"
            class="flex-1 px-6 py-3 bg-blue-600 dark:bg-blue-500 text-white font-bold rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600"
          >
            ê·¸ë£¹ ìƒì„±
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Phase 3.5.2: ê·¸ë£¹ ê²€ìƒ‰/ê°€ì… ëª¨ë‹¬ -->
  <div id="search-group-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-[1100] p-4">
    <div role="dialog" aria-modal="true" aria-labelledby="search-group-title" class="bg-white dark:bg-gray-900 dark:text-gray-100 rounded-2xl w-full max-w-3xl shadow-xl max-h-[90vh] overflow-y-auto">
      <div class="sticky top-0 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 px-6 py-4 flex items-center justify-between rounded-t-2xl">
        <h2 id="search-group-title" class="text-2xl font-bold">ğŸ” ê·¸ë£¹ ì°¾ê¸°</h2>
        <button id="search-group-close-btn" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 text-2xl leading-none" aria-label="ë‹«ê¸°">Ã—</button>
      </div>

      <div class="p-6">
        <!-- ê²€ìƒ‰ í¼ -->
        <form id="search-group-form" class="mb-6">
          <div class="flex gap-2">
            <input
              type="text"
              id="search-group-input"
              class="flex-1 p-3 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500"
              placeholder="ê·¸ë£¹ ì´ë¦„ì´ë‚˜ ì„¤ëª… ê²€ìƒ‰..."
            />
            <button
              type="submit"
              class="px-6 py-3 bg-blue-600 dark:bg-blue-500 text-white font-bold rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600"
            >
              ê²€ìƒ‰
            </button>
          </div>
        </form>

        <!-- ê·¸ë£¹ ë¦¬ìŠ¤íŠ¸ -->
        <div id="search-group-list" class="space-y-3">
          <div class="text-center py-8 text-gray-500">ë¡œë”© ì¤‘...</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ======================================== -->
  <!-- Phase 3.6: ëŒ€í•™êµ ì´ë©”ì¼ ì¸ì¦ ëª¨ë‹¬ -->
  <!-- ======================================== -->
  <div id="university-verify-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-[9999] p-4">
    <div role="dialog" aria-modal="true" aria-labelledby="university-verify-title" class="bg-white dark:bg-gray-900 dark:text-gray-100 rounded-2xl w-full max-w-2xl shadow-xl max-h-[90vh] overflow-y-auto">
      <!-- í—¤ë” -->
      <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
        <h2 id="university-verify-title" class="text-2xl font-bold">ğŸ“ ëŒ€í•™êµ ì´ë©”ì¼ ì¸ì¦</h2>
        <button id="university-verify-close-btn" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 text-2xl leading-none" aria-label="ë‹«ê¸°">Ã—</button>
      </div>

      <!-- ì½˜í…ì¸  -->
      <div class="p-6">
        <!-- ì¸ì¦ ì•ˆë‚´ -->
        <div class="mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-lg">
          <p class="text-sm text-blue-900 dark:text-blue-100 font-medium mb-2">ğŸ“Œ ì¸ì¦ ì•ˆë‚´</p>
          <ul class="text-sm text-blue-800 dark:text-blue-200 space-y-1 list-disc list-inside">
            <li>ëŒ€í•™êµ ì´ë©”ì¼(@ac.kr ë“±)ë¡œ ì¸ì¦í•©ë‹ˆë‹¤</li>
            <li>ì¸ì¦ì€ í•œ ë²ˆë§Œ ê°€ëŠ¥í•˜ë©° ë³€ê²½ ë¶ˆê°€í•©ë‹ˆë‹¤</li>
            <li>ì¸ì¦ í›„ ê³ ì‹œë°˜ ë­í‚¹ì— ì°¸ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
          </ul>
        </div>

        <!-- ì¸ì¦ í¼ -->
        <form id="university-verify-form" class="space-y-4">
          <div>
            <label for="university-email" class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">ëŒ€í•™êµ ì´ë©”ì¼</label>
            <input
              type="email"
              id="university-email"
              class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-purple-500"
              placeholder="example@university.ac.kr"
              required
            />
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">í•™êµ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
          </div>

          <div class="flex gap-3">
            <button
              type="submit"
              id="university-verify-submit-btn"
              class="flex-1 px-6 py-3 bg-purple-600 dark:bg-purple-500 text-white font-bold rounded-lg hover:bg-purple-700 dark:hover:bg-purple-600 transition"
            >
              âœ‰ï¸ ì¸ì¦ ë©”ì¼ ë°œì†¡
            </button>
            <button
              type="button"
              onclick="window.UniversityUI?.closeVerifyModal();"
              class="px-6 py-3 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 font-bold rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition"
            >
              ì·¨ì†Œ
            </button>
          </div>
        </form>

        <!-- ì¸ì¦ ì½”ë“œ ì…ë ¥ (ë©”ì¼ ë°œì†¡ í›„ í‘œì‹œ) -->
        <div id="verification-code-section" class="hidden mt-6 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-700 rounded-lg">
          <p class="text-sm text-green-900 dark:text-green-100 font-medium mb-4">âœ… ì¸ì¦ ë©”ì¼ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!</p>
          <form id="verification-code-form" class="space-y-3">
            <div>
              <label for="verification-code" class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">ì¸ì¦ ì½”ë“œ</label>
              <input
                type="text"
                id="verification-code"
                class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-green-500"
                placeholder="6ìë¦¬ ì¸ì¦ ì½”ë“œ ì…ë ¥"
                maxlength="6"
                required
              />
            </div>
            <button
              type="submit"
              id="verification-code-submit-btn"
              class="w-full px-6 py-3 bg-green-600 dark:bg-green-500 text-white font-bold rounded-lg hover:bg-green-700 dark:hover:bg-green-600 transition"
            >
              ì¸ì¦ ì™„ë£Œ
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- ì„¤ì • ëª¨ë‹¬ -->
  <div id="settings-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-[1001]">
    <div role="dialog" aria-modal="true" aria-labelledby="settings-title" class="bg-white dark:bg-gray-900 dark:text-gray-100 rounded-2xl w-full max-w-2xl p-6 shadow-xl max-h-[90vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-2">
        <h2 id="settings-title" class="text-2xl font-bold">ì„¤ì • âš™ï¸</h2>
        <button id="settings-close-btn" class="text-gray-500 hover:text-gray-800 dark:hover:text-white" aria-label="ë‹«ê¸°">âœ•</button>
      </div>

      <div class="mb-6 pb-6 border-b">
        <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-200 mb-3">API í‚¤ ì„¤ì •</h3>
        <button id="open-api-key-modal-btn" class="w-full bg-blue-50 border border-blue-300 text-blue-700 font-medium py-2 px-4 rounded-lg hover:bg-blue-100 transition">API í‚¤ ë³€ê²½/ì„¤ì •</button>
      </div>

      <!-- Phase 3.6: Firebase Extensionsë¥¼ í†µí•œ ì´ë©”ì¼ ë°œì†¡ (EmailJS ì„¤ì • ì œê±°ë¨) -->
      <!-- ëŒ€í•™êµ ì´ë©”ì¼ ì¸ì¦ì€ Firebase Consoleì—ì„œ Extensions ì„¤ì • í•„ìš” -->
      <!-- ìì„¸í•œ ë‚´ìš©ì€ FIRESTORE_RULES.md ì°¸ê³  -->

      <div class="mb-6 pb-6 border-b">
        <button id="dday-settings-toggle" class="w-full flex items-center justify-between mb-3 hover:opacity-70 transition text-left">
          <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-200">ğŸ“… ì‹œí—˜ ë‚ ì§œ (D-DAY)</h3>
          <span id="dday-settings-arrow" class="text-gray-500 dark:text-gray-400 text-lg">â–¶</span>
        </button>

        <div id="dday-settings-content" class="hidden">
          <input type="date" id="exam-date-input" name="exam-date" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100" aria-label="ì‹œí—˜ ë‚ ì§œ (D-DAY)" />
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">ì‹œí—˜ ë‚ ì§œë¥¼ ì„¤ì •í•˜ë©´ ìƒë‹¨ë°”ì— D-DAYê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>
          <button id="save-exam-date-btn" class="mt-3 w-full bg-red-50 border border-red-300 text-red-700 font-medium py-2 px-4 rounded-lg hover:bg-red-100 transition">D-DAY ì €ì¥</button>
        </div>
      </div>

      <div class="mb-6 pb-6 border-b">
        <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-200 mb-3">AI ëª¨ë¸ ì„ íƒ</h3>
        <select id="ai-model-select" name="ai-model" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700" aria-label="AI ëª¨ë¸ ì„ íƒ">
          <option value="gemini-2.5-flash-lite">âš¡ Gemini 2.5 Flash-Lite (ìµœê³  ì†ë„)</option>
          <option value="gemini-2.0-flash">âš–ï¸ Gemini 2.0 Flash (ì†ë„/í’ˆì§ˆ ê· í˜•)</option>
          <option value="gemini-2.5-flash">ğŸ§  Gemini 2.5 Flash (ìµœê³  í’ˆì§ˆ)</option>
          <option value="gemini-3-pro-preview">ğŸ’ Gemini 3 Pro Preview (ìµœì‹  ëª¨ë¸, ìœ ë£Œ - 25.11 ì¶œì‹œ)</option>
        </select>
        <p class="text-xs text-gray-500 mt-2">ğŸ’¡ ì¼ê´€ëœ ì±„ì  ê¸°ì¤€ì„ ìœ„í•´ ì„±í–¥ì— ë§ëŠ” ëª¨ë¸ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ì„¸ìš”. ì†ë„ ì¤‘ì‹œ: Lite / ê· í˜•: 2.0 / ì •í™•ë„ ì¤‘ì‹œ: 2.5 / ìµœì‹ : 3 Pro (ìœ ë£Œ)</p>
      </div>

      <div class="mb-6 pb-6 border-b">
        <button id="stt-settings-toggle" class="w-full flex items-center justify-between mb-3 hover:opacity-70 transition text-left">
          <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-200">ğŸ™ï¸ ìŒì„± ì¸ì‹ (STT) ì„¤ì • <span class="text-sm text-yellow-600 dark:text-yellow-400">(ì‹¤í—˜ì‹¤)</span></h3>
          <span id="stt-settings-arrow" class="text-gray-500 dark:text-gray-400 text-lg">â–¶</span>
        </button>

        <div id="stt-settings-content" class="hidden">
          <p class="text-xs text-gray-500 dark:text-gray-400 mb-4">
            ğŸ’¡ <strong>ê¶Œì¥:</strong> ëª¨ë°”ì¼ì—ì„œëŠ” í‚¤ë³´ë“œì˜ ê¸°ë³¸ ìŒì„± ì…ë ¥ ê¸°ëŠ¥ ì‚¬ìš©ì„ ì¶”ì²œí•©ë‹ˆë‹¤. (ë³„ë„ ì„¤ì • ë¶ˆí•„ìš”)
          </p>

          <label for="stt-provider-select" class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2">ê³µê¸‰ì ì„ íƒ</label>
          <select id="stt-provider-select" name="stt-provider" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700" aria-label="STT ê³µê¸‰ì ì„ íƒ">
            <option value="webspeech">Web Speech API (ë¬´ë£Œ, ì‹¤ì‹œê°„) âš¡</option>
            <option value="google">Google Cloud STT (ê³ ì •í™•ë„, ìœ ë£Œ)</option>
            <option value="none">ì‚¬ìš© ì•ˆ í•¨</option>
          </select>
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">
            <strong>Web Speech:</strong> ë¸Œë¼ìš°ì € ë‚´ì¥, ë¬´ë£Œ, ì‹¤ì‹œê°„ (Chrome/Edge ê¶Œì¥)<br>
            <strong>Google STT:</strong> ê³ ì •í™•ë„, API í‚¤ í•„ìš”, ì²˜ë¦¬ ì‹œê°„ ìˆìŒ
          </p>
          <p class="text-xs text-yellow-600 dark:text-yellow-400 mt-1">âš ï¸ STT API ì‚¬ìš©ì— ë”°ë¥¸ ë¹„ìš©ì€ ì‚¬ìš©ì ê°œì¸ì—ê²Œ ì²­êµ¬ë©ë‹ˆë‹¤.</p>

          <div id="stt-google-settings" class="mt-4 hidden">
            <form id="google-stt-form">
              <label for="google-stt-key" class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2">Google STT API Key</label>
              <input type="password" id="google-stt-key" name="google-stt-key" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:text-gray-100 dark:placeholder-gray-400 dark:border-gray-700" placeholder="Google STT API í‚¤" autocomplete="off">
            </form>
          </div>
        </div>
      </div>

      <div class="mb-6 pb-6 border-b">
        <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-200 mb-3">ë‹¤í¬ ëª¨ë“œ</h3>
        <select id="dark-mode-select" name="dark-mode" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700" aria-label="ë‹¤í¬ ëª¨ë“œ">
          <option value="system">ì‹œìŠ¤í…œ ì„¤ì • (ê¸°ë³¸)</option>
          <option value="light">ë¼ì´íŠ¸ ëª¨ë“œ</option>
          <option value="dark">ë‹¤í¬ ëª¨ë“œ</option>
        </select>
      </div>

      <!-- Task 3: ë³µìŠµ ê¸°ì¤€ ì„¤ì • -->
      <div class="mb-6 pb-6 border-b">
        <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-200 mb-3">ë³µìŠµ ê¸°ì¤€ ì„¤ì •</h3>
        <select id="review-mode-select" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
          <option value="hlr">HLR ê¸°ë°˜ (ì¶”ì²œ) - ë§ê° ê³¡ì„  ê¸°ë°˜ ì§€ëŠ¥í˜• ë³µìŠµ</option>
          <option value="time">ì‹œê°„ ê¸°ë°˜ (ê¸°ì¡´) - 3ì¼/10ì¼ ê¸°ì¤€ ë‹¨ìˆœ ë¶„ë¥˜</option>
        </select>
        <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">
          HLR(ë§ê° ê³¡ì„ ) ê¸°ë°˜ì€ ê°œì¸ë³„ í•™ìŠµ íŒ¨í„´ì„ ë¶„ì„í•˜ì—¬ ìµœì ì˜ ë³µìŠµ ì‹œê¸°ë¥¼ ì œì•ˆí•©ë‹ˆë‹¤.
        </p>
      </div>

      <!-- ì•”ê¸°íŒ ìŠ¤íƒ€ì¼ ì„¤ì • -->
      <div class="mb-6 pb-6 border-b">
        <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-200 mb-3">ğŸ’¡ ì•”ê¸°íŒ ìŠ¤íƒ€ì¼</h3>
        <select id="memory-tip-mode-select" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100">
          <option value="mild">Mild ë²„ì „ (ê¶Œì¥)</option>
          <option value="stimulating">âš ï¸ ìê·¹ì ì¸ ë²„ì „ (ì£¼ì˜)</option>
        </select>
        <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">
          <strong>Mild:</strong> ì¼ë°˜ì ì´ê³  ì˜¨ê±´í•œ ì•”ê¸° ê¸°ë²• ì‚¬ìš©<br>
          <strong>ìê·¹ì ì¸ ë²„ì „:</strong> ì„ ì •ì ì´ê³  ê°•ë ¬í•œ í‘œí˜„ì„ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>
      </div>

      <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-200 mb-3">ë°ì´í„° ê´€ë¦¬</h3>
        <div class="flex gap-3 mb-2">
          <button id="export-data-btn" class="flex-1 bg-green-50 border border-green-300 text-green-700 font-medium py-2 px-4 rounded-lg hover:bg-green-100 transition">ğŸ“¥ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
          <button id="import-data-btn" class="flex-1 bg-yellow-50 border border-yellow-300 text-yellow-700 font-medium py-2 px-4 rounded-lg hover:bg-yellow-100 transition">ğŸ“¤ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</button>
        </div>
        <div class="flex gap-3">
          <button id="merge-data-btn" class="flex-1 bg-blue-50 border border-blue-300 text-blue-700 font-medium py-2 px-4 rounded-lg hover:bg-blue-100 transition">ğŸ”€ ë°ì´í„° ë³‘í•© ê°€ì ¸ì˜¤ê¸°</button>
        </div>
        <input type="file" id="import-file-input" name="import-data-file" accept=".json" class="hidden" aria-label="ë°ì´í„° ê°€ì ¸ì˜¤ê¸° íŒŒì¼ ì„ íƒ" />
        <input type="file" id="merge-file-input" name="merge-data-file" accept=".json" class="hidden" aria-label="ë°ì´í„° ë³‘í•© íŒŒì¼ ì„ íƒ" />
        <p class="text-xs text-gray-500 mt-2">í•™ìŠµ ê¸°ë¡ ë° ì„¤ì •ì„ ë°±ì—…í•˜ê±°ë‚˜ ë³µì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³‘í•© ê°€ì ¸ì˜¤ê¸°ëŠ” ê¸°ì¡´ ë°ì´í„°ì™€ ìƒˆ ë°ì´í„°ë¥¼ í•©ì¹©ë‹ˆë‹¤.</p>
      </div>

      <div class="flex justify-end">
        <button id="settings-close-btn-bottom" class="px-6 py-2 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300 transition dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600 border dark:border-gray-600">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

  <!-- í•™ìŠµ ë¦¬í¬íŠ¸ ëª¨ë‹¬ -->
  <div id="report-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-[1002] p-4 overflow-y-auto">
    <div role="dialog" aria-modal="true" aria-labelledby="report-title" class="bg-white dark:bg-gray-900 dark:text-gray-100 rounded-2xl w-full max-w-5xl shadow-xl max-h-[90vh] overflow-y-auto" style="-webkit-overflow-scrolling: touch;">
      <!-- í—¤ë” -->
      <div class="sticky top-0 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 p-6 z-10">
  <div class="flex items-center justify-between mb-4">

    <h2 id="report-title" class="text-2xl font-bold text-gray-900 dark:text-white">ğŸ“Š í•™ìŠµ ë¦¬í¬íŠ¸</h2>

    <button id="report-close-btn" class="text-gray-500 hover:text-gray-800 dark:hover:text-white text-2xl" aria-label="ë‹«ê¸°">âœ•</button>
  </div>
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3">
          <div class="flex flex-col sm:flex-row sm:flex-wrap sm:items-center gap-3">
            <div class="flex items-center gap-2">
              <label for="report-period-select" class="text-sm font-medium whitespace-nowrap">ë°ì´í„° ë²”ìœ„:</label>
              <select id="report-period-select" name="report-period" class="px-3 py-1.5 text-sm border rounded-lg dark:bg-gray-800 dark:border-gray-700">
                <option value="30">ìµœê·¼ 30ì¼</option>
                <option value="60">ìµœê·¼ 60ì¼</option>
                <option value="90">ìµœê·¼ 90ì¼</option>
                <option value="all">ì „ì²´ ê¸°ê°„</option>
              </select>
            </div>
            <div class="flex items-center gap-2">
              <label for="report-threshold-select" class="text-sm font-medium whitespace-nowrap">ë¶„ì„ ëŒ€ìƒ:</label>
              <select id="report-threshold-select" name="report-threshold" class="px-3 py-1.5 text-sm border rounded-lg dark:bg-gray-800 dark:border-gray-700">
                <option value="60">60ì  ë¯¸ë§Œ</option>
                <option value="70">70ì  ë¯¸ë§Œ</option>
                <option value="80">80ì  ë¯¸ë§Œ</option>
              </select>
            </div>
          </div>
          <div class="flex items-center gap-2 flex-wrap">
            <button id="report-refresh-btn" class="px-3 py-1.5 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 whitespace-nowrap">ìƒˆë¡œê³ ì¹¨</button>
            <button id="report-save-snapshot-btn" class="px-3 py-1.5 text-sm border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 whitespace-nowrap">ğŸ’¾ ì €ì¥</button>
            <button id="report-load-snapshot-btn" class="px-3 py-1.5 text-sm border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 whitespace-nowrap">ğŸ“‚ ë¶ˆëŸ¬ì˜¤ê¸°</button>
            <input type="file" id="report-load-snapshot-input" name="report-load-snapshot" accept=".json" style="display: none;" aria-label="ë¦¬í¬íŠ¸ ìŠ¤ëƒ…ìƒ· íŒŒì¼ ì„ íƒ">
            <button id="report-print-btn" class="px-3 py-1.5 text-sm border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 whitespace-nowrap">ğŸ“¤ ë‚´ë³´ë‚´ê¸°/ê³µìœ </button>
          </div>
        </div>
      </div>

      <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
      <div class="border-b border-gray-200 dark:border-gray-700 px-6">
        <nav class="flex gap-4" role="tablist">
          <button id="report-tab-1" class="report-tab py-3 px-4 font-medium border-b-2 border-blue-600 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white" role="tab" aria-selected="true" data-tab="1">1. ìš”ì•½ ë° ì°¨íŠ¸</button>
          <button id="report-tab-2" class="report-tab py-3 px-4 font-medium border-b-2 border-transparent text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white" role="tab" aria-selected="false" data-tab="2">2. AI ì‹¬ì¸µ ë¶„ì„</button>
          <button id="report-tab-3" class="report-tab py-3 px-4 font-medium border-b-2 border-transparent text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white" role="tab" aria-selected="false" data-tab="3">3. ì•¡ì…˜ í”Œëœ</button>
          <button id="report-tab-4" class="report-tab py-3 px-4 font-medium border-b-2 border-transparent text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white" role="tab" aria-selected="false" data-tab="4">4. ì¼ì¼ í•™ìŠµ ê¸°ë¡</button>
          <button id="report-tab-5" class="report-tab py-3 px-4 font-medium border-b-2 border-transparent text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white" role="tab" aria-selected="false" data-tab="5">5. ë‚˜ë§Œì˜ ìš”ì•½ì„œ</button>
        </nav>
      </div>

      <!-- íƒ­ ì½˜í…ì¸  -->
      <div class="p-6">
        <!-- íƒ­ 1: ìš”ì•½ ë° ì°¨íŠ¸ -->
        <div id="report-content-1" class="report-content">
          <div class="space-y-6">

            <!-- ğŸŒ² Audit Flow Map (ìˆ² ì‹œê°í™”) -->
            <div id="audit-flowmap-container" class="bg-gradient-to-r from-blue-50 to-purple-50 dark:from-gray-800 dark:to-gray-900 rounded-xl p-6 border-2 border-blue-200 dark:border-blue-800">
              <div class="flex justify-between items-center mb-4">
                <div>
                  <h3 class="text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2">
                    ğŸŒ² Audit Flow Map
                    <span class="text-sm font-normal text-gray-600 dark:text-gray-400">ìˆ²ì„ ë³´ëŠ” ê°ì‚¬, íë¦„ì„ íƒ€ëŠ” ì•”ê¸°</span>
                  </h3>
                  <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">ê°ì‚¬ í”„ë¡œì„¸ìŠ¤ì˜ 6ë‹¨ê³„ íë¦„ ì†ì—ì„œ í˜„ì¬ ìœ„ì¹˜ë¥¼ íŒŒì•…í•˜ì„¸ìš”</p>
                </div>
                <button id="flowmap-help-btn" class="px-3 py-1 text-xs bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                  Flow ê°€ì´ë“œ
                </button>
              </div>

              <!-- Flow ë‹¨ê³„ë“¤ (ê°€ë¡œ ìŠ¤í¬ë¡¤) -->
              <div class="overflow-x-auto pb-4">
                <div class="flex gap-4 min-w-max">

                  <!-- FLOW 1: ê°ì‚¬ ì¤€ë¹„ -->
                  <div class="flow-step" data-flow-id="1">
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border-2 border-blue-500 shadow-lg hover:shadow-xl transition-all cursor-pointer min-w-[220px] h-[180px] flex flex-col">
                      <div class="flex items-center gap-2 mb-2">
                        <span class="text-3xl">ğŸ“‹</span>
                        <div>
                          <div class="text-xs text-blue-600 dark:text-blue-400 font-bold">FLOW 1</div>
                          <h4 class="font-bold text-gray-900 dark:text-white">ê°ì‚¬ ì¤€ë¹„</h4>
                        </div>
                      </div>
                      <p class="text-xs text-gray-600 dark:text-gray-400 mb-2">[ìê²©&ê³„ì•½] ëˆ„ê°€, ë¬´ì—‡ì„, ì–´ë–»ê²Œ ê³„ì•½í•˜ë‚˜?</p>
                      <div class="flex items-center justify-between">
                        <span class="text-xs text-gray-500">Ch 1-5</span>
                        <div class="flow-status-indicator w-6 h-6 rounded-full bg-gray-300" title="ìƒíƒœ ê³„ì‚° ì¤‘..."></div>
                      </div>
                      <div class="mt-2 text-xs text-gray-500">
                        <span class="font-semibold">ì „ëµ:</span> ê¸°ë³¸ê¸° 100% ì•”ê¸°
                      </div>
                    </div>
                  </div>

                  <!-- í™”ì‚´í‘œ -->
                  <div class="flex items-center text-3xl text-gray-400">â†’</div>

                  <!-- FLOW 2: ê¸°ì´ˆ ì§€ì‹ -->
                  <div class="flow-step" data-flow-id="2">
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border-2 border-green-500 shadow-lg hover:shadow-xl transition-all cursor-pointer min-w-[220px] h-[180px] flex flex-col">
                      <div class="flex items-center gap-2 mb-2">
                        <span class="text-3xl">ğŸ¢</span>
                        <div>
                          <div class="text-xs text-green-600 dark:text-green-400 font-bold">FLOW 2</div>
                          <h4 class="font-bold text-gray-900 dark:text-white">ê¸°ì´ˆ ì§€ì‹</h4>
                        </div>
                      </div>
                      <p class="text-xs text-gray-600 dark:text-gray-400 mb-2">[ê¸°ì—… ì´í•´] ê°ì‚¬ ëŒ€ìƒì„ ì•Œì•„ì•¼ ì‹œì‘í•œë‹¤</p>
                      <div class="flex items-center justify-between">
                        <span class="text-xs text-gray-500">Ch 6</span>
                        <div class="flow-status-indicator w-6 h-6 rounded-full bg-gray-300" title="ìƒíƒœ ê³„ì‚° ì¤‘..."></div>
                      </div>
                      <div class="mt-2 text-xs text-gray-500">
                        <span class="font-semibold">ì „ëµ:</span> ìœ„í—˜í‰ê°€ì˜ ê´€ë¬¸
                      </div>
                    </div>
                  </div>

                  <div class="flex items-center text-3xl text-gray-400">â†’</div>

                  <!-- FLOW 3: ìœ„í—˜ í‰ê°€ -->
                  <div class="flow-step" data-flow-id="3">
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border-2 border-amber-500 shadow-lg hover:shadow-xl transition-all cursor-pointer min-w-[220px] h-[180px] flex flex-col">
                      <div class="flex items-center gap-2 mb-2">
                        <span class="text-3xl">âš ï¸</span>
                        <div>
                          <div class="text-xs text-amber-600 dark:text-amber-400 font-bold">FLOW 3 ğŸ”¥</div>
                          <h4 class="font-bold text-gray-900 dark:text-white">ìœ„í—˜ í‰ê°€</h4>
                        </div>
                      </div>
                      <p class="text-xs text-gray-600 dark:text-gray-400 mb-2">[ì„¤ê³„ë„] ì–´ë””ê°€ ì–¼ë§ˆë‚˜ ìœ„í—˜í•œê°€?</p>
                      <div class="flex items-center justify-between">
                        <span class="text-xs text-gray-500">Ch 7</span>
                        <div class="flow-status-indicator w-6 h-6 rounded-full bg-gray-300" title="ìƒíƒœ ê³„ì‚° ì¤‘..."></div>
                      </div>
                      <div class="mt-2 text-xs text-gray-500">
                        <span class="font-semibold">í•µì‹¬:</span> ë…¼ë¦¬ì  ê¸°ë°˜ (ê°€ì¥ ì¤‘ìš”!)
                      </div>
                    </div>
                  </div>

                  <div class="flex items-center text-3xl text-gray-400">â†’</div>

                  <!-- FLOW 4: ë‚´ë¶€í†µì œ (v2.0 ì‹ ê·œ) -->
                  <div class="flow-step" data-flow-id="4">
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border-2 border-purple-500 shadow-lg hover:shadow-xl transition-all cursor-pointer min-w-[220px] h-[180px] flex flex-col">
                      <div class="flex items-center gap-2 mb-2">
                        <span class="text-3xl">ğŸ›¡ï¸</span>
                        <div>
                          <div class="text-xs text-purple-600 dark:text-purple-400 font-bold">FLOW 4 ğŸšª</div>
                          <h4 class="font-bold text-gray-900 dark:text-white">ë‚´ë¶€í†µì œ</h4>
                        </div>
                      </div>
                      <p class="text-xs text-gray-600 dark:text-gray-400 mb-2">[ê´€ë¬¸] íšŒì‚¬ í†µì œë¥¼ ë¯¿ì„ ê²ƒì¸ê°€?</p>
                      <div class="flex items-center justify-between">
                        <span class="text-xs text-gray-500">Ch 8-9</span>
                        <div class="flow-status-indicator w-6 h-6 rounded-full bg-gray-300" title="ìƒíƒœ ê³„ì‚° ì¤‘..."></div>
                      </div>
                      <div class="mt-2 text-xs text-gray-500">
                        <span class="font-semibold">ì „ëµ:</span> ëŒ€ì‘ ì „ëµ ìˆ˜ë¦½ (Gateway)
                      </div>
                    </div>
                  </div>

                  <div class="flex items-center text-3xl text-gray-400">â†’</div>

                  <!-- FLOW 5: ì‹¤ì¦ì ˆì°¨ (v2.0 ë²”ìœ„ ì¶•ì†Œ) -->
                  <div class="flow-step" data-flow-id="5">
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border-2 border-red-500 shadow-lg hover:shadow-xl transition-all cursor-pointer min-w-[220px] h-[180px] flex flex-col">
                      <div class="flex items-center gap-2 mb-2">
                        <span class="text-3xl">ğŸ”</span>
                        <div>
                          <div class="text-xs text-red-600 dark:text-red-400 font-bold">FLOW 5</div>
                          <h4 class="font-bold text-gray-900 dark:text-white">ì‹¤ì¦ì ˆì°¨</h4>
                        </div>
                      </div>
                      <p class="text-xs text-gray-600 dark:text-gray-400 mb-2">[ì¦ê±° ìˆ˜ì§‘] ìœ„í—˜Â·í†µì œì— ë§ì¶° ì¦ê±° ìˆ˜ì§‘!</p>
                      <div class="flex items-center justify-between">
                        <span class="text-xs text-gray-500">Ch 10-14</span>
                        <div class="flow-status-indicator w-6 h-6 rounded-full bg-gray-300" title="ìƒíƒœ ê³„ì‚° ì¤‘..."></div>
                      </div>
                      <div class="mt-2 text-xs text-gray-500">
                        <span class="font-semibold">ì£¼ì˜:</span> ì•”ê¸°ëŸ‰ í­ë°œ êµ¬ê°„
                      </div>
                    </div>
                  </div>

                  <div class="flex items-center text-3xl text-gray-400">â†’</div>

                  <!-- FLOW 6: ë³´ê³  -->
                  <div class="flow-step" data-flow-id="6">
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border-2 border-green-500 shadow-lg hover:shadow-xl transition-all cursor-pointer min-w-[220px] h-[180px] flex flex-col">
                      <div class="flex items-center gap-2 mb-2">
                        <span class="text-3xl">ğŸ“Š</span>
                        <div>
                          <div class="text-xs text-green-600 dark:text-green-400 font-bold">FLOW 6</div>
                          <h4 class="font-bold text-gray-900 dark:text-white">ë³´ê³ </h4>
                        </div>
                      </div>
                      <p class="text-xs text-gray-600 dark:text-gray-400 mb-2">[ì„±ì í‘œ] ìµœì¢… ì˜ê²¬ì„ ë‚¸ë‹¤</p>
                      <div class="flex items-center justify-between">
                        <span class="text-xs text-gray-500">Ch 15-16</span>
                        <div class="flow-status-indicator w-6 h-6 rounded-full bg-gray-300" title="ìƒíƒœ ê³„ì‚° ì¤‘..."></div>
                      </div>
                      <div class="mt-2 text-xs text-gray-500">
                        <span class="font-semibold">ëŒ€ë¹„:</span> ì˜ê²¬ ë³€í˜• ì‚¬ë¡€
                      </div>
                    </div>
                  </div>

                  <div class="flex items-center text-3xl text-gray-400">â†’</div>

                  <!-- FLOW 7: í™•ì¥ -->
                  <div class="flow-step" data-flow-id="7">
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border-2 border-gray-500 shadow-lg hover:shadow-xl transition-all cursor-pointer min-w-[220px] h-[180px] flex flex-col">
                      <div class="flex items-center gap-2 mb-2">
                        <span class="text-3xl">ğŸŒ</span>
                        <div>
                          <div class="text-xs text-gray-600 dark:text-gray-400 font-bold">FLOW 7</div>
                          <h4 class="font-bold text-gray-900 dark:text-white">í™•ì¥</h4>
                        </div>
                      </div>
                      <p class="text-xs text-gray-600 dark:text-gray-400 mb-2">[íŠ¹ìˆ˜ ìƒí™©] ì¼ë°˜ ê°ì‚¬ ì™¸ ë³€ìˆ˜ë“¤</p>
                      <div class="flex items-center justify-between">
                        <span class="text-xs text-gray-500">Ch 17-20</span>
                        <div class="flow-status-indicator w-6 h-6 rounded-full bg-gray-300" title="ìƒíƒœ ê³„ì‚° ì¤‘..."></div>
                      </div>
                      <div class="mt-2 text-xs text-gray-500">
                        <span class="font-semibold">ì „ëµ:</span> ì‹œí—˜ ì§ì „ ì§‘ì¤‘ì•”ê¸°
                      </div>
                    </div>
                  </div>

                </div>
              </div>

              <!-- ë²”ë¡€ -->
              <div class="mt-4 flex items-center gap-4 text-xs text-gray-600 dark:text-gray-400">
                <div class="flex items-center gap-1">
                  <div class="w-4 h-4 rounded-full bg-green-500"></div>
                  <span>ì•ˆì „ (80ì  ì´ìƒ)</span>
                </div>
                <div class="flex items-center gap-1">
                  <div class="w-4 h-4 rounded-full bg-yellow-500"></div>
                  <span>ì£¼ì˜ (60-79ì )</span>
                </div>
                <div class="flex items-center gap-1">
                  <div class="w-4 h-4 rounded-full bg-red-500"></div>
                  <span>ìœ„í—˜ (60ì  ë¯¸ë§Œ)</span>
                </div>
              </div>
            </div>

            <div>
              <div class="flex justify-between items-center mb-3">
                <h3 class="text-lg font-bold">í•™ìŠµ ì„±ê³¼ ì¶”ì´</h3>
                <div class="flex items-center gap-2">
                  <label for="chart-scope-select" class="text-sm text-gray-600 dark:text-gray-400">ì°¨íŠ¸ ìŠ¤ì½”í”„:</label>
                  <select id="chart-scope-select" name="chart-scope" class="px-2 py-1 text-sm border rounded-lg dark:bg-gray-800 dark:border-gray-700">
                    <option value="daily">ì¼ê°„</option>
                    <option value="weekly">ì£¼ê°„</option>
                    <option value="monthly">ì›”ê°„</option>
                  </select>
                </div>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="border rounded-lg p-4">
                  <h4 class="text-sm font-semibold mb-2">ì¼ì¼ í•™ìŠµëŸ‰</h4>
                  <canvas id="chart-daily-volume"></canvas>
                </div>
                <div class="border rounded-lg p-4">
                  <div class="flex justify-between items-center mb-2">
                    <h4 class="text-sm font-semibold">ì „ì²´ ì ìˆ˜ ì¶”ì´</h4>
                    <a href="trendhelp.html" target="_blank" class="text-xs text-blue-600 hover:underline dark:text-blue-400">ë„ì›€ë§</a>
                  </div>
                  <canvas id="chart-score-trend"></canvas>
                </div>
              </div>
            </div>
            <div>
              <h3 class="text-lg font-bold mb-3">ë‹¨ì›ë³„ ì·¨ì•½ì  ë¶„ì„</h3>
              <div class="border rounded-lg p-4 overflow-x-auto">
                <canvas id="chart-chapter-weakness"></canvas>
              </div>
              <div id="chapter-detail-chart" class="hidden border rounded-lg p-4 mt-4">
                <h4 class="text-sm font-semibold mb-2">ì„ íƒí•œ ë‹¨ì›ì˜ ì ìˆ˜ ì¶”ì´</h4>
                <canvas id="chart-chapter-detail"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- íƒ­ 2: AI ì‹¬ì¸µ ë¶„ì„ -->
        <div id="report-content-2" class="report-content hidden">
          <div class="text-center py-8">
            <button id="ai-analysis-start-btn" class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-medium flex items-center gap-2 mx-auto">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" class="w-5 h-5 inline-block"><rect width="100" height="100" rx="20" fill="#8B5CF6"/><rect x="20" y="20" width="60" height="60" rx="10" fill="white"/><circle cx="36" cy="43" r="9" fill="#A78BFA"/><text x="36" y="46" font-size="14" fill="white" font-family="-apple-system,BlinkMacSystemFont,sans-serif" font-weight="900" text-anchor="middle" dominant-baseline="central">ã„±</text><g transform="translate(64, 43)"><path d="M0 0 L 4 10 L 14 14 L 4 18 L 0 28 L -4 18 L -14 14 L -4 10 Z" fill="#FDE047" transform="scale(0.8) translate(0, -14)"/></g><path d="M30 60 H 70 V 72 H 30 Z M35 60 V 72 M 40 60 V 72 M 45 60 V 72 M 50 60 V 72 M 55 60 V 72 M 60 60 V 72 M 65 60 V 72" fill="none" stroke="#7C3AED" stroke-width="2"/></svg>
              Gemini Proë¡œ ì‹¬ì¸µ ë¶„ì„ ì‹œì‘
            </button>
            <p class="text-sm text-gray-700 dark:text-gray-300 mt-2">AIê°€ ì˜¤ë‹µ íŒ¨í„´ê³¼ ê°œë… ì•½ì ì„ ë¶„ì„í•©ë‹ˆë‹¤</p>
          </div>
          <div id="ai-analysis-result" class="hidden">
            <div class="flex justify-end mb-4">
              <button id="ai-analysis-copy-btn" class="px-4 py-2 text-sm border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800">ğŸ“‹ ë¶„ì„ ë‚´ìš© ë³µì‚¬</button>
            </div>
            <div class="border rounded-lg p-6 bg-white dark:bg-gray-800">
              <div id="ai-error-pattern" class="prose max-w-none dark:prose-invert !text-black dark:!text-white whitespace-pre-wrap"></div>
            </div>
          </div>
          <div id="ai-analysis-loading" class="hidden text-center py-12">
            <div class="loader mx-auto mb-4"></div>
            <p class="text-gray-600">AIê°€ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
          </div>
        </div>

        <!-- íƒ­ 3: ì•¡ì…˜ í”Œëœ -->
        <div id="report-content-3" class="report-content hidden">
          <div class="space-y-6">
            <div class="border rounded-lg p-6">
              <h3 class="text-lg font-bold mb-3">ë§ê° ê³¡ì„  ê¸°ë°˜ ë³µìŠµ í”Œë˜ë„ˆ</h3>
              <div class="space-y-4">
                <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4">
                  <h4 class="font-semibold text-red-700 dark:text-red-400 mb-2">ğŸš¨ ê¸´ê¸‰ ë³µìŠµ (ì˜¤ëŠ˜ ì¦‰ì‹œ)</h4>
                  <div id="action-urgent-list" class="space-y-1"></div>
                </div>
                <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4">
                  <h4 class="font-semibold text-yellow-700 dark:text-yellow-400 mb-2">âš ï¸ ì£¼ê¸°ì  ë³µìŠµ (ì´ë²ˆ ì£¼ ë‚´)</h4>
                  <div id="action-weekly-list" class="space-y-1"></div>
                </div>
                <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4">
                  <h4 class="font-semibold text-green-700 dark:text-green-400 mb-2">ğŸ§  ì¥ê¸° ê¸°ì–µí™” (ë‹¤ìŒ ì£¼)</h4>
                  <div id="action-longterm-list" class="space-y-1"></div>
                </div>
              </div>
            </div>
            <div class="border rounded-lg p-6">
              <h3 class="text-lg font-bold mb-3">ì¸í„°ë™í‹°ë¸Œ ì˜¤ë‹µë…¸íŠ¸</h3>
              <p class="text-sm text-gray-700 dark:text-gray-300 mb-4">í´ë¦­í•˜ì—¬ ëª¨ë²” ë‹µì•ˆê³¼ AI ì´í‰ì„ í™•ì¸í•˜ì„¸ìš”</p>
              <div id="action-wrong-answers" class="space-y-3"></div>
            </div>
          </div>
        </div>

        <!-- íƒ­ 4: ì¼ì¼ í•™ìŠµ ê¸°ë¡ -->
        <div id="report-content-4" class="report-content hidden">
          <div class="space-y-6">
            <div class="border rounded-lg p-6">
              <div id="daily-record-nav" class="flex items-center justify-between mb-4 pb-4 border-b">
                <button id="daily-prev-btn" class="text-xl px-3 py-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700" aria-label="ì´ì „ ë‚ ì§œ">â—€</button>
                <div class="relative">
                  <h3 id="daily-record-date" class="text-lg font-bold text-gray-900 dark:text-white cursor-pointer hover:text-blue-600 dark:hover:text-blue-400 transition" title="ë‚ ì§œë¥¼ í´ë¦­í•˜ì—¬ ì„ íƒ"></h3>
                  <input type="date" id="daily-date-picker" class="absolute opacity-0 pointer-events-none" aria-label="ë‚ ì§œ ì„ íƒ">
                </div>
                <button id="daily-next-btn" class="text-xl px-3 py-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700" aria-label="ë‹¤ìŒ ë‚ ì§œ">â–¶</button>
              </div>
              <div id="daily-problem-list" class="space-y-3">
                <!-- ì¼ì¼ í•™ìŠµ ê¸°ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë Œë”ë§ë©ë‹ˆë‹¤ -->
              </div>
            </div>
          </div>
        </div>

        <!-- íƒ­ 5: ë‚˜ë§Œì˜ ìš”ì•½ì„œ -->
        <div id="report-content-5" class="report-content hidden">
          <div class="space-y-6">

            <!-- ìš”ì•½ì„œ ìƒì„± ì˜µì…˜ -->
            <div class="bg-gray-50 dark:bg-gray-800 p-5 rounded-xl border border-gray-200 dark:border-gray-700 print-hidden">
              <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                ğŸ–¨ï¸ ìš”ì•½ì„œ ìƒì„± ì˜µì…˜
                <span class="text-xs font-normal text-gray-500 bg-white dark:bg-gray-700 px-2 py-0.5 rounded border">ì›í•˜ëŠ” ì¡°ê±´ìœ¼ë¡œ í•„í„°ë§í•˜ì—¬ ì¸ì‡„ìš© ìš”ì•½ì§‘ì„ ë§Œë“­ë‹ˆë‹¤</span>
              </h3>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- â‘  ë‹¨ì› ì„ íƒ -->
                <div>
                  <h4 class="text-sm font-semibold mb-2 text-blue-700 dark:text-blue-400">â‘  ë‹¨ì› ì„ íƒ</h4>
                  <div class="flex flex-wrap gap-2" id="summary-chapter-filters">
                    <!-- ì±•í„° ì²´í¬ë°•ìŠ¤ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                  </div>
                </div>

                <!-- â‘¡ ë¬¸ì œ ì¡°ê±´ -->
                <div>
                  <h4 class="text-sm font-semibold mb-2 text-blue-700 dark:text-blue-400">â‘¡ ë¬¸ì œ ì¡°ê±´ (OR ì¡°ê±´) <span class="text-xs font-normal text-gray-500">â€» ì²´í¬ ì•ˆ í•˜ë©´ ì „ì²´ ë¬¸ì œ í‘œì‹œ</span></h4>
                  <div class="grid grid-cols-2 gap-2 text-sm">
                    <label class="flex items-center space-x-1"><input type="checkbox" class="chk-condition rounded" value="score60"> <span>60ì  ë¯¸ë§Œ (ìœ„í—˜)</span></label>
                    <label class="flex items-center space-x-1"><input type="checkbox" class="chk-condition rounded" value="score70"> <span>70ì  ë¯¸ë§Œ</span></label>
                    <label class="flex items-center space-x-1"><input type="checkbox" class="chk-condition rounded" value="score80"> <span>80ì  ë¯¸ë§Œ (ì£¼ì˜)</span></label>
                    <label class="flex items-center space-x-1"><input type="checkbox" class="chk-condition rounded" value="score90"> <span>90ì  ë¯¸ë§Œ</span></label>
                    <label class="flex items-center space-x-1"><input type="checkbox" class="chk-condition rounded" value="flagged"> <span>ë³µìŠµ ì¶”ê°€(â˜…)í•œ ë¬¸ì œ</span></label>
                    <label class="flex items-center space-x-1 text-red-500"><input type="checkbox" class="chk-condition rounded" value="excluded"> <span>ë³µìŠµ ì œì™¸(â–) í¬í•¨</span></label>
                  </div>
                </div>

                <!-- â‘¢ ì¶œì²˜ í•„í„° -->
                <div>
                  <h4 class="text-sm font-semibold mb-2 text-blue-700 dark:text-blue-400">â‘¢ ì¶œì²˜ í•„í„°</h4>
                  <div class="flex gap-4 text-sm">
                    <label class="flex items-center space-x-1"><input type="checkbox" class="chk-source rounded" value="basic" checked> <span>ê¸°ë³¸ (S/H/HS)</span></label>
                    <label class="flex items-center space-x-1"><input type="checkbox" class="chk-source rounded" value="advanced"> <span>ì‹¬í™” (SS/P)</span></label>
                    <label class="flex items-center space-x-1"><input type="checkbox" class="chk-source rounded" value="other" checked> <span>ê¸°íƒ€</span></label>
                  </div>
                </div>

                <!-- â‘£ í¬í•¨í•  ë‚´ìš© -->
                <div>
                  <h4 class="text-sm font-semibold mb-2 text-blue-700 dark:text-blue-400">â‘£ í¬í•¨í•  ë‚´ìš©</h4>
                  <div class="flex flex-wrap gap-3 text-sm">
                    <label class="flex items-center space-x-1"><input type="checkbox" id="show-model-answer" class="rounded" checked> <span>ëª¨ë²” ë‹µì•ˆ</span></label>
                    <label class="flex items-center space-x-1"><input type="checkbox" id="show-my-score" class="rounded" checked> <span>ë‚´ ì ìˆ˜</span></label>
                    <label class="flex items-center space-x-1"><input type="checkbox" id="show-memory-tip" class="rounded"> <span>ğŸ’¡ ì•”ê¸°íŒ/ì²˜ë°©</span></label>
                    <label class="flex items-center space-x-1"><input type="checkbox" id="show-ai-feedback" class="rounded"> <span>ğŸ¤– AI ì´í‰</span></label>
                  </div>
                </div>
              </div>

              <div class="mt-6 flex justify-center">
                <button id="generate-summary-book-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-8 rounded-lg shadow-md transition flex items-center gap-2">
                  <span>ğŸ“‘ ìš”ì•½ì„œ ìƒì„±í•˜ê¸°</span>
                </button>
              </div>
            </div>

            <!-- ìš”ì•½ì„œ ê²°ê³¼ ì˜ì—­ -->
            <div id="summary-book-result" class="bg-white dark:bg-gray-800 min-h-[500px] p-8 border border-gray-200 dark:border-gray-700 shadow-sm rounded-lg">
              <div class="text-center text-gray-500 dark:text-gray-400 py-20">
                ìœ„ ì˜µì…˜ì„ ì„ íƒí•˜ê³  'ìš”ì•½ì„œ ìƒì„±í•˜ê¸°' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- PDF ì˜µì…˜ ì„ íƒ ëª¨ë‹¬ (Task 2: ì„ íƒí˜• PDF ë‚´ë³´ë‚´ê¸°) -->
  <div id="pdf-options-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center" style="z-index: 99999;">
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 max-w-md w-full mx-4">
      <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">ğŸ“¤ ë‚´ë³´ë‚´ê¸° ì˜µì…˜ ì„ íƒ</h3>

      <!-- ì „ì²´ ì„ íƒ/í•´ì œ -->
      <div class="mb-3 pb-3 border-b border-gray-200 dark:border-gray-700">
        <label class="flex items-center gap-2 cursor-pointer">
          <input type="checkbox" id="pdf-check-all" class="w-4 h-4 rounded" checked>
          <span class="font-semibold text-gray-700 dark:text-gray-300">ì „ì²´ ì„ íƒ</span>
        </label>
      </div>

      <!-- ê°œë³„ íƒ­ ì„ íƒ -->
      <div class="space-y-3 mb-6">
        <label class="flex items-center gap-2 cursor-pointer">
          <input type="checkbox" id="pdf-check-tab1" class="pdf-tab-checkbox w-4 h-4 rounded" checked>
          <span class="text-gray-700 dark:text-gray-300">ğŸ“Š ì°¨íŠ¸ ë¶„ì„</span>
        </label>
        <label class="flex items-center gap-2 cursor-pointer">
          <input type="checkbox" id="pdf-check-tab2" class="pdf-tab-checkbox w-4 h-4 rounded" checked>
          <span class="text-gray-700 dark:text-gray-300">ğŸ§  AI ì‹¬ì¸µ ë¶„ì„</span>
        </label>
        <label class="flex items-center gap-2 cursor-pointer">
          <input type="checkbox" id="pdf-check-tab3" class="pdf-tab-checkbox w-4 h-4 rounded" checked>
          <span class="text-gray-700 dark:text-gray-300">ğŸ“ ì•¡ì…˜ í”Œëœ & ì˜¤ë‹µë…¸íŠ¸</span>
        </label>
        <label class="flex items-center gap-2 cursor-pointer">
          <input type="checkbox" id="pdf-check-tab4" class="pdf-tab-checkbox w-4 h-4 rounded" checked>
          <span class="text-gray-700 dark:text-gray-300">ğŸ“… ì¼ì¼ í•™ìŠµ ê¸°ë¡</span>
        </label>
        <label class="flex items-center gap-2 cursor-pointer">
          <input type="checkbox" id="pdf-check-tab5" class="pdf-tab-checkbox w-4 h-4 rounded" checked>
          <span class="text-gray-700 dark:text-gray-300">ğŸ“‘ ë‚˜ë§Œì˜ ìš”ì•½ì„œ</span>
        </label>
      </div>

      <!-- ë²„íŠ¼ -->
      <div class="flex gap-3">
        <button id="pdf-options-cancel-btn" class="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700">
          ì·¨ì†Œ
        </button>
        <button id="pdf-options-execute-btn" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
          ì‹¤í–‰
        </button>
      </div>

      <p class="text-xs text-gray-500 dark:text-gray-400 mt-4">
        â„¹ï¸ ì„ íƒí•œ íƒ­ë§Œ PDFë¡œ ë‚´ë³´ëƒ…ë‹ˆë‹¤. ë¸Œë¼ìš°ì €ì˜ ì¸ì‡„ ëŒ€í™”ìƒìì—ì„œ "PDFë¡œ ì €ì¥"ì„ ì„ íƒí•˜ì„¸ìš”.
      </p>
    </div>
  </div>

  <!-- ë‚´ì¥ ë°ì´í„°(JSON) - Phase 0: localStorage ë°±ì—… ì‹œìŠ¤í…œ ë„ì…ìœ¼ë¡œ ì£¼ì„ ì²˜ë¦¬ -->
  <!--
    ì•ˆì „ì„± í™•ë³´ë¥¼ ìœ„í•´ ì œê±°í•˜ì§€ ì•Šê³  ì£¼ì„ ì²˜ë¦¬
    3ë‹¨ê³„ í´ë°± ì‹œìŠ¤í…œ: ì™¸ë¶€ JSON â†’ localStorage ë°±ì—… â†’ ë‚´ì¥ ë°ì´í„°(ë¹„í™œì„±í™”)
  -->
  <!--
  <script id="dataset-json" type="application/json">[
    {"ê³ ìœ ID":"q_001","í‘œì‹œë²ˆí˜¸":"1","ì¶œì²˜":"S","problemTitle":"íšŒê³„ê°ì‚¬ì˜ ê³ ìœ í•œê³„ ì›ì¸ ì„¸ ê°€ì§€","ë‹¨ì›":1,"ë¬¼ìŒë²ˆí˜¸":1,"ë¬¼ìŒ":"íšŒê³„ê°ì‚¬ì—ëŠ” ê³ ìœ í•œê³„ê°€ ì¡´ì¬í•œë‹¤. ê·¸ ì›ì¸ì„ ì„¸ ê°€ì§€ ì“°ì‹œì˜¤.","ì •ë‹µ":"ISA 200-A47 â‘  ì¬ë¬´ë³´ê³ ì˜ ì„±ê²© â‘¡ ê°ì‚¬ì ˆì°¨ì˜ ì„±ê²© â‘¢ í•©ë¦¬ì  ì‹œê°„Â·ë¹„ìš© ì œì•½"},
    {"ê³ ìœ ID":"q_002","í‘œì‹œë²ˆí˜¸":"2","ì¶œì²˜":"H","problemTitle":"ì ì‹œì„±ê³¼ ë¹„ìš©-íš¨ìµ ê³ ë ¤ ì‹œ ì±„íƒí•˜ëŠ” ì ˆì°¨","ë‹¨ì›":1,"ë¬¼ìŒë²ˆí˜¸":2,"ë¬¼ìŒ":"ê°ì‚¬ì¸ì€ ì ì‹œì„±ê³¼ ë¹„ìš©-íš¨ìµ ê· í˜•ì„ ê³ ë ¤í•œë‹¤. ì´ì— ë”°ë¼ ì±„íƒí•˜ëŠ” ì ˆì°¨ ì„¸ ê°€ì§€ëŠ”?","ì •ë‹µ":"ISA 200-A51 â‘  íš¨ê³¼ì  ê³„íš â‘¡ ìœ„í—˜ ë†’ì€ ë¶„ì•¼ ì§‘ì¤‘ â‘¢ í…ŒìŠ¤íŠ¸ ë“± í‘œë³¸ ì‚¬ìš©"},
    {"ê³ ìœ ID":"q_003","í‘œì‹œë²ˆí˜¸":"3","ì¶œì²˜":"SS","problemTitle":"ìƒ˜í”Œ ë¬¸ì œ","ë‹¨ì›":1,"ë¬¼ìŒë²ˆí˜¸":3,"ë¬¼ìŒ":"â€¦","ì •ë‹µ":"â€¦"}
  ]</script>
  -->

  <!-- ========================================
       ê°ë¦°ì´ v4.0 ë¦¬íŒ©í† ë§ ëª¨ë“ˆ ë¡œë“œ (ë¨¼ì € ë¡œë“œë¨)
       ======================================== -->
  <script type="module" src="js/app.js"></script>

  <script type="module">
    // ========================================
    // Phase 5.2: ëª¨ë“ˆ ì§ì ‘ import (ì „ì—­ ë¸Œë¦¿ì§€ ì œê±°)
    // ========================================
    // app.jsëŠ” StateManager ì´ˆê¸°í™”ë¥¼ ìœ„í•´ ì—¬ì „íˆ í•„ìš”
    import './js/app.js';

    // ì§ì ‘ ëª¨ë“ˆ import (window.* ì˜ì¡´ì„± ì œê±°)
    import { $ } from './js/ui/elements.js';
    import { showToast, applyDarkMode, initUIListeners } from './js/ui/domUtils.js';
    import { loadData } from './js/core/dataManager.js';
    import { getAllData, getSelectedAiModel } from './js/core/stateManager.js';
    import {
      initStatsDate,
      updateDDayDisplay,
      migrateData,
      enforceExclusiveFlagsOnAll,
      backfillReadStoreFromScores
    } from './js/core/storageManager.js';
    import { initSettings, ensureApiKeyGate, initSettingsListeners } from './js/features/settings/settingsCore.js';
    // Phase 2: dataImportExport.jsëŠ” lazy loading
    import { initReportListeners } from './js/features/report/reportCore.js';
    // Phase 2: analysis.jsëŠ” lazy loading
    // Phase 2: flashcardCore.jsëŠ” lazy loading
    import { buildSourceFilterUI, initFilterListeners } from './js/features/filter/filterCore.js';
    import { moveSourceFilterToSide, initExplorerListeners, renderExplorer } from './js/features/explorer/explorerCore.js';
    import { initQuizListeners } from './js/features/quiz/quizCore.js';
    import { initCalendarListeners, renderCalendarMonth, renderStats } from './js/features/calendar/calendarCore.js';
    import { initKeyboardShortcuts } from './js/features/quiz/navigation.js';
    import {
      initAchievementListeners,
      loadAchievements,
      checkAchievements,
      updateAchievementBadge
    } from './js/features/achievements/achievementsCore.js';
    import { initRankingUI, openRankingModal } from './js/features/ranking/rankingUI.js';
    import { initReviewListeners } from './js/features/review/reviewCore.js';
    import { initSttListeners } from './js/features/stt/sttHandler.js';

    // Phase 2: Lazy Loading ëª¨ë“ˆ ê´€ë¦¬
    let aiAnalysisModule = null;
    let flashcardModule = null;
    let dataImportExportModule = null;

    /**
     * Phase 2: AI ë¶„ì„ ëª¨ë“ˆ Lazy Loading
     */
    async function loadAIAnalysisModule() {
      if (aiAnalysisModule) return aiAnalysisModule;

      try {
        aiAnalysisModule = await import('./js/features/report/analysis.js');
        aiAnalysisModule.initAIAnalysisListeners();
        console.log('âœ… [Lazy] AI ë¶„ì„ ëª¨ë“ˆ ë¡œë“œ ì™„ë£Œ');
        return aiAnalysisModule;
      } catch (err) {
        console.error('âŒ [Lazy] AI ë¶„ì„ ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨:', err);
        showToast('AI ë¶„ì„ ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨', 'error');
        throw err;
      }
    }

    /**
     * Phase 2: í”Œë˜ì‹œì¹´ë“œ ëª¨ë“ˆ Lazy Loading
     */
    async function loadFlashcardModule() {
      if (flashcardModule) return flashcardModule;

      try {
        flashcardModule = await import('./js/features/flashcard/flashcardCore.js');
        flashcardModule.initFlashcardListeners();
        console.log('âœ… [Lazy] í”Œë˜ì‹œì¹´ë“œ ëª¨ë“ˆ ë¡œë“œ ì™„ë£Œ');
        return flashcardModule;
      } catch (err) {
        console.error('âŒ [Lazy] í”Œë˜ì‹œì¹´ë“œ ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨:', err);
        showToast('í”Œë˜ì‹œì¹´ë“œ ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨', 'error');
        throw err;
      }
    }

    /**
     * Phase 2: ë°ì´í„° Import/Export ëª¨ë“ˆ Lazy Loading
     */
    async function loadDataImportExportModule() {
      if (dataImportExportModule) return dataImportExportModule;

      try {
        dataImportExportModule = await import('./js/services/dataImportExport.js');
        dataImportExportModule.initDataImportExport();
        console.log('âœ… [Lazy] ë°ì´í„° Import/Export ëª¨ë“ˆ ë¡œë“œ ì™„ë£Œ');
        return dataImportExportModule;
      } catch (err) {
        console.error('âŒ [Lazy] ë°ì´í„° Import/Export ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨:', err);
        showToast('ë°ì´í„° Import/Export ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨', 'error');
        throw err;
      }
    }

    // Phase 5.3: ëª¨ë“  ë¡œì§ì€ ëª¨ë“ˆë¡œ ì´ë™ë¨
    // Helper functions
    function loadSettings(){
      if(window.el.aiModelSelect) window.el.aiModelSelect.value = getSelectedAiModel();
    }
    const refreshPanels=()=>{ renderCalendarMonth(); renderStats(); renderExplorer(); };
    window.refreshPanels = refreshPanels; // TODO: Remove after quizCore.js direct import
    document.addEventListener('DOMContentLoaded', async ()=>{
      try{
        await loadData();
        console.log('âœ… ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', getAllData()?.length || 0, 'ë¬¸ì œ');
      }catch(err){
        console.error(err);
        $('question-text').textContent='ë¬¸ì œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨';
        showToast(`ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${err.message}`,'error');
      }

      loadSettings();
      initStatsDate();
      updateDDayDisplay();
      applyDarkMode();
      migrateData();
      // Phase 6.2: calRefDate moved to storageManager
      enforceExclusiveFlagsOnAll();
      backfillReadStoreFromScores(false);

      initSettings();
      // Phase 2: ë°ì´í„° Import/Export ëª¨ë“ˆì€ lazy loading (ë²„íŠ¼ í´ë¦­ ì‹œ ë¡œë“œ)
      window.el.exportDataBtn?.addEventListener('click', loadDataImportExportModule, { once: true });
      window.el.importDataBtn?.addEventListener('click', loadDataImportExportModule, { once: true });
      window.el.mergeDataBtn?.addEventListener('click', loadDataImportExportModule, { once: true });
      initReportListeners();
      // Phase 2: AI ë¶„ì„ ëª¨ë“ˆì€ lazy loading (ë²„íŠ¼ í´ë¦­ ì‹œ ë¡œë“œ)
      window.el.aiAnalysisStartBtn?.addEventListener('click', loadAIAnalysisModule, { once: true });
      // Phase 2: í”Œë˜ì‹œì¹´ë“œ ëª¨ë“ˆì€ lazy loading (ë²„íŠ¼ í´ë¦­ ì‹œ ë¡œë“œ)
      window.el.flashcardModeBtn?.addEventListener('click', loadFlashcardModule, { once: true });
      ensureApiKeyGate();
      buildSourceFilterUI();
      moveSourceFilterToSide();

      // ë©”ëª¨ ë²„íŠ¼ ìš”ì†Œë“¤ì„ window.elì— ì¶”ê°€ (initQuizListenersë³´ë‹¤ ë¨¼ì € ì‹¤í–‰)
      if (window.el) {
        window.el.userMemoBtn = $('user-memo-btn');
        window.el.userMemoBtnText = $('user-memo-btn-text');
        window.el.userMemoContainer = $('user-memo-container');
        window.el.userMemoInput = $('user-memo-input');
        window.el.saveMemoBtn = $('save-memo-btn');
        window.el.memoCharCount = $('memo-char-count');

        // StateManagerì—ë„ ë™ì¼í•˜ê²Œ ì„¤ì •
        import('./js/core/stateManager.js').then(({ setElements }) => {
          setElements(window.el);
          console.log('âœ… ë©”ëª¨ ë²„íŠ¼ ìš”ì†Œë“¤ StateManagerì— ë™ê¸°í™”ë¨');
        });

        console.log('âœ… ë©”ëª¨ ë²„íŠ¼ ìš”ì†Œë“¤ window.elì— ì¶”ê°€ë¨');
      }

      initQuizListeners();
      initQuizEventListeners(); // EventBus ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™” (ìˆœí™˜ ì˜ì¡´ì„± í•´ê²°)
      initFilterListeners();
      initSummaryListeners();
      initSettingsListeners();
      initCalendarListeners();
      initExplorerListeners();
      initUIListeners();
      initKeyboardShortcuts();
      refreshPanels();

      initAchievementListeners();
      loadAchievements();
      checkAchievements();
      updateAchievementBadge();

      // Phase 3.3: ë­í‚¹ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
      initRankingUI();

      // ë­í‚¹ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
      document.getElementById('open-ranking-btn')?.addEventListener('click', () => {
        openRankingModal();
      });

      initReviewListeners();

      // STT ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™”
      initSttListeners();
    });
  </script>

  <!-- ============================================ -->
  <!-- Firebase ë¡œê·¸ì¸ ëª¨ë‹¬ -->
  <!-- ============================================ -->
  <div id="login-modal" class="hidden fixed inset-0 z-[9999] flex items-center justify-center">
    <!-- ë°°ê²½ (Backdrop) -->
    <div id="login-modal-backdrop" class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>

    <!-- ëª¨ë‹¬ ì»¨í…ì¸  -->
    <div class="relative bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full mx-4 overflow-hidden">
      <!-- í—¤ë” -->
      <div class="bg-gradient-to-r from-blue-600 to-purple-600 px-6 py-4 flex items-center justify-between">
        <h2 class="text-xl font-bold text-white">ê°ë¦°ì´ ë¡œê·¸ì¸</h2>
        <button id="login-modal-close" class="text-white hover:text-gray-200 text-2xl leading-none" aria-label="ë‹«ê¸°">Ã—</button>
      </div>

      <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
      <div class="flex border-b border-gray-200 dark:border-gray-700">
        <button id="login-tab" class="flex-1 py-3 text-sm font-medium border-b-2 border-blue-600 text-blue-600 transition">
          ë¡œê·¸ì¸
        </button>
        <button id="signup-tab" class="flex-1 py-3 text-sm font-medium border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition">
          íšŒì›ê°€ì…
        </button>
      </div>

      <!-- íƒ­ ì»¨í…ì¸  -->
      <div class="p-6">
        <!-- ë¡œê·¸ì¸ íŒ¨ë„ -->
        <div id="login-panel">
          <!-- Google ë¡œê·¸ì¸ -->
          <button id="google-login-btn" class="w-full flex items-center justify-center gap-3 bg-white dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-600 rounded-lg px-4 py-3 font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600 transition shadow-sm mb-4">
            <svg class="w-5 h-5" viewBox="0 0 24 24">
              <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
              <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
              <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
              <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
            </svg>
            Googleë¡œ ê³„ì†í•˜ê¸°
          </button>

          <div class="relative my-4">
            <div class="absolute inset-0 flex items-center">
              <div class="w-full border-t border-gray-300 dark:border-gray-600"></div>
            </div>
            <div class="relative flex justify-center text-sm">
              <span class="px-2 bg-white dark:bg-gray-800 text-gray-500">ë˜ëŠ”</span>
            </div>
          </div>

          <!-- ì´ë©”ì¼ ë¡œê·¸ì¸ í¼ -->
          <form id="email-login-form" class="space-y-4">
            <div>
              <label for="login-email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ì´ë©”ì¼</label>
              <input
                type="email"
                id="login-email"
                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-gray-100"
                placeholder="example@email.com"
                required
              />
            </div>
            <div>
              <div class="flex items-center justify-between mb-1">
                <label for="login-password" class="block text-sm font-medium text-gray-700 dark:text-gray-300">ë¹„ë°€ë²ˆí˜¸</label>
                <button type="button" id="forgot-password-btn" class="text-xs text-blue-600 dark:text-blue-400 hover:underline">
                  ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠìœ¼ì…¨ë‚˜ìš”?
                </button>
              </div>
              <input
                type="password"
                id="login-password"
                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-gray-100"
                placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                required
              />
            </div>
            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 rounded-lg transition shadow-md">
              ë¡œê·¸ì¸
            </button>
          </form>
        </div>

        <!-- íšŒì›ê°€ì… íŒ¨ë„ -->
        <div id="signup-panel" class="hidden">
          <!-- Google íšŒì›ê°€ì… -->
          <button id="google-signup-btn" class="w-full flex items-center justify-center gap-3 bg-white dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-600 rounded-lg px-4 py-3 font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600 transition shadow-sm mb-4">
            <svg class="w-5 h-5" viewBox="0 0 24 24">
              <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
              <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
              <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
              <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
            </svg>
            Googleë¡œ ê³„ì†í•˜ê¸°
          </button>

          <div class="relative my-4">
            <div class="absolute inset-0 flex items-center">
              <div class="w-full border-t border-gray-300 dark:border-gray-600"></div>
            </div>
            <div class="relative flex justify-center text-sm">
              <span class="px-2 bg-white dark:bg-gray-800 text-gray-500">ë˜ëŠ”</span>
            </div>
          </div>

          <!-- ì´ë©”ì¼ íšŒì›ê°€ì… í¼ -->
          <form id="email-signup-form" class="space-y-4">
            <div>
              <label for="signup-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ì´ë¦„</label>
              <input
                type="text"
                id="signup-name"
                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-gray-100"
                placeholder="í™ê¸¸ë™"
                required
              />
            </div>
            <div>
              <label for="signup-email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ì´ë©”ì¼</label>
              <input
                type="email"
                id="signup-email"
                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-gray-100"
                placeholder="example@email.com"
                required
              />
            </div>
            <div>
              <label for="signup-password" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ë¹„ë°€ë²ˆí˜¸</label>
              <input
                type="password"
                id="signup-password"
                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-gray-100"
                placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                required
              />
            </div>
            <div>
              <label for="signup-password-confirm" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
              <input
                type="password"
                id="signup-password-confirm"
                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-gray-100"
                placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                required
              />
            </div>
            <!-- ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜ (í•„ìˆ˜) -->
            <div class="flex items-start gap-2 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <input
                type="checkbox"
                id="privacy-consent"
                class="mt-1 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                required
              />
              <label for="privacy-consent" class="text-sm text-gray-700 dark:text-gray-300">
                <span class="font-medium text-blue-600 dark:text-blue-400 cursor-pointer hover:underline" onclick="window.open('docs/privacy_policy.html', '_blank')">ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©</span>ì— ë™ì˜í•©ë‹ˆë‹¤ <span class="text-red-500">*</span>
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                  ìˆ˜ì§‘ í•­ëª©: ì´ë©”ì¼, ì´ë¦„, í•™ìŠµ ê¸°ë¡ | ì´ìš© ëª©ì : íšŒì› ì‹ë³„, í•™ìŠµ ê´€ë¦¬ | ë³´ìœ  ê¸°ê°„: íšŒì› íƒˆí‡´ ì‹œê¹Œì§€
                </p>
              </label>
            </div>
            <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-medium py-3 rounded-lg transition shadow-md">
              íšŒì›ê°€ì…
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- í”„ë¡œí•„ ê´€ë¦¬ ëª¨ë‹¬ -->
  <div id="profile-modal" class="hidden fixed inset-0 z-[9999] flex items-center justify-center">
    <!-- ë°°ê²½ (Backdrop) -->
    <div id="profile-modal-backdrop" class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>

    <!-- ëª¨ë‹¬ ì»¨í…ì¸  -->
    <div class="relative bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full mx-4 overflow-hidden">
      <!-- í—¤ë” -->
      <div class="bg-gradient-to-r from-indigo-600 to-blue-600 px-6 py-4 flex items-center justify-between">
        <h2 class="text-xl font-bold text-white">âš™ï¸ ë‚´ ì •ë³´ ê´€ë¦¬</h2>
        <button id="profile-modal-close" class="text-white hover:text-gray-200 text-2xl leading-none" aria-label="ë‹«ê¸°">Ã—</button>
      </div>

      <!-- ëª¨ë‹¬ ë³¸ë¬¸ -->
      <div class="p-6 space-y-6">
        <!-- ê¸°ë³¸ ì •ë³´ í‘œì‹œ -->
        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 space-y-2">
          <div class="flex items-center gap-3">
            <div id="profile-avatar" class="w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold text-lg"></div>
            <div class="flex-1">
              <div id="profile-display-name" class="font-semibold text-gray-900 dark:text-gray-100"></div>
              <div id="profile-email" class="text-sm text-gray-500 dark:text-gray-400"></div>
            </div>
          </div>
        </div>

        <!-- [Achievement System 2.0] AP í‹°ì–´ ì •ë³´ -->
        <div class="bg-gradient-to-br from-purple-50 to-blue-50 dark:from-gray-700 dark:to-gray-800 rounded-lg p-4 border border-purple-200 dark:border-gray-600">
          <div class="flex items-center justify-between mb-3">
            <div class="flex items-center gap-2">
              <span class="text-2xl" id="profile-tier-icon">â­</span>
              <div>
                <div class="text-xs text-gray-600 dark:text-gray-400">í˜„ì¬ í‹°ì–´</div>
                <div class="font-bold text-lg" id="profile-tier-name" style="color: #9333ea;">Unranked</div>
              </div>
            </div>
            <div class="text-right">
              <div class="text-xs text-gray-600 dark:text-gray-400">Total AP</div>
              <div class="font-bold text-xl text-purple-600 dark:text-purple-400" id="profile-total-ap">0</div>
            </div>
          </div>

          <!-- ì§„í–‰ë¥  ë°” -->
          <div class="space-y-2">
            <div class="flex justify-between text-xs text-gray-600 dark:text-gray-400">
              <span id="profile-tier-progress-text">ë‹¤ìŒ í‹°ì–´ê¹Œì§€</span>
              <span><span id="profile-current-ap">0</span> / <span id="profile-next-tier-ap">500</span> AP</span>
            </div>
            <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-3 overflow-hidden">
              <div
                id="profile-tier-progress-bar"
                class="h-full bg-gradient-to-r from-purple-500 to-blue-500 rounded-full transition-all duration-500 ease-out"
                style="width: 0%"
              ></div>
            </div>
            <div class="text-xs text-center text-gray-600 dark:text-gray-400">
              <span id="profile-next-tier-text">Bronze í‹°ì–´ê¹Œì§€ 500 AP ë‚¨ìŒ</span>
            </div>
          </div>
        </div>

        <!-- ë‹‰ë„¤ì„ ì„¤ì • -->
        <div>
          <label for="profile-nickname-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            ğŸ‘¤ ë‹‰ë„¤ì„
          </label>
          <div class="space-y-2">
            <div class="relative">
              <input
                type="text"
                id="profile-nickname-input"
                maxlength="20"
                minlength="2"
                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:text-gray-100"
                placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš” (2-20ì)"
              />
              <div class="absolute right-3 top-2 text-xs text-gray-400 dark:text-gray-500">
                <span id="nickname-char-count">0</span>/20
              </div>
            </div>
            <div id="nickname-validation-message" class="text-xs hidden"></div>
            <button
              id="save-profile-nickname-btn"
              class="w-full bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed"
            >
              ë‹‰ë„¤ì„ ì €ì¥
            </button>
          </div>
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">
            ğŸ’¡ ë‹‰ë„¤ì„ì€ ì†Œì…œ ê¸°ëŠ¥(ë­í‚¹, ìŠ¤í„°ë”” ê·¸ë£¹)ì—ì„œ í‘œì‹œë©ë‹ˆë‹¤.
          </p>
        </div>

        <!-- ìƒíƒœ ë©”ì‹œì§€ ì„¤ì • -->
        <div>
          <label for="status-message-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            ğŸ’¬ ìƒíƒœ ë©”ì‹œì§€
          </label>
          <div class="relative">
            <input
              type="text"
              id="status-message-input"
              maxlength="20"
              class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-gray-100"
              placeholder="ë‚˜ë¥¼ í‘œí˜„í•˜ëŠ” í•œ ë§ˆë”” (ìµœëŒ€ 20ì)"
            />
            <div class="absolute right-3 top-2 text-xs text-gray-400 dark:text-gray-500">
              <span id="status-char-count">0</span>/20
            </div>
          </div>
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
            ê·¸ë£¹ì›ë“¤ì´ ë‚´ íƒ€ì¼ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´ ìƒíƒœ ë©”ì‹œì§€ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          </p>
        </div>

        <!-- ì €ì¥ ë²„íŠ¼ -->
        <button
          id="save-status-btn"
          class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 rounded-lg transition shadow-md flex items-center justify-center gap-2"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
          ì €ì¥
        </button>

        <!-- êµ¬ë¶„ì„  -->
        <div class="border-t border-gray-200 dark:border-gray-700"></div>

        <!-- íšŒì› íƒˆí‡´ ì˜ì—­ -->
        <details class="bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800">
          <summary class="px-4 py-3 cursor-pointer text-sm font-medium text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
            </svg>
            íšŒì› íƒˆí‡´
          </summary>
          <div class="px-4 pb-4 space-y-3">
            <div class="text-xs text-gray-600 dark:text-gray-400 space-y-1">
              <p>âš ï¸ íšŒì› íƒˆí‡´ ì‹œ ë‹¤ìŒ ì •ë³´ê°€ ì‚­ì œë©ë‹ˆë‹¤:</p>
              <ul class="list-disc list-inside ml-2 space-y-1">
                <li>í”„ë¡œí•„ ì •ë³´ (ì´ë¦„, ì´ë©”ì¼, ìƒíƒœ ë©”ì‹œì§€)</li>
                <li>í•™ìŠµ ê¸°ë¡ ë° í†µê³„</li>
                <li>ê·¸ë£¹ ê°€ì… ì •ë³´</li>
                <li>ì—…ì  ë‹¬ì„± ê¸°ë¡</li>
              </ul>
              <p class="mt-2 font-medium text-red-600 dark:text-red-400">ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>

            <!-- ì´ë©”ì¼ ë¡œê·¸ì¸ ì‚¬ìš©ìë¥¼ ìœ„í•œ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ -->
            <div id="delete-password-section" class="hidden">
              <label for="delete-password-input" class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">
                ë³¸ì¸ í™•ì¸ì„ ìœ„í•´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”
              </label>
              <input
                type="password"
                id="delete-password-input"
                class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 dark:bg-gray-700 dark:text-gray-100"
                placeholder="ë¹„ë°€ë²ˆí˜¸"
              />
            </div>

            <button
              id="delete-account-btn"
              class="w-full bg-red-600 hover:bg-red-700 text-white font-medium py-2 rounded-lg transition text-sm"
            >
              íƒˆí‡´í•˜ê¸°
            </button>
          </div>
        </details>
      </div>
    </div>
  </div>

</body>
  <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TC8G7NJD"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
</html>










