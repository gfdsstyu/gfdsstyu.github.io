# HLR Phase 1 êµ¬í˜„ ì™„ë£Œ ë³´ê³ ì„œ

**ë‚ ì§œ**: 2026-01-16
**êµ¬í˜„**: HLR 2.0 - Phase 1 (Rule-Based Fixes)
**ìƒíƒœ**: âœ… ì™„ë£Œ

---

## ğŸ“‹ êµ¬í˜„ëœ ìˆ˜ì • ì‚¬í•­

### 1. âœ… ì´ˆê¸° ê°€ì¤‘ì¹˜ í˜„ì‹¤í™” (Realistic Defaults)
**íŒŒì¼**: `js/features/review/hlrDataset.js:119-183`

**ë³€ê²½ ë‚´ìš©**:
- `bias`: 4.0 â†’ 1.0 (ê¸°ë³¸ ë°˜ê°ê¸°: 16ì¼ â†’ 2ì¼, íšŒê³„ì‚¬ ìˆ˜í—˜ìƒ ëª¨ë“œ)
- `incorrect_count`: -0.12 â†’ -0.8 (ì˜¤ë‹µ í˜ë„í‹° ê°•í™”, ë°˜ê°ê¸° 40~50% ê°ì†Œ)
- `last_score`: 0.005 â†’ 0.02 (ìµœê·¼ ì ìˆ˜ ì˜í–¥ë ¥ 4ë°° ê°•í™”)

**ì¶”ê°€ ê¸°ëŠ¥**:
- Phase 2 ëŒ€ë¹„ í•™ìŠµëœ ê°€ì¤‘ì¹˜ ë¡œë“œ ê¸°ëŠ¥ (`loadLearnedWeights()`)
- ì•ˆì „ ì¥ì¹˜ ê²€ì¦ ë¡œì§ (`validateWeights()`)
  - bias ë²”ìœ„ ì²´í¬: -2.0 ~ 5.0
  - incorrect_count ìŒìˆ˜ ê²€ì¦
  - í•„ìˆ˜ í‚¤ ì¡´ì¬ í™•ì¸

---

### 2. âœ… íšŒìƒ í™•ë¥  ê³„ì‚° ê°œì„  (Recall Probability Fixes)
**íŒŒì¼**: `js/features/review/hlrDataset.js:243-301`

**ìˆ˜ì • 1: ë‹¨ê¸° ê¸°ì–µ ë£¨í”„ (Short-term Memory)**
- **ë¬¸ì œ**: ë°©ê¸ˆ í‘¼ ë¬¸ì œ(Î”t â‰ˆ 0)ì˜ p_currentê°€ 100%ë¡œ ê³„ì‚°ë¨
- **í•´ê²°**: 1ì‹œê°„ ë¯¸ë§Œ ë¬¸ì œëŠ” `isShortTerm: true` í”Œë˜ê·¸ì™€ í•¨ê»˜ ë³„ë„ ì²˜ë¦¬
- **ì½”ë“œ**:
  ```javascript
  if (timeSinceLastReview < (1/24)) { // 1ì‹œê°„
    return { p_current: null, isShortTerm: true, lastScore };
  }
  ```

**ìˆ˜ì • 2: ì ìˆ˜ ë°˜ì˜ (Score Integration)**
- **ë¬¸ì œ**: ì‹œê°„ë§Œ ê³ ë ¤í•˜ê³  ì ìˆ˜ëŠ” ë¬´ì‹œ â†’ "ë°©ê¸ˆ í’€ì—ˆì–´ë„ ì ìˆ˜ê°€ ë‚˜ì˜ë©´ ë³µìŠµí•´ì•¼ í•˜ì§€ ì•Šì„ê¹Œ?"
- **í•´ê²°**: ì ìˆ˜ ê°€ì¤‘ì¹˜ë¥¼ íšŒìƒ í™•ë¥ ì— ê³±í•¨
- **ì½”ë“œ**:
  ```javascript
  const scoreWeight = Math.pow(lastScore / 100, 0.3);
  const p_current = p_time * Math.max(0.3, scoreWeight);
  ```
- **íš¨ê³¼**:
  - 0ì : íšŒìƒ í™•ë¥  30%ë¡œ ê°ì†Œ (ë³µìŠµ í•„ìš”)
  - 60ì : íšŒìƒ í™•ë¥  83%ë¡œ ìœ ì§€
  - 100ì : íšŒìƒ í™•ë¥  100% ìœ ì§€

---

### 3. âœ… ìˆœí™˜ ì°¸ì¡° í•´ê²° (Circular Reference Fix)
**íŒŒì¼**: `js/features/review/hlrDataset.js:52-81`

**ë¬¸ì œ**:
- í•™ìŠµ ì‹œ: `p_observed = score / 100` (ì ìˆ˜ë¥¼ í™•ë¥ ë¡œ ì‚¬ìš©)
- ì˜ˆì¸¡ ì‹œ: ì ìˆ˜ ë¯¸ì‚¬ìš©
- ê²°ê³¼: í•™ìŠµ ë°ì´í„°ì™€ ì˜ˆì¸¡ ë¡œì§ì´ ë¶ˆì¼ì¹˜

**í•´ê²°**:
- ì ìˆ˜ë¥¼ ì„±ëŠ¥ ì§€í‘œë¡œ ì¬í•´ì„í•˜ì—¬ ì‹¤ì œ íšŒìƒ í™•ë¥  ì¶”ì •
- êµ¬ê°„ë³„ ë§¤í•‘:
  ```javascript
  80~100ì  â†’ p=0.80~0.95 (ì˜ ê¸°ì–µí•¨)
  60~79ì   â†’ p=0.60~0.79 (ì–´ëŠ ì •ë„ ê¸°ì–µ)
  40~59ì   â†’ p=0.40~0.59 (ì¼ë¶€ ë§ê°)
  0~39ì    â†’ p=0.10~0.39 (ëŒ€ë¶€ë¶„ ë§ê°)
  ```

**íš¨ê³¼**:
- 0ì  ë¬¸ì œì˜ log ê³„ì‚° ì˜¤ë¥˜ í•´ê²° (0.05 ~ 0.99 ë²”ìœ„ ë³´ì¥)
- í•™ìŠµ ë°ì´í„°ê°€ ì‹¤ì œ ë§ê° ê³¡ì„ ì„ ë” ì˜ ë°˜ì˜

---

### 4. âœ… ì˜¤ëŠ˜ í‹€ë¦° ë¬¸ì œ ê¸´ê¸‰ êµ¬ì œ (Short-term Loop)
**íŒŒì¼**: `js/features/review/reviewCore.js:56-70`

**ì¡°ê±´**:
- 24ì‹œê°„ ì´ë‚´ í’€ì´ AND (ì ìˆ˜ < 60 OR í”Œë˜ê·¸ ì„¤ì •)

**ë™ì‘**:
- HLR ê³„ì‚° ìš°íšŒí•˜ê³  ë¬´ì¡°ê±´ ìµœìƒë‹¨ ë…¸ì¶œ (`priority -= 99999`)
- ì ìˆ˜ ë‚®ì„ìˆ˜ë¡ ë” ë†’ì€ ìš°ì„ ìˆœìœ„ (`priority += lastScore * 10`)

**ì˜ˆì‹œ**:
- ì˜¤ëŠ˜ 30ì ìœ¼ë¡œ í’€ì´ â†’ ë³µìŠµ ë¦¬ìŠ¤íŠ¸ ìµœìƒë‹¨
- ì˜¤ëŠ˜ 70ì ìœ¼ë¡œ í’€ì´ â†’ ì •ìƒ HLR ê³„ì‚°
- í”Œë˜ê·¸ ì„¤ì •ëœ ë¬¸ì œ â†’ ì ìˆ˜ ë¬´ê´€ ìµœìƒë‹¨

---

### 5. âœ… ë‹¨ê¸° ê¸°ì–µ ì²˜ë¦¬ ì¶”ê°€
**íŒŒì¼**: `js/features/review/reviewCore.js:75-79`

**ë™ì‘**:
- 1ì‹œê°„ ë¯¸ë§Œ ë¬¸ì œëŠ” `priority += 50000`ìœ¼ë¡œ ë‚®ì€ ìš°ì„ ìˆœìœ„
- ì•„ì§ ì¥ê¸° ê¸°ì–µìœ¼ë¡œ ì „í™˜ë˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ ì¦‰ì‹œ ë³µìŠµ ë¶ˆí•„ìš”

---

### 6. âœ… EnhancedHLRPredictor í˜¸í™˜ì„± ë³´ì¥
**íŒŒì¼**: `js/features/review/hlrDataset.js:334-349`

**ë³€ê²½**:
- Phase 2 í•™ìŠµëœ ê°€ì¤‘ì¹˜ê°€ ìˆì–´ë„ FSRS ìš”ì†ŒëŠ” ì¶”ê°€ë¡œ ì ìš©
- `difficulty_feature`, `passive_views`, `rated_passive` í‚¤ ì¡´ì¬ í™•ì¸ í›„ ì¶”ê°€

---

## ğŸ¯ í•´ê²°ëœ ë¬¸ì œì  ìš”ì•½

| # | ë¬¸ì œ | í•´ê²° ë°©ë²• | ìœ„ì¹˜ |
|---|------|----------|------|
| 1 | ë°©ê¸ˆ í‘¼ ë¬¸ì œê°€ íšŒìƒ í™•ë¥  100% | 1ì‹œê°„ ì„ê³„ê°’ + ë‹¨ê¸° ê¸°ì–µ í”Œë˜ê·¸ | hlrDataset.js:265-277 |
| 2 | ì ìˆ˜ê°€ íšŒìƒ í™•ë¥ ì— ë¯¸ë°˜ì˜ | ì ìˆ˜ ê°€ì¤‘ì¹˜ ê³±ì…ˆ (pow 0.3) | hlrDataset.js:282-292 |
| 3 | ìˆœí™˜ ì°¸ì¡° (í•™ìŠµ â‰  ì˜ˆì¸¡) | ì ìˆ˜ â†’ ì„±ëŠ¥ ì§€í‘œ ë§¤í•‘ | hlrDataset.js:52-77 |
| 4 | 0ì  ë¬¸ì œ log ê³„ì‚° ì˜¤ë¥˜ | êµ¬ê°„ë³„ í™•ë¥  ë§¤í•‘ (0.05~0.99) | hlrDataset.js:65-77 |
| 5 | ì˜¤ëŠ˜ í‹€ë¦° ë¬¸ì œ ë¯¸ë³µìŠµ | 24h + 60ì  ë¯¸ë§Œ ìµœìƒë‹¨ ë…¸ì¶œ | reviewCore.js:62-69 |
| 6 | ì´ˆê¸° ë°˜ê°ê¸° ë„ˆë¬´ ê¹€ (16ì¼) | bias 1.0 (2ì¼) | hlrDataset.js:125 |
| 7 | ì˜¤ë‹µ í˜ë„í‹° ì•½í•¨ | incorrect_count -0.8 | hlrDataset.js:130 |

---

## ğŸ”„ Phase 2 ì¤€ë¹„ì‚¬í•­

### ì´ë¯¸ êµ¬í˜„ëœ ê²ƒ:
- âœ… `loadLearnedWeights()` ë©”ì„œë“œ
- âœ… `validateWeights()` ì•ˆì „ ì¥ì¹˜
- âœ… localStorage í‚¤: `hlr_learned_weights_v2`

### ë‹¤ìŒ ë‹¨ê³„:
1. `js/features/review/trainHLR.js` ìƒì„±
   - TensorFlow.js ì„ í˜• íšŒê·€ ëª¨ë¸
   - 50+ ë°ì´í„°ì…‹ í•™ìŠµ
   - ê°€ì¤‘ì¹˜ ê²€ì¦ ë° ì €ì¥

2. `index.html` TensorFlow.js CDN ì¶”ê°€

3. í•™ìŠµ íŠ¸ë¦¬ê±° ì—°ê²°
   - ë³µìŠµ ì„¸ì…˜ ì™„ë£Œ ì‹œ
   - 50ì˜ ë°°ìˆ˜ ë¬¸ì œ í’€ì´ ì‹œ
   - `requestIdleCallback` ì‚¬ìš©

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì˜¤ëŠ˜ í‹€ë¦° ë¬¸ì œ
- **Before**: HLR ê³„ì‚° â†’ p=100% â†’ ë³µìŠµ ì œì™¸
- **After**: Short-term Loop â†’ priority=-99999 â†’ ìµœìƒë‹¨

### ì‹œë‚˜ë¦¬ì˜¤ 2: 1ì‹œê°„ ì „ í‘¼ ë¬¸ì œ
- **Before**: p=100% â†’ ë³µìŠµ ì œì™¸
- **After**: isShortTerm=true â†’ priority=+50000 â†’ ë‚®ì€ ìš°ì„ ìˆœìœ„

### ì‹œë‚˜ë¦¬ì˜¤ 3: ì–´ì œ 30ì ìœ¼ë¡œ í‘¼ ë¬¸ì œ
- **Before**: p_timeë§Œ ê³„ì‚° (ì˜ˆ: p=85%)
- **After**: p_time * scoreWeight (ì˜ˆ: p=85% * 0.67 = 57%) â†’ ë³µìŠµ í•„ìš”

### ì‹œë‚˜ë¦¬ì˜¤ 4: 2ì£¼ ì „ 80ì ìœ¼ë¡œ í‘¼ ë¬¸ì œ
- **Before**: h=16ì¼ ê¸°ì¤€ â†’ p=70%
- **After**: h=2ì¼ ê¸°ì¤€ â†’ p=1% â†’ ë†’ì€ ìš°ì„ ìˆœìœ„

---

## ğŸ“ ì‚¬ìš©ì í”¼ë“œë°± ë°˜ì˜

> "ë°©ê¸ˆí’€ì—ˆì–´ë„ ì ìˆ˜ê°€ ì¢ƒê°™ìœ¼ë©´ ë³µìŠµí•´ì•¼í•˜ì§€ ì•Šì„ê¹Œ?"

âœ… **ë°˜ì˜ë¨**:
- ì ìˆ˜ ê°€ì¤‘ì¹˜ ì ìš© (hlrDataset.js:282-292)
- 24ì‹œê°„ ì´ë‚´ 60ì  ë¯¸ë§Œ ë¬¸ì œ ìµœìƒë‹¨ ë…¸ì¶œ (reviewCore.js:62-69)

> "ì˜¤ëŠ˜ í‘¼ë¬¸ì œë¥¼ ì¥ê¸°ê¸°ì–µí™”ë¡œ ë¶„ë¥˜í•˜ë”ë¼ê³ "

âœ… **í•´ê²°ë¨**:
- 1ì‹œê°„ ë‹¨ê¸° ê¸°ì–µ ì„ê³„ê°’ (hlrDataset.js:267-276)
- ë‹¨ê¸° ê¸°ì–µì€ ë‚®ì€ ìš°ì„ ìˆœìœ„ (reviewCore.js:76-78)

---

## ğŸ” ì½”ë“œ ë¦¬ë·° í¬ì¸íŠ¸

1. **hlrDataset.js:125**: bias 1.0 â†’ 2ì¼ ë°˜ê°ê¸°ê°€ ì ì ˆí•œì§€?
2. **hlrDataset.js:130**: incorrect_count -0.8 â†’ ë„ˆë¬´ ê°€í˜¹í•œì§€?
3. **reviewCore.js:62**: 24ì‹œê°„ + 60ì  ì„ê³„ê°’ì´ ì ì ˆí•œì§€?
4. **hlrDataset.js:267**: 1ì‹œê°„ ë‹¨ê¸° ê¸°ì–µ ì„ê³„ê°’ì´ ì¶©ë¶„í•œì§€?

---

## ğŸš€ ë°°í¬ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] ê¸°ì¡´ ë°ì´í„° êµ¬ì¡° í˜¸í™˜ì„± í™•ì¸ (questionScores, solveHistory)
- [x] ì—ëŸ¬ ì²˜ë¦¬ ì¶”ê°€ (ë°ì´í„° ë¶€ì¡±, null ì²´í¬)
- [x] ì½”ë“œ ëª¨ë“ˆí™” ë° ì£¼ì„ ì¶”ê°€
- [x] Phase 2 í˜¸í™˜ì„± í™•ë³´ (í•™ìŠµëœ ê°€ì¤‘ì¹˜ ë¡œë“œ)
- [ ] ì‹¤ì œ ì‚¬ìš©ì ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸
- [ ] ë³µìŠµ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥ í™•ì¸
- [ ] ì½˜ì†” ë¡œê·¸ ê²€ì¦

---

## ğŸ“Œ ì°¸ê³  ë¬¸ì„œ

- ì›ë³¸ ê¸°íšì„œ: `docs/HLRupgrade.md`
- êµ¬í˜„ íŒŒì¼:
  - `js/features/review/hlrDataset.js`
  - `js/features/review/reviewCore.js`
